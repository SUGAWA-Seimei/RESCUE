<!DOCTYPE html>

<html lang="ja"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="description" content="ã“ã“ã¯ã€Œãƒãƒ³ãƒã€ã€Œã‚±ãƒ„ãƒãƒ³ã‚³ã€è¦‹ã‚‰ã‚Œã¦ã€è¦‹ã›ã¦ã€ã•ã‚ã‚‰ã‚Œå¬²ã‚‰ã‚Œ è¼ªå§¦ã•ã‚Œã€‚ çŠ¯ã‹ã•ã‚Œã€‚ãƒãƒ³ãƒã—ã”ã‹ã‚Œã€ã‚±ãƒ„çŠ¯ã‹ã•ã‚Œ ç²¾æ¶²çµã‚Šå–ã‚‰ã‚ŒãŸã„ç”·ã®å ´æ‰€">

<title>RESCURE</title>


<script>
var emoji = {
	poi:{chara:"â”",size:10,multi:0.5},
	victim:{chara:"ğŸ¤•",size:10,multi:0.5},
	healed:{chara:"ğŸ¥°",size:10,multi:0.5},
	hazmat:{chara:"ğŸ’£",size:10,multi:0.5},
	smoke:{chara:"ğŸ’­",size:10,multi:0.8},
	fire:{chara:"ğŸ”¥",size:10,multi:0.8},
	hotspot:{chara:"ğŸ’¥",size:10,multi:0.3},
	fireengine:{chara:"ğŸš’",size:10,multi:0.7},
	ambulance:{chara:"ğŸš‘",size:10,multi:0.7},
	p1:{chara:"â‘ ",size:10,multi:0.6},
	p2:{chara:"â‘¡",size:10,multi:0.6},
	p3:{chara:"â‘¢",size:10,multi:0.6},
	p4:{chara:"â‘£",size:10,multi:0.6},
	p5:{chara:"â‘¤",size:10,multi:0.6},
	p6:{chara:"â‘¥",size:10,multi:0.6},
	damage:{chara:"ğŸš",size:10,multi:0},
	dead:{chara:"â˜ ",size:10,multi:0},
	alive:{chara:"ğŸ’–",size:10,multi:0},
	ap:{chara:"ğŸƒ",size:10,multi:0},
	sap:{chara:"ğŸ’¨",size:10,multi:0},
	rewind:{chara:"ğŸ”„",size:10,multi:0},
};

var role = {

	generalist:{
		ap:5,
		sap:0,
		name:"ä¸€èˆ¬éšŠå“¡",
		ex_action:[],
		dis_ex:false
	},
	captain:{
		ap:4,
		sap:2,
		name:"æ¶ˆé˜²æŒ‡ä»¤",
		ex_action:[
			{name:"ä»–è€…ã®ç§»å‹•",cost:1,
			select:["n","s","s","g"],
			cost:function(a,b){return 1;},
			action:[
				function(){
					clear_message();
					var sss =[];
					for(var i=0;i<player.length;i++){
						if(i!=game.turn){
							sss.push("ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼"+(i+1));
						}
					}
					sss.push("ã‚­ãƒ£ãƒ³ã‚»ãƒ«")
					add_message("ã©ã®ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’å‹•ã‹ã—ã¾ã™ã‹ï¼Ÿ");
					show_option(sss);
					ex_select++;
				},
				function(a){
					clear_message();
					if(a>=game.turn)a++;
					if(a==player.length){choose_action();return false;}
					player[game.turn].ex_act.target = a;

					if(player[a].role=="cafs"){
						if(player[game.turn].ex_act.cafs){
							add_message("ã“ã®èƒ½åŠ›ã‚’"+role["cafs"].name+"ã«ä½¿ãˆã‚‹ã®ã¯1å›ã¾ã§ã ã€‚");
							choose_action();
							return true;
						}
					}
					add_message("ä½•ã‚’ã•ã›ã¾ã™ã‹ï¼Ÿ");
					show_option(["ç§»å‹•/é‹æ¬","æ‰‰ã®é–‹é–‰","ã‚­ãƒ£ãƒ³ã‚»ãƒ«"]);
					ex_select++;
				},
				function(a){
					clear_message();
					if(a==2){choose_action();return false;}
					player[game.turn].ex_act.movedoor = a;
					add_message("ã©ã“ã‚’å¯¾è±¡ã«ã—ã¾ã™ã‹ï¼Ÿ");
					show_option(["ã‚­ãƒ£ãƒ³ã‚»ãƒ«"]);
					ex_select++;
				},
				function(xx,yy){
					var tt= player[game.turn].ex_act.target;
					var md = player[game.turn].ex_act.movedoor;
					if(yy<0){choose_action();return false;}

					if(md==0){
						ss = player_move(tt,xx,yy);//APã®åˆ¤å®šã‚‚ã‚„ã£ã¦ãã‚Œã¦ã‚‹ã€‚
						if(ss){player[game.turn].ex_act[player[tt].role] = true;}
					}else{
						if(is_payable(8,0)==false){add_message("ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒã‚¤ãƒ³ãƒˆãŒè¶³ã‚Šãªã„ï¼");choose_action();return false;}
						ss = opendoor(player[tt].x,player[tt].y,xx,yy);
						if(ss){
							player[game.turn].ex_act[player[tt].role] = true;
							pay_cost(8,0);
						}
						choose_action();
					}
					return true;
				}
			]
			}
		],
		dis_ex:false
	},
	imaging:{
		ap:4,
		sap:0,
		name:"èµ¤å¤–ç·šèµ°æŸ»å“¡",
		ex_action:[
			{name:"ä¸å¯©ç®‡æ‰€ã®è­˜åˆ¥",
			select:["n","g"],
			cost:function(a,b){return 1;},
			action:[
				function(){
					clear_message();
					if(is_payable(8,0)==false){add_message("ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒã‚¤ãƒ³ãƒˆãŒè¶³ã‚Šãªã„ï¼");choose_action();return false;}
					var sss =[];
					for(var i=0;i<poi.length;i++){
						if(poi[i].status==1){
							sss.push("åœ°ç‚¹["+poi[i].x+","+poi[i].y+"]");
						}
					}
					if(sss.length==0){
						add_message("è­˜åˆ¥ã§ãã¦ã„ãªã„ä¸å¯©ç®‡æ‰€ãŒãªã„ï¼");
					}if(sss.length==1){
						ex_select++;
						ex_action(0);
					}else{
						add_message("ã©ã®ä¸å¯©ç®‡æ‰€ã‚’è­˜åˆ¥ã—ã¾ã™ã‹ï¼Ÿ");
						ex_select++;
						show_option(sss);
					}
				},
				function(xx,yy){

					var tt = xx;

					for(var i = 0;i < poi.length;i++){
						if(poi[i].status==1){
							tt--;
							if(tt < 0 && yy < 0){
								xx = i;
								yy = -1;
								break;
							}
							if(poi[i].x == xx && poi[i].y == yy){
								xx = i;
								yy = -1;
								break;
							}
						}
					}

					if(yy < 0){
						clear_message();
						pay_cost(8,0);
						flip_poi(xx);
						choose_action();
						return true;
					}
				}
			]
			}
		],
		dis_ex:false
	},
	cafs:{
		ap:3,
		sap:3,
		name:"CAFSè£…ç½®éšŠå“¡",
		ex_action:[
		],
		dis_ex:false
	},
	paramedic:{
		ap:4,
		sap:0,
		name:"æ•‘æ€¥æ•‘å‘½å£«",
		ex_action:[
			{name:"è¦æ•‘åŠ©è€…ã®è˜‡ç”Ÿ",
			cost:function(a,b){return 1;},
			select:["n"],
			action:[
				function(){
					clear_message();
					if(is_payable(8,0)==false){add_message("ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒã‚¤ãƒ³ãƒˆãŒè¶³ã‚Šãªã„ï¼");choose_action();return false;}

					for(var i=0;i<poi.length;i++){
						if(poi[i].status==2 && player[game.turn].x ==poi[i].x && player[game.turn].y ==poi[i].y){
							poi[i].status=3;
							add_message("è¦æ•‘åŠ©è€…ã‚’æ‰‹å½“ã¦ã—ãŸã€‚");
							choose_action();
							return true;
						}
					}
					pay_cost(8,0);
					add_message("æ‰‹å½“ã¦ã‚’ã—ãªã‘ã‚Œã°ãªã‚‰ãªã„è¦æ•‘åŠ©è€…ãŒãã®å ´ã«ã„ãªã„ã€‚");
					choose_action();
					return true;
				}
			]
			}
		],
		dis_ex:true
	},
	hazmat:{
		ap:4,
		sap:0,
		name:"å±é™ºç‰©å‡¦ç†éšŠå“¡",
		ex_action:[
			{name:"å±é™ºç‰©ã®å‡¦ç†",
			cost:function(a,b){return 1;},
			select:["n"],
			action:[
				function(){
					clear_message();
					for(var i=0;i<hazmat.length;i++){
						if(hazmat[i].status==1 && player[game.turn].x ==hazmat[i].x && player[game.turn].y ==hazmat[i].y){
							hazmat[i].status=0;
							add_message("å±é™ºç‰©ã‚’å‡¦ç†ã—ãŸã€‚");
							choose_action();
							return true;
						}
					}
					add_message("å±é™ºç‰©ãŒãã®å ´ã«ã„ãªã„ã€‚");
					choose_action();
					return true;
				}
			]
			}
		],
		dis_ex:false
	},
	rescue:{
		ap:4,
		sap:3,
		name:"ç‰¹åˆ¥æ•‘åŠ©éšŠå“¡",
		ex_action:[
		],
		dis_ex:true
	},
	driver:{
		ap:4,
		sap:0,
		name:"é‹è»¢æ“ä½œæŠ€å¸«",
		ex_action:[
		],
		dis_ex:false
	},
};

var map = {
	first_easy:{
		tate:8,
		yoko:10,
		poi_end:{x:3,y:3},
		name:"åŸºæœ¬ã‚»ãƒƒãƒˆ(è¡¨)",
		fireengine_place:[	[[7,0],[8,0]],
				[[9,5],[9,6]],
				[[2,7],[1,7]],
				[[0,2],[0,1]]],
		ambulance_place:[[[5,0],[6,0]],
				[[9,4],[9,3]],
				[[3,7],[4,7]],
				[[0,3],[0,4]]],
		wall_yoko:
			[[0,0,0,0,0,0,0,0,0,0],
			 [4,0,0,2,0,4,0,0,4,0],
			 [4,0,0,4,0,2,0,0,4,0],
			 [1,0,2,0,0,0,4,0,4,0],
			 [4,0,4,0,0,0,2,0,1,0],
			 [4,0,0,0,0,4,0,4,4,0],
			 [4,0,0,0,0,2,0,2,4,0],
			 [0,0,0,0,0,0,0,0,0,0]],
		wall_tate:
			[[0,4,4,4,4,4,1,4,4,0],
			 [0,0,0,0,0,0,0,0,0,0],
			 [0,0,0,4,4,4,4,4,2,0],
			 [0,0,0,0,0,0,0,0,0,0],
			 [0,4,4,4,2,4,4,4,4,0],
			 [0,0,0,0,0,0,0,0,0,0],
			 [0,4,4,1,4,4,4,4,4,0],
			 [0,0,0,0,0,0,0,0,0,0]],
		poi_move:
			[[0,0,0,0,0,0,0,0,0,0],
			 [0,3,2,2,2,2,2,2,1,0],
			 [0,6,3,4,2,2,6,1,4,0],
			 [0,6,8,2,4,4,4,8,4,0],
			 [0,6,2,6,6,6,8,2,4,0],
			 [0,6,9,4,8,8,6,7,4,0],
			 [0,9,8,8,8,8,8,8,7,0],
			 [0,0,0,0,0,0,0,0,0,0]]
	},
	first_normal:{
		tate:8,
		yoko:10,
		poi_end:{x:3,y:3},
		name:"åŸºæœ¬ã‚»ãƒƒãƒˆ(è£)",
		fireengine_place:[	[[3,0],[4,0]],
				[[9,2],[9,3]],
				[[5,7],[6,7]],
				[[0,4],[0,5]]],
		ambulance_place:[[[5,0],[6,0]],
				[[9,4],[9,5]],
				[[3,7],[4,7]],
				[[0,2],[0,3]]],
		wall_yoko:
			[[0,0,0,0,0,0,0,0,0,0],
			 [4,0,0,4,0,2,0,0,4,0],
			 [4,0,0,4,0,4,0,0,4,0],
			 [1,0,0,4,0,2,0,0,4,0],
			 [4,0,0,0,0,0,2,0,4,0],
			 [4,0,0,4,0,0,4,0,4,0],
			 [4,0,0,4,0,0,4,0,4,0],
			 [0,0,0,0,0,0,0,0,0,0]],
		wall_tate:
			[[0,4,4,4,4,4,4,4,4,0],
			 [0,0,0,0,4,4,0,0,0,0],
			 [0,4,4,0,0,0,0,0,0,0],
			 [0,0,0,0,4,2,2,4,4,0],
			 [0,4,4,2,4,4,2,0,0,0],
			 [0,0,0,0,0,0,0,0,0,0],
			 [0,4,4,4,4,4,4,4,4,0],
			 [0,0,0,0,0,0,0,0,0,0]],
		poi_move:
			[[0,0,0,0,0,0,0,0,0,0],
			 [0,3,2,2,2,2,2,2,1,0],
			 [0,6,3,4,2,2,6,1,4,0],
			 [0,6,8,2,4,4,4,8,4,0],
			 [0,6,2,6,6,6,8,2,4,0],
			 [0,6,9,4,8,8,6,7,4,0],
			 [0,9,8,8,8,8,8,8,7,0],
			 [0,0,0,0,0,0,0,0,0,0]]
	}
}

var p_color = ["RGB(255,106,106)","RGB(106,106,255)","RGB(106,255,106)","RGB(255,255,106)","RGB(244,180,106)","RGB(228,228,228)"];
var hazmat_color = "RGB(218,38,38)";
var poi_color = "RGB(75,181,231)";
var ambulance_color = "RGB(255,200,32)";
var fireengine_color = "RGB(0,162,132)";
var poi_name = ["æ•‘åŠ©æ¸ˆã¿","ä¸å¯©ç®‡æ‰€","è¦æ•‘åŠ©è€…","è¦æ•‘åŠ©è€…(æ‰‹å½“æ¸ˆã¿)"];
var difficulty_name = ["æ–°å…¥éšŠå“¡ãƒ¬ãƒ™ãƒ«","ãƒ™ãƒ†ãƒ©ãƒ³ãƒ¬ãƒ™ãƒ«","è‹±é›„ãƒ¬ãƒ™ãƒ«"];


var board = {

	tate:8,yoko:10,

	wall_yoko:[],//ç¸¦æ¨ªã®ãƒã‚¹æ•°ã€å£ã®çŠ¶æ…‹(0=ãªã—ã€1=æ‰‰(é–‹)ã€2=æ‰‰(é–‰)ã€3=å£ï¼ˆãƒ€ãƒ¡ãƒ¼ã‚¸)ã€4=å£(ç„¡å‚·)
	wall_tate:[],//ãƒã‚¹ã‹ã‚‰è¦‹ã¦å³ã¨ä¸‹ã®å£ã®çŠ¶æ…‹ã‚’ç®¡ç†ã™ã‚‹ã€‚ï¼ˆç¸¦ã®çœŸä¸‹ã¨æ¨ªã®çœŸå³ã®ãƒã‚¹ã¯å¿…ãš0ã«ã™ã‚‹)

	hotspot:[],//é«˜éŸ³ç‚¹ãƒãƒ¼ã‚«ãƒ¼
	fire:[],//ç…™1ï¼ç«2ãƒãƒ¼ã‚«ãƒ¼
	marker:[],
	poi_end:{},
	fireengine_pos:0,
	ambulance_pos:0,
	fireengine_place:[],
	ambulance_place:[],
}

var game = {
	version:0.9,//ãƒ­ãƒ¼ãƒ‰ãƒ‡ãƒ¼ã‚¿ã®äº’æ›æ€§ãŒãªããªã£ãŸã‚‰ãƒ¡ã‚¸ãƒ£ãƒ¼ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’ä¸Šã’ã‚‹ã€‚ãã†ã§ãªã‘ã‚Œã°å°æ•°ç‚¹ä»¥ä¸‹ã‚’ä¸Šã’ã‚‹ã€‚

	phase: 0,//ã‚·ãƒ¼ãƒ³ã§ã®é€²è¡Œåº¦åˆã„ã€ã‚²ãƒ¼ãƒ ãƒ–ãƒƒã‚¯ã®ãƒ‘ãƒ©ã‚°ãƒ©ãƒ•ç•ªå·ã®æ„Ÿè¦š
	scene: 0,//ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã€ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã€ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã€ã‚²ãƒ¼ãƒ ä¸­ã€ç…™ã®è¨­ç½®ã€å‹æ•—åˆ¤å®š&POIã®è¨­ç½®
	turn : 0,//èª°ã®ã‚¿ãƒ¼ãƒ³ã‹

	damage :24,
	alive:0,
	dead:0,

	hotspot_remain:6,

	hotspot_flag:false, //ç‚ã®æ‹¡å¤§ã§é«˜æ¸©ç‚¹ã®æ‰€ã«å½“ãŸã£ãŸã‹ã©ã†ã‹

	poi_rest:15,
	victim_rest:10,
	false_rest:5,

	difficulty:0,

	ap:0,
	sap:0,
}



var canvas;
var context;


var mouse_x = 0;
var mouse_y = 0;
var mouse_cell_x = 0;
var mouse_cell_y = 0;

var click_x = 0;
var click_y = 0;
var click_cell_x = 0;
var click_cell_y = 0;

var cell_size = 0;

var dice8 = 1;
var dice6 = 1;

var hazmat =[];
var poi = [];
var player = [];

var card_font_size = 5;
var card_pos = 0;//ã‚ªãƒ—ã‚·ãƒ§ãƒ³ãŒå³ã‹ä¸‹ã‹ã©ã“ã«ã‚ã‚‹ã‹
var card_labels = [];
var card_td = [];

var role_selector = [];

var reentry_pos = [];

var boarding_member = [];
var vehicle_driven =0;
var vehicle_destination = 0;


var nbr_player = 3;

var ex_act_count = 0;
var ex_select = 0;

var rewindable = true;//å·»ãæˆ»ã—ãƒ•ãƒ©ã‚°

var rerolled6 = false;
var rerolled8 = false;

var board_json;
var game_json;
var poi_json;
var hazmat_json;
var player_json;


var message_array = [];//ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¨˜éŒ²ç”¨å¤‰æ•°


//---ã‚¤ãƒ‹ã‚·ãƒ£ãƒ«-------------------------------

function init(){
	context = game_display.getContext('2d');
	init_map("first_easy");
	show_option(["tin","man"]);
	resize_board();
	window.onresize = resize_board;
	game_display.onclick = click_board;
	game_display.onmousemove = mousemove_board;
	
	game.scene = 0;
	game.phase = 0;	
	enter_start_menu();
}

//---ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©------------------------

function click_board(e){
	rect = game_display.getBoundingClientRect();
	click_x = e.clientX - rect.left;
	click_y = e.clientY - rect.top;

	click_cell_x = Math.floor(click_x / cell_size);
	click_cell_y = Math.floor(click_y / cell_size);

	if(game.scene==1){
		tutorial();
	}else if(game.scene==2){
		if(game.phase==1)	{check_fireengine_pos(click_cell_x,click_cell_y);}
		else if(game.phase==2)	{check_ambulance_pos(click_cell_x,click_cell_y);}
		else if(game.phase==3)	{check_player_pos(click_cell_x,click_cell_y);}
	}else if(game.scene==3){
		if(game.phase==0)	{convinient_choice(click_cell_x,click_cell_y);}
		else if(game.phase==1)	{player_move(game.turn,click_cell_x,click_cell_y);}
		else if(game.phase==2)	{chop(click_cell_x,click_cell_y);}
		else if(game.phase==3)	{extinguish(click_cell_x,click_cell_y);}
		else if(game.phase==4)	{}
		else if(game.phase==5)	{drive(click_cell_x,click_cell_y);}
		else if(game.phase==6)	{}
		else if(game.phase==7)	{}
		else if(game.phase==8)	{ex_action(click_cell_x,click_cell_y);}

	}else if(game.scene==4){
		if(game.phase==0)	{}//ã‚¿ãƒ¼ãƒ³çµ‚äº†ç¢ºèª
		else if(game.phase==1)	{flashover();}//ğŸ”¥
		else if(game.phase==2)	{hazmat_check();}//ãƒ•ãƒ©ãƒƒã‚·ãƒ¥ã‚ªãƒ¼ãƒãƒ¼
		else if(game.phase==3)	{hotspot_check();}//å±é™ºç‰©ãƒã‚§ãƒƒã‚¯
		else if(game.phase==4)	{dead_check();}//ãƒ›ãƒƒãƒˆã‚¹ãƒãƒƒãƒˆãƒã‚§ãƒƒã‚¯

	}else if(game.scene==5){
		if(game.phase==0)	{enter_start_menu();}//ã‚²ãƒ¼ãƒ ã‚¨ãƒ³ãƒ‰
		else if(game.phase==1)	{reentry(click_cell_x,click_cell_y);}//ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒªã‚¹ãƒãƒ¼ãƒ³åœ°ç‚¹é¸æŠ
		else if(game.phase==2)	{refill_poi();}//ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒªã‚¹ãƒãƒ¼ãƒ³ç¢ºèª
		else if(game.phase==3)	{pass_turn();}

	}

}

function mousemove_board(e){
	rect = game_display.getBoundingClientRect();
	mouse_x = e.clientX - Math.floor(rect.left);
	mouse_y = e.clientY - Math.floor(rect.top);

	mouse_cell_x = Math.floor(mouse_x / cell_size);
	mouse_cell_y = Math.floor(mouse_y / cell_size);
}

function click_rewind(){

	if(game.phase==0 && game.scene==3){
		load_game();
	}
}


function click_option(a){

	if(game.scene==0){//ã‚¹ã‚¿ãƒ¼ãƒˆãƒ¡ãƒ‹ãƒ¥ãƒ¼
		if(game.phase==0)	{branch_start_menu(a);}
		else if(game.phase==1)	{choose_difficulty(a);}//äººæ•°é¸æŠã‚’ä¼ãˆã¦é›£æ˜“åº¦ã‚’é¸ã°ã›ã‚‹
		else if(game.phase==2)	{choose_map(a);}//é›£æ˜“åº¦ã‚’ä¼ãˆã¦ãƒãƒƒãƒ—ã‚’é¸æŠã•ã›ã‚‹
		else if(game.phase==3)	{confirm_map(a);}//ãƒãƒƒãƒ—ã®ç¢ºèª
		else if(game.phase==4)	{final_confirm_to_start(a);}//ãã®çµæœã‚’ä¼ãˆã•ã›ã‚‹ã€‚
		else if(game.phase==5)	{choose_tutorial(a);}//ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã‚’é¸ã°ã›ã‚‹
		else if(game.phase==6)	{confirm_load_data(a);}//ãã®çµæœã‚’ä¼ãˆã•ã›ã‚‹ã€‚
	}else if(game.scene==1){
		tutorial();
	}else if(game.scene==2){//ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
		if(game.phase==0)	{check_role_dupe();}
		else if(game.phase==1)	{choose_start_pos();}//æ¶ˆé˜²è»Šè¨­ç½®
		else if(game.phase==2)	{choose_start_pos();}//æ•‘æ€¥è»Šè¨­ç½®
		else if(game.phase==3)	{choose_start_pos();}//ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼é–‹å§‹ä½ç½®é¸æŠ
		else if(game.phase==4)	{setup_last_check_responce(a);}//æœ€å¾Œã®ç¢ºèª
	}else if(game.scene==3){//ã‚¿ãƒ¼ãƒ³ä¸­ãƒ¡ã‚¤ãƒ³ãƒ•ã‚§ã‚¤ã‚º
		if(game.phase==0)	{action_select(a)}
		else if(game.phase==1)	{choose_action();}//ç§»å‹•
		else if(game.phase==2)	{choose_action();}//å£æ‰‰
		else if(game.phase==3)	{choose_action();}//æ¶ˆç«
		else if(game.phase==4)	{grab(a);}//æ´ã‚€
		else if(game.phase==5)	{drive(a);}//èµ°è¡Œ
		else if(game.phase==6)	{deckgun(a);}//æ”¾æ°´
		else if(game.phase==7)	{role_change_check();}//è·æ¥­ãƒã‚§ãƒ³ã‚¸
		else if(game.phase==8)	{ex_action(a);}//ç‰¹æ®Šã‚¢ã‚¯ã‚·ãƒ§ãƒ³

	}else if(game.scene==4){//çµ‚äº†ã‚¹ãƒ†ãƒƒãƒ—
		if(game.phase==0)	{enter_end_phase(a);}//ã‚¿ãƒ¼ãƒ³çµ‚äº†ç¢ºèª
		else if(game.phase==1)	{flashover();}//ğŸ”¥
		else if(game.phase==2)	{hazmat_check();}//ãƒ•ãƒ©ãƒƒã‚·ãƒ¥ã‚ªãƒ¼ãƒãƒ¼
		else if(game.phase==3)	{hotspot_check();}//å±é™ºç‰©ãƒã‚§ãƒƒã‚¯
		else if(game.phase==4)	{dead_check();}//ãƒ›ãƒƒãƒˆã‚¹ãƒãƒƒãƒˆãƒã‚§ãƒƒã‚¯
		else if(game.phase==5)	{continue_check(a);}//7äººç›®æ•‘å‡ºå¾Œã®ã‚³ãƒ³ãƒ†ã‚£ãƒ‹ãƒ¥ãƒ¼ã¡ã‚…ãˆã£ã

	}else if(game.scene==5){//ã‚¯ãƒªãƒ¼ãƒ³ãƒŠãƒƒãƒ—
		if(game.phase==0)	{enter_start_menu();}//ã‚²ãƒ¼ãƒ ã‚¨ãƒ³ãƒ‰
		else if(game.phase==1)	{reentry(a);}//ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒªã‚¹ãƒãƒ¼ãƒ³åœ°ç‚¹é¸æŠ
		else if(game.phase==2)	{refill_poi();}//ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒªã‚¹ãƒãƒ¼ãƒ³ç¢ºèª
		else if(game.phase==3)	{pass_turn();}//POIè£œå……
	}

}


//---------ã‚²ãƒ¼ãƒ é–¢é€£-------------------

function roll(){roll8();roll6();}//ãƒ€ã‚¤ã‚¹ã‚’æŒ¯ã‚‹
function roll6(){dice6 = Math.floor(Math.random()*6)+1;}//6é¢ãƒ€ã‚¤ã‚¹ã‚’æŒ¯ã‚‹
function roll8(){dice8 = Math.floor(Math.random()*8)+1;}//8é¢ãƒ€ã‚¤ã‚¹ã‚’æŒ¯ã‚‹
function invert6(){dice6 = 7 - dice6;}//6é¢ãƒ€ã‚¤ã‚¹ã‚’ã²ã£ãã‚Šè¿”ã™
function invert8(){dice8 = 9 - dice8;}//8é¢ãƒ€ã‚¤ã‚¹ã‚’ã²ã£ãã‚Šè¿”ã™


function init_map(str){//ãƒãƒƒãƒ—ã®èª­ã¿è¾¼ã¿

	board.tate = map[str].tate
	board.yoko = map[str].yoko

	board.hotspot = [];
	board.fire = [];
	board.wall_yoko = [];
	board.wall_tate = [];


	board.marker = [];
	board.ambulance_place = map[str].ambulance_place;
	board.fireengine_place = map[str].fireengine_place;
	board.poi_move = [];
	board.poi_end = map[str].poi_end;
	board.ambulance_pos = -1;
	board.fireengine_pos = -1;

	for(var x=0;x<board.yoko;x++){
		board.hotspot[x]=[];
		board.fire[x]=[];
		board.wall_tate[x]=[];
		board.wall_yoko[x]=[];
		board.marker[x]=[];
		board.poi_move[x] = [];
		for(var y=0;y<board.tate;y++){
			board.hotspot[x][y] =0;
			board.fire[x][y] =0;
			board.marker[x][y] =0;
			board.poi_move[x][y] = map[str].poi_move[y][x];
			board.wall_tate[x][y] = map[str].wall_tate[y][x];
			board.wall_yoko[x][y] = map[str].wall_yoko[y][x];
		}
	}
	poi=[];
	player=[];
	hazmat=[];
	draw_board();	
}

function setup_game(){//ç›¤é¢ã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

	game.scene = 2;
	game.phase = 0;

	//ãƒãƒ¼ã‚«ãƒ¼ã®åˆæœŸåŒ–
	hazmat = [];
	poi = [];
	player = [];
	board.hotspot = [];
	board.fire_barker = [];
	board.ambulance_pos = -1;
	board.fireengine_pos = -1;
	for(var x=0;x<board.yoko;x++){
		board.hotspot[x]=[];
		board.fire[x]=[];
		for(var y=0;y<board.tate;y++){
			board.hotspot[x][y] =0;
			board.fire[x][y] =0;
		}
	}

	game.damage = 24;
	game.alive = 0;
	game.dead = 0;

	game.victim_rest = 10;
	game.false_rest = 5;

	game.poi_rest = game.victim_rest + game.false_rest;


	if(game.difficulty<0){
		board.fire[2][2]=2;
		board.fire[3][2]=2;
		board.fire[2][3]=2;
		board.fire[3][3]=2;
		board.fire[4][3]=2;
		board.fire[5][3]=2;
		board.fire[4][4]=2;
		board.fire[6][5]=2;
		board.fire[7][5]=2;
		board.fire[6][6]=2;
		
		poi.push({x:4,y:2,grab:0,who:0,status:1});game.poi_rest--;
		poi.push({x:1,y:5,grab:0,who:0,status:1});game.poi_rest--;
		poi.push({x:8,y:5,grab:0,who:0,status:1});game.poi_rest--;


		for(var i=0;i<nbr_player;i++){
			tmp="p"+(i+1);
			player.push({n:i+1,x:-1,y:0,color:p_color[i],chara:tmp,role:"generalist",grab:[],ap:0});
		}
		choose_start_pos();
	}else{
		//æœ€åˆã®çˆ†ç™º
		roll();
		dice6=dice6%2+3;
		dice8=dice8%4+3;
		board.hotspot[dice8][dice6]=1;
		board.fire[dice8][dice6]=2;
		explode(dice8,dice6);

		//äºŒå›ç›®ã®çˆ†ç™º
		roll();
		while(board.fire[dice8][dice6]!=0){roll();}
		board.hotspot[dice8][dice6]=1;
		board.fire[dice8][dice6]=2;
		explode(dice8,dice6);
	
		//ä¸‰å›ç›®ã®çˆ†ç™º
		invert8();
		while(board.fire[dice8][dice6]!=0){roll6();}
		board.hotspot[dice8][dice6]=1;
		board.fire[dice8][dice6]=2;	
		explode(dice8,dice6);

		//è‹±é›„ç”¨ã®å››å›ç›®ã®çˆ†ç™º
		if(game.difficulty==2){
			roll();
			board.hotspot[dice8][dice6]=1;
			board.fire[dice8][dice6]=2;
			explode(dice8,dice6);
		}

		//å±é™ºç‰©ã®è¨­ç½®
		for(var i=0;i<3+game.difficulty;i++){
			roll();
			while(board.fire[dice8][dice6]!=0){roll();}
			hazmat.push({x:dice8,y:dice6,grab:0,who:0,status:1});
		}

		//POIã®è¨­ç½®
		for(var i=0;i<3;i++){
			roll();
			while(board.fire[dice8][dice6]!=0){roll();}
			poi.push({x:dice8,y:dice6,grab:0,who:0,status:1});
			game.poi_rest--;
		}
		clear_message();
		add_message("ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®ãƒ­ãƒ¼ãƒ«ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚");
		show_role(nbr_player);	
		//çˆ†ç™ºå¾Œã®å¤–å‘¨ã®æ¶ˆç«
		extinguish_around();
	}



	draw_board();
}


function check_role_dupe(){//ãƒ­ãƒ¼ãƒ«ã®é‡è¤‡ãƒã‚§ãƒƒã‚¯

	for(var i=0;i<role_selector.length;i++){
		for(j=i+1;j<role_selector.length;j++){
			if(role_selector[i].value == role_selector[j].value){
				clear_message();
				add_message("åŒã˜ãƒ­ãƒ¼ãƒ«ãŒè¤‡æ•°ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã§é¸æŠã•ã‚Œã¦ã„ã¾ã™ã€‚");
				add_message("é‡è¤‡ãŒãªã„ã‚ˆã†ãƒ­ãƒ¼ãƒ«ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚");
				return false;
			}
		}
	}

	player = [];

	for(var i=0;i<role_selector.length;i++){
		tmp="p"+(i+1);
		player.push({n:i+1,x:-1,y:0,color:p_color[i],chara:tmp,role:role_selector[i].value,grab:[],ap:0});
		console.log("ã‚­ãƒ£ãƒ©"+i+"ã¯"+role_selector[i].value+"ã§ç™»éŒ²");
	}

	additional_hotspot();
}

function additional_hotspot(){//è¿½åŠ ã®é«˜æ¸©ç‚¹

	var tmp = 0;
	if(game.difficulty>0){
		tmp+=3;
	}
	if(game.turn>3){
		tmp+= 3;
	}else{
		tmp+= 2;
	}

	for(var i = 0;i<tmp;i++){
		roll();
		while(board.hotspot[dice8][dice6]!=0){roll();}
		board.hotspot[dice8][dice6]=1;
		console.log("åœ°ç‚¹["+dice8+","+dice6+"]ã«è¿½åŠ ã®é«˜æ¸©ç‚¹");
	}

	game.hotspot_remain = 6;
	if(game.difficulty >= 2){game.hotspot_remain=12;}

	add_message("è¿½åŠ ã®é«˜æ¸©ç‚¹ã‚’æŒ¯ã‚Šåˆ†ã‘ãŸã€‚");
	choose_start_pos();
}

function choose_start_pos(){
	show_option(["ã‚„ã‚ŠãªãŠã™"]);
	game.scene=2;
	game.phase=1;
	game.turn = 0;
	board.fireengine_pos=-1;
	board.ambulance_pos=-1;
	for(var i=0;i<player.length;i++){
		player[i].x=-1;
	}
	if(game.difficulty < 0){choose_player_pos();}
	else{choose_fireengine_pos();}
	draw_board();
}

function choose_fireengine_pos(){
	clear_message();
	add_message("æ¶ˆé˜²è»Šã®ä½ç½®(<span style='background-color:"+fireengine_color+"'>ã€€</span>)ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚");
}

function check_fireengine_pos(xx,yy){
	var tmp=-1;
	for(var i=0;i<board.fireengine_place.length;i++)
	for(var j=0;j<board.fireengine_place[i].length;j++)
	if(board.fireengine_place[i][j][0]==xx && board.fireengine_place[i][j][1]==yy)tmp=i;

	if(tmp>=0){
		board.fireengine_pos = tmp;
		draw_board();
		choose_ambulance_pos();
	}
}

function choose_ambulance_pos(){
	game.phase = 2;	
	clear_message();
	add_message("æ•‘æ€¥è»Šã®ä½ç½®(<span style='background-color:"+ambulance_color+"'>ã€€</span>)ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚");
}

function check_ambulance_pos(xx,yy){
	var tmp = -1;
	for(var i=0;i<board.ambulance_place.length;i++)
	for(var j=0;j<board.ambulance_place[i].length;j++)
	if(board.ambulance_place[i][j][0]==xx && board.ambulance_place[i][j][1]==yy)tmp=i;

	if(tmp>=0){
		board.ambulance_pos = tmp;
		draw_board();
		choose_player_pos();
	}
}

function choose_player_pos(){
	game.phase=3;
	clear_message();
	add_message((game.turn+1)+"äººç›®ã®ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼é§’ã®ä½ç½®ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚");
}

function check_player_pos(xx,yy){

	if(xx!=0 && xx!=board.yoko-1 && yy!=0 && yy!=board.tate-1)return false;

	player[game.turn].x = xx;
	player[game.turn].y = yy;

	draw_board();
	game.turn++;
	if(game.turn<player.length){
		choose_player_pos();
	}else{
		setup_last_check();
	}
}

function setup_last_check(){
	game.phase = 4;
	clear_message();
	add_message("ã“ã®ã‚¹ã‚¿ãƒ¼ãƒˆä½ç½®ã§ã‚ˆã‚ã—ã„ã§ã—ã‚‡ã†ã‹ï¼Ÿ");
	show_option(["ã¯ã„","ã€€","ã„ã„ãˆ"]);
}

function setup_last_check_responce(a){
	if(a==0){
		game.turn = 0;
		take_my_turn();
	}
	if(a==2){choose_start_pos();}
}


//--ã‚¿ãƒ¼ãƒ³ä¸­ã®å‹•ä½œ--------------------------

function take_my_turn(){
	game.scene = 3;
	clear_message();
	if(game.difficulty<0){
		game.ap = 4 + player[game.turn].ap;
		game.sap = 0;
	}else{
		player[game.turn].ex_act = [];
		game.ap = role[player[game.turn].role].ap+player[game.turn].ap;
		game.sap = role[player[game.turn].role].sap;
	}
	rewindable = false;
	choose_action();
}

function save_game(){
	board_json = JSON.stringify(board);
	game_json = JSON.stringify(game);
	player_json = JSON.stringify(player);
	poi_json = JSON.stringify(poi);
	hazmat_json = JSON.stringify(hazmat);

	localStorage.setItem("scatolo's_rescue_board",board_json);
	localStorage.setItem("scatolo's_rescue_game",game_json);
	localStorage.setItem("scatolo's_rescue_player",player_json);
	localStorage.setItem("scatolo's_rescue_poi",poi_json);
	localStorage.setItem("scatolo's_rescue_hazmat",hazmat_json);
}

function load_game(){
	var vvv=game.version;
	board = JSON.parse(board_json);
	game = JSON.parse(game_json);
	player = JSON.parse(player_json);
	poi = JSON.parse(poi_json);
	hazmat = JSON.parse(hazmat_json);
	game.version = vvv;
	if(game.scene==3 && game.phase ==0){
		clear_message();
		choose_action();
	}else if(game.scene==4 && game.phase ==1){
		clear_message();
		add_message("ãƒ­ãƒ¼ãƒ‰å®Œäº†ã€‚åœ°ç‚¹["+game.firespot_x+","+game.firespot_y+"]ã®ç‚ã®æ‹¡å¤§ã‹ã‚‰å†é–‹ã€‚");
		show_option(["æ¬¡ã¸"]);
		
	}else if(game.scene==5 && game.phase ==3){
		clear_message();
		add_message("ãƒ­ãƒ¼ãƒ‰å®Œäº†ã€‚ä¸å¯©ç®‡æ‰€ã‚’è£œå……ã—ãŸæ™‚ç‚¹ã‹ã‚‰å†é–‹ã€‚");
		show_option(["æ¬¡ã¸"]);
		
	}
}
function choose_action(){
	draw_board();
	game.scene = 3;
	game.phase = 0;
	if(collapse_check()){return false;}
	add_message("ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚");
	var sss = [];
	var tmp = "";
	if(player[game.turn].grab.length==0){sss.push("ç§»å‹•");}
	else{
		for(var i=0;i<player[game.turn].grab.length;i++){
			if(player[game.turn].grab[i][0]==1){
				if(poi[player[game.turn].grab[i][1]].status==1)tmp += emoji["poi"].chara;
				if(poi[player[game.turn].grab[i][1]].status==2)tmp += emoji["victim"].chara;
				if(poi[player[game.turn].grab[i][1]].status==3)tmp += emoji["healed"].chara;
			}
			if(player[game.turn].grab[i][0]==2)tmp += emoji["hazmat"].chara;
		}
		sss.push("é‹ã¶("+tmp+")");
	}
	sss.push("æ‰‰ã®é–‹é–‰/å£ã‚’å£Šã™");
	sss.push("æ¶ˆç«");
	sss.push("ã¤ã‹ã‚€/æ‰‹æ”¾ã™");
	if(game.difficulty>=0){
		sss.push("è»Šä¸¡ã®é‹è»¢");
		sss.push("æ¶ˆé˜²è»Šã®æ”¾æ°´");
		sss.push("ãƒ­ãƒ¼ãƒ«ã®å¤‰æ›´");
		for(var i=0;i<role[player[game.turn].role].ex_action.length;i++)//ç‰¹æ®Šã‚ãã—ã‚‡ã‚“
			sss.push(role[player[game.turn].role].ex_action[i].name);
	}
	show_option(sss);
	if(rewindable==false){
		save_game();
		rewindable = true;
	}
}

function convinient_choice(xx,yy){

	if(player[game.turn].x!=xx && player[game.turn].y!=yy)return false;
	if(player[game.turn].x==xx && Math.abs(player[game.turn].y-yy)!=1) return false;
	if(player[game.turn].y==yy && Math.abs(player[game.turn].x-xx)!=1) return false;

	var xm;
	var ym;
	var wall;
	if(player[game.turn].x==xx){wall = board.wall_tate;}
	if(player[game.turn].y==yy){wall = board.wall_yoko;}

	xm = Math.min(xx,player[game.turn].x);
	ym = Math.min(yy,player[game.turn].y);

	clear_message();

	if(wall[xm][ym]>2){choose_action();return false;}
	if(wall[xm][ym]==2){chop(xx,yy);return true;}

	if(board.fire[xx][yy]>0){extinguish(xx,yy);return false;}
	else{player_move(game.turn,xx,yy);return false;}
}

function action_select(a){
	if(a==0){
		game.phase = 1;
		clear_message();
		add_message("ç§»å‹•å…ˆã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚");
		show_option(["ã‚„ã‚ã‚‹"]);	
	}else if(a==1){
		game.phase = 2;
		clear_message();
		add_message("ã©ã¡ã‚‰ã®æ–¹å‘ã®æ‰‰ã‚’é–‹é–‰ï¼ˆå£ã‚’ç ´å£Šï¼‰ã—ã¾ã™ã‹ï¼Ÿ");
		show_option(["ã‚„ã‚ã‚‹"]);	
	}else if(a==2){
		game.phase = 3;
		clear_message();
		add_message("ã©ã®ç…™ãƒ»ç‚ã‚’æ¶ˆã—ã¾ã™ã‹ï¼Ÿ");
		show_option(["ã‚„ã‚ã‚‹"]);	
	}else if(a==3){
		game.phase = 4;
		clear_message();
		var sss = [];
		for(var i=0;i<poi.length;i++){
			if(poi[i].x==player[game.turn].x && poi[i].y==player[game.turn].y){
				if(poi[i].status>0){sss.push(poi_name[poi[i].status]);}
			}
		}
		for(var i=0;i<hazmat.length;i++){
			if(hazmat[i].x==player[game.turn].x && hazmat[i].y==player[game.turn].y){
				if(hazmat[i].status==1){sss.push("å±é™ºç‰©");}
			}
		}
		if(sss.length>0){
			add_message("ã©ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’æ´ã¿ã¾ã™ã‹ï¼Ÿ");
			sss.push("ä½•ã‚‚æŒãŸãªã„");
			show_option(sss);
		}else{
			add_message("ãã“ã«ã¯ä½•ã‚‚ãªã„ï¼");
			choose_action();
		}
		
	}else if(a==4){
		if(is_payable(5)==false){add_message("ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒã‚¤ãƒ³ãƒˆãŒè¶³ã‚Šãªã„ï¼");choose_action();return false;}
		game.phase = 5;
		boarding_member = [];
		vehicle_driven = 0;
		vehicle_destination = 0;
		clear_message();
		add_message("è»Šä¸¡ã®è¡Œãå…ˆã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚");
		show_option(["ã‚„ã‚ã‚‹"]);
	}else if(a==5){
		game.phase = 6;
		clear_message();
		var car = board.fireengine_place[board.fireengine_pos];
		var tmp = false;

		if(is_payable(6)==false){
			add_message("ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒã‚¤ãƒ³ãƒˆãŒè¶³ã‚Šãªã„ï¼");
			choose_action();
			return false;
		}

		for(i=0 ;i<player.length;i++){
			if(is_in_sight(i)){
				console.log((i+1)+"ãŒã„ã‚‹!");
				add_message("æ”¾æ°´ç¯„å›²ã«ä»–ã®ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãŒã„ã‚‹ï¼");
				choose_action();
				return false;
			}
		}
		for(i=0 ;i<car.length;i++){
			if(player[game.turn].x== car[i][0] &&player[game.turn].y== car[i][1]){
				tmp =true;
			}
		}
		
		if(tmp){
			rerolled6 = true;
			rerolled8 = true;
			add_message("æ¶ˆé˜²è»Šã‹ã‚‰æ”¾æ°´ã—ã¾ã™ã‹ï¼Ÿ");
			show_option(["ã¯ã„","ã€€","ã„ã„ãˆ"]);
		}else{
			add_message("ã„ã¾æ¶ˆé˜²è»Šã®æ‰€ã«ã„ãªã„ï¼");
			choose_action();
		}

	}else if(a==6){
		game.phase = 7;
		clear_message();
		if(role[player[game.turn].role].ap + player[game.turn].ap != game.ap || role[player[game.turn].role].sap != game.sap){
			add_message("ã‚¿ãƒ¼ãƒ³ã®ã¯ã˜ã‚ã§ãªã‘ã‚Œã°å¤‰æ›´ã§ããªã„ã€‚");
			choose_action();
			return;
		}
		var tmp = false;
		for(var i = 0;i<board.fireengine_place[board.fireengine_pos].length;i++){
			if(board.fireengine_place[board.fireengine_pos][i][0] == player[game.turn].x && board.fireengine_place[board.fireengine_pos][i][1] == player[game.turn].y){
				tmp = true;
			}
		}
		if(tmp){
			add_message("ãƒ­ãƒ¼ãƒ«ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚");
			show_role(1);
		}else{
			add_message("æ¶ˆé˜²è»Šã«ã„ãªã„ã¨å¤‰æ›´ã§ããªã„ã€‚");
			choose_action();
		}
	}else if(a>=7){
		game.phase = 8;
		ex_act_count = a-7;
		ex_select = 0;
		ex_action(a);
	}
}

function player_move(who,xx,yy){
	if(player[who].x!=xx && player[who].y!=yy)return false;
	if(player[who].x==xx && Math.abs(player[who].y-yy)!=1) return false;
	if(player[who].y==yy && Math.abs(player[who].x-xx)!=1) return false;

	if(player[who].x==xx && board.wall_tate[xx][Math.min(yy,player[who].y)]>1)return false;
	if(player[who].y==yy && board.wall_yoko[Math.min(xx,player[who].x)][yy]>1)return false;


	if(is_payable(1,who,xx,yy)==false){add_message("ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒã‚¤ãƒ³ãƒˆãŒè¶³ã‚Šãªã„ï¼");choose_action();return false;}
	if(board.fire[xx][yy]==2 && player[who].grab.length>0){
		if(player[who].grab[0][0]==1){
			add_message("è¦æ•‘åŠ©è€…ã‚’é€£ã‚Œã¦ã„ã‚‹ã¨ãã«ç‚ã«ä¾µå…¥ã™ã‚‹ã‚ã‘ã«ã¯ã„ã‹ãªã„ï¼");
			choose_action();
			return false;
		}
		if(player[who].grab[0][0]==2){
			add_message("å±é™ºç‰©ã‚’æŒã£ã¦ã„ã‚‹ã¨ãã«ç‚ã«ä¾µå…¥ã™ã‚‹ã‚ã‘ã«ã¯ã„ã‹ãªã„ï¼");
			choose_action();
			return false;
		}
	}

	player[who].x=xx;
	player[who].y=yy;

	for(var i=0;i<player[game.turn].grab.length;i++){
		if(player[who].grab[i][0]==1){
			poi[player[who].grab[i][1]].x=xx;
			poi[player[who].grab[i][1]].y=yy;
		}else if(player[who].grab[i][0]==2){
			hazmat[player[who].grab[i][1]].x=xx;
			hazmat[player[who].grab[i][1]].y=yy;
		}
	}
	pay_cost(1,who,xx,yy);

	//ä¸ä¿¡å€‹æ‰€ã®é–‹ç¤º

	for(var i=0;i<poi.length;i++){
		if(poi[i].x == xx && poi[i].y == yy && poi[i].status == 1){
			flip_poi(i);rewindable = false;
		}
	}


	if(resolve_grab()==false){
		choose_action();

		return true;
	}
}

function resolve_grab(){

	var alive_adding=false;
	var car = board.ambulance_place[board.ambulance_pos];
	for(var i=0;i<poi.length;i++){
		if(game.difficulty<0){

			if(poi[i].x == 0 || poi[i].x >= board.yoko-1 || poi[i].y == 0 || poi[i].y >= board.tate-1){
				if(poi[i].status >= 2){
					if(poi[i].grab>0){release(1,i);}
					poi[i].status=0;
					game.alive++;
					alive_adding=true;
					add_message("è¦æ•‘åŠ©è€…ã‚’æ¬é€ã—ãŸã€‚");
				}
			}
		}else{
			for(var j=0;j<car.length;j++){
				if(poi[i].x == car[j][0] && poi[i].y == car[j][1] && poi[i].status >= 2){
					if(poi[i].grab>0){release(1,i);}
					poi[i].status=0;
					game.alive++;
					alive_adding=true;
					add_message("è¦æ•‘åŠ©è€…ã‚’æ¬é€ã—ãŸã€‚");
				}
			}
		}
	}

	for(var i=0;i<hazmat.length;i++){
		if(hazmat[i].x == 0 || hazmat[i].x >= board.yoko-1 || hazmat[i].y == 0 || hazmat[i].y >= board.tate-1){
			
			if(hazmat[i].status>0){
				if(hazmat[i].grab>0){release(hazmat[i].who);}
				hazmat[i].status = 0;
				add_message("å±é™ºç‰©ã‚’å‡¦åˆ†ã—ãŸã€‚");
			}
		}
	}

	if((game.alive==7 || game.alive+game.dead>=10) && alive_adding){
		add_message("å‹åˆ©ï¼ã“ã®ã‚²ãƒ¼ãƒ ã‚’çµ‚äº†ã—ã¾ã™ã‹ï¼Ÿ");
		game.scene=4;
		game.phase=5;
		show_option(["ç¶šã‘ã‚‹","ã€€","ã‚¿ã‚¤ãƒˆãƒ«ã«æˆ»ã‚‹"]);
		draw_board();
		return true;
	}else if(game.alive>=10 ){
		add_message("å®Œã€€å…¨ã€€å‹ã€€åˆ©ã€€ï¼ã€€ã™ã¹ã¦ã®è¦æ•‘åŠ©è€…ã‚’æ•‘ã„å‡ºã—ãŸï¼");
		game.scene=5;
		game.phase=0;
		show_option(["ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã«æˆ»ã‚‹"]);
		draw_board();
		return true;
	}else if(game.alive>=7 && game.alive+game.dead>=10 ){
		add_message("å‹åˆ©ï¼ã„ãã‚‰ã‹ã®çŠ ç‰²è€…ã¯å‡ºãŸãŒã€ã™ã¹ã¦ã®è¦æ•‘åŠ©è€…ãŒåˆ¤æ˜ã—å¯¾å¿œã‚’çµ‚ãˆãŸã€‚");
		game.scene=5;
		game.phase=0;
		show_option(["ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã«æˆ»ã‚‹"]);
		draw_board();
		return true;
	}


	return false;
}

function is_can_go_safe(xx,yy,p,d){//æ®‹ã‚ŠAPã§ãã“ã«ã„ã¦å®‰å…¨ã‹ã®åˆ¤å®š
	//if(p<0){console.log("pãŒ0æœªæº€ã§æŠ•ã’ã‚‰ã‚Œã¦ã‚‹ï¼");}
	//console.log("x:"+xx+" y:"+yy+" p:"+p+" d:"+d);
	if(board.fire[xx][yy]<2)return true;

	var vd = board.fire[xx][yy];
	var vp = p;
	if(player[game.turn].role=="cafs"){vp+=game.sap;}

	//è¶³ä¸‹ã‚’æ¶ˆç«ã—ã¦é›£ã‚’é€ƒã‚Œã‚‰ã‚Œã‚‹ã‹
	while(vp>0){
		vd--;vp--;
		if(role[player[game.turn].role].dis_ex==true)vp--;
		if(vd < 2 && vp >=0){return true;}	
	};

	for(var i=0;i<4;i++){
		var xm = Math.round(xx+Math.sin(i*Math.PI/2));
		var ym = Math.round(yy+Math.cos(i*Math.PI/2));
		vp =p;
		vd =d;
		var vw ;
		
		if(player[game.turn].role=="rescue"){vp += game.sap;}

		if(xm==xx){vw = board.wall_tate[xx][Math.min(yy,ym)];}
		if(ym==yy){vw = board.wall_yoko[Math.min(xx,xm)][yy];}

		//æ™®é€šã¯ç„¡å‚·ã®å£ã‚’å£Šã—ã¦ã¾ã§å‹•ããã‚‰ã„ãªã‚‰è¶³ä¸‹ã®ç«ã‚’ç…™ã«ã—ãŸæ–¹ãŒæ—©ã„ã‘ã©
		//ã‚¨ã‚¯ã‚¹ãƒ‘ãƒ³ã‚·ãƒ§ãƒ³ã§æ¶ˆç«ãŒå‡ºæ¥ãªã„ã‚„ã¤ãŒã„ã‚‹ã‚‰ã—ã„ã®ã§ã¡ã‚ƒã‚“ã¨åˆ¤å®šã‚’ä½œã£ã¦ãŠã
		if(vw==3){
			if(player[game.turn].role=="rescue"){vp-=3;vd-=2;}
			else{vp-=5;vd-=2;}
		}else if(vw==2){
			if(player[game.turn].role=="rescue"){vp-=2;vd-=1;}
			else{vp-=3;vd-=1;}
		} if(vw==2){
			vp-=2;
		}else{
			vp-=1;
		}

		if(vp<0 || vd<=0) continue;

		if(board.fire[xm][ym]<2)return true;		
		if(is_can_go_safe(xm,ym,vp,vd)){return true;}
	}
	
	return false;
}



function chop(xx,yy){

	if(player[game.turn].x!=xx && player[game.turn].y != yy)return false;
	if(player[game.turn].x==xx && Math.abs(player[game.turn].y-yy) != 1) return false;
	if(player[game.turn].y==yy && Math.abs(player[game.turn].x-xx) != 1) return false;

	//console.log("ã¨ãªã‚Šã§ã¯ã‚ã‚‹");
	var wall;
	if(player[game.turn].x==xx){wall = board.wall_tate;}
	if(player[game.turn].y==yy){wall = board.wall_yoko;}

	//console.log("xx:" + xx +"  p.x:"+player[game.turn].x);
	//console.log("yy:" + yy +"  p.y:"+player[game.turn].y);

	xx = Math.min(xx,player[game.turn].x);
	yy = Math.min(yy,player[game.turn].y);

	//console.log("[" + xx +","+yy+"]ã‚’å£Šã™");
	

	if(wall[xx][yy]==0)return false;


	if(is_payable(2,wall[xx][yy])==false){add_message("ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒã‚¤ãƒ³ãƒˆãŒè¶³ã‚Šãªã„ï¼");choose_action();return false;}


	//console.log("ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚‚ååˆ†ã‚ã‚‹");
	//if(is_can_go_safe(player[game.turn].x,player[game.turn].y,game.ap-action_cost(2,wall[xx][yy]),game.damage)==false){
	//		add_message("ç‚ã®ãªã‹ã§ãã‚“ãªã“ã¨ã‚’ã—ã¦ã„ã‚‹å ´åˆã§ã¯ãªã„ï¼");
	//		return false;
	//}
	
	pay_cost(2,wall[xx][yy]);
	
	if(wall[xx][yy] >= 3){deal_damage();}
	clear_message();

	if(wall[xx][yy] ==4 ){
		add_message("å£ã«ãƒ’ãƒ“ã‚’å…¥ã‚ŒãŸã€‚");
	}else if(wall[xx][yy]==3){
		add_message("å£ã‚’å£Šã—é–‹é€šã•ã›ãŸã€‚");
	}else if(wall[xx][yy]==2){
		add_message("æ‰‰ã‚’é–‹ã‘ãŸã€‚");
	}else if(wall[xx][yy]==1){
		add_message("æ‰‰ã‚’é–‰ã‚ãŸã€‚");
	}

	wall[xx][yy] = wall_next_status(wall[xx][yy]);

	if(collapse_check()){return false;}
	else{choose_action();}
}

function wall_next_status(a){
	if(a==4)return 3;
	if(a==3)return 0;
	if(a==2)return 1;
	if(a==1)return 2;
}


function extinguish(xx,yy){
	if(player[game.turn].x!=xx && player[game.turn].y!=yy)return false;
	if(player[game.turn].x==xx && Math.abs(player[game.turn].y-yy)>1)return false;
	if(player[game.turn].y==yy && Math.abs(player[game.turn].x-xx)>1)return false;
	if(board.fire[xx][yy]==0) return false;

	if(player[game.turn].x != xx || player[game.turn].y != yy ){
		if(player[game.turn].x==xx && board.wall_tate[xx][Math.min(yy,player[game.turn].y)]>1)return false;
		if(player[game.turn].y==yy && board.wall_yoko[Math.min(xx,player[game.turn].x)][yy]>1)return false;
	}

	if(is_payable(3)==false){add_message("ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒã‚¤ãƒ³ãƒˆãŒè¶³ã‚Šãªã„ï¼");choose_action();return false;}


	board.fire[xx][yy]--;


	if(is_can_go_safe(player[game.turn].x,player[game.turn].y,game.ap-action_cost(3),game.damage)==false){
			add_message("ç‚ã®ä¸­ã«ã„ã‚‹ã®ã«éš£ã‚’æ¶ˆã—ã¦ã„ã‚‹å ´åˆã§ã¯ãªã„ï¼");
			board.fire[xx][yy]++;
			return false;
	}

	pay_cost(3);
	choose_action();
}

function grab(a,who = game.turn){

	for(var i=0;i<poi.length;i++){
		if(poi[i].x==player[who].x && poi[i].y==player[who].y && poi[i].status!=0){
			a--;
			if(a<0){
				switch_grabbing(who,1,i);
				choose_action();
				return true;
			}
		}
	}
	for(var i=0;i<hazmat.length;i++){
		if(hazmat[i].x==player[who].x && hazmat[i].y==player[who].y && hazmat[i].status!=0){
			a--;
			if(a<0){
				switch_grabbing(who,2,i);
				choose_action();
				return true;
			}
		}
	}
	if(a==0)release(who);
	choose_action();
}

function switch_grabbing(who,what,which){

	var mono;

	if(what==1)mono = poi;
	if(what==2)mono = hazmat;

	for(var i=0;i<player[who].grab.length;i++){
		if(player[who].grab[i][0]==what && player[who].grab[i][1]==which){
			release(what,which);
			if(what==2){add_message("å±é™ºç‰©ã‚’æ‰‹æ”¾ã—ãŸã€‚");}
			if(what==1){add_message(poi_name[mono[which].status]+"ã‚’æ‰‹æ”¾ã—ãŸã€‚");}
			return true;
		}
	}

	if(what==2){
		release(who);
		release(what,which);
		player[who].grab.push([2,which])
		mono[which].grab = 1;
		mono[which].who= who;
		add_message("å±é™ºç‰©ã‚’ã¤ã‹ã‚“ã ã€‚");
		return true;
	}
	if(what==1){
		for(var i=0;i<hazmat.length;i++){
			if(hazmat[i].status>0 && hazmat[i].grab==1 && hazmat[i].who==who ){
					release(2,i);
			}
		}
		if(mono[which].status==3){
			for(var i=0;i<poi.length;i++){
				if(poi[i].status==3 && poi[i].grab==1 && poi[i].who==who ){
					release(1,i);
				}
			}
		}else{
			for(var i=0;i<poi.length;i++){
				if(poi[i].status<3 && poi[i].grab==1 && poi[i].who==who ){
					release(1,i);
				}
			}
		}
		release(what,which);
		player[who].grab.push([1,which])
		mono[which].grab = 1;
		mono[which].who= who;
		add_message(poi_name[mono[which].status]+"ã‚’ã¤ã‹ã‚“ã ã€‚");
		return true;
		

	}
}


function release(p,whi=-1){
	var mono;
	if(whi<0){
		for(var i=0;i<player[p].grab.length;i++){
			if(player[p].grab[i][0]==1)mono = poi;
			if(player[p].grab[i][0]==2)mono = hazmat;
			mono[player[p].grab[i][1]].grab=0;
			mono[player[p].grab[i][1]].who=0;
		}
		player[p].grab = [];

	}else{

		if(p==1)mono = poi;
		if(p==2)mono = hazmat;

		if(mono.grab==0)return false;

		for(var i=0;i<player[mono[whi].who].grab.length;i++){
			if(player[mono[whi].who].grab[i][0] == p && player[mono[whi].who].grab[i][1] == whi)
				player[mono[whi].who].grab.splice(i,1);
		}

		mono[whi].grab=0;
		mono[whi].who=0;
	}
	
}

function drive(xx,yy = -1){//è»Šä¸¡ã®èµ°è¡Œå‡¦ç†ã€‚
	var pos;
	if(vehicle_driven==1){pos = board.fireengine_pos;}
	if(vehicle_driven==2){pos = board.ambulance_pos;}

	if(vehicle_driven==0){choose_stop_spot(xx,yy);}
	else if(vehicle_destination != pos){choose_riding_player(xx,yy);}
	else{choose_dismount_pos(xx,yy);}
}

function choose_stop_spot(xx,yy){//å ´æ‰€æŒ‡å®šã®ã‚¯ãƒªãƒƒã‚¯ãŒãªã•ã‚ŒãŸã‚‰ã€‚

	if(yy<0){choose_action();return false;}

	var pos;
	var car;
	var im_here = -1;

	//ã‚¯ãƒªãƒƒã‚¯ã•ã‚ŒãŸã¨ã“ã‚ãŒã©ã®è»Šç¨®ã®ã©ã“ã®ãƒã‚¸ã‚·ãƒ§ãƒ³ã‹è¦‹ã‚‹
	car = board.ambulance_place;
	pos = board.ambulance_pos;
	for(var i=0;i<car.length;i++){
		for(var j=0;j<car[i].length;j++){
			if(xx == car[i][j][0] && car[i][j][1] == yy){
				vehicle_driven = 2;
				vehicle_destination = i;
			}
		}
	}

	car = board.fireengine_place;
	pos = board.fireengine_pos;
	for(var i=0;i<car.length;i++){
		for(var j=0;j<car[i].length;j++){
			if(player[game.turn].x == car[i][j][0] && player[game.turn].y == car[i][j][1]){
				im_here =i;
			}
			if(xx == car[i][j][0] && car[i][j][1] == yy){
				vehicle_driven = 1;
				vehicle_destination = i;
			}
		}
	}
				
	if(vehicle_driven==1){
		car = board.fireengine_place;
		pos = board.fireengine_pos;
	}else if(vehicle_driven==2){
		car = board.ambulance_place;
		pos = board.ambulance_pos;
	}else{
		return false;
	}

	if(vehicle_driven==1 && pos != im_here){
		add_message("ã„ã¾ã‚ãªãŸã¯æ¶ˆé˜²è»ŠãŒé§ã¾ã£ã¦ã„ã‚‹ã¨ã“ã‚ã«ã„ãªã„ã€‚");choose_action();return false;
	}else if(vehicle_destination == pos){
		add_message("æ—¢ã«ãã“ã«åœè»Šã—ã¦ã„ã‚‹ã€‚");choose_action();return false;
	}else if(vehicle_destination != (pos+1)%car.length && vehicle_destination != (pos-1+car.length)%car.length){
		add_message("ã„ã¾åœè»Šã—ã¦ã„ã‚‹ä½ç½®ã‹ã‚‰è¦‹ã¦éš£ã®åœè»Šä½ç½®ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚");choose_action();return false;
	}

	pay_cost(5);

	//åŒã˜ã‚¹ãƒšãƒ¼ã‚¹ã«ã„ã‚‹ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’boarding_memberã«ã™ã‚‹
	boarding_member = [];
	//ä¹—ã›ã‚‹ã‹ã©ã†ã‹åˆ¤æ–­ã™ã¹ãäººãŒã„ã‚‹ã‹ã®ãƒ•ãƒ©ã‚°
	var tmp = false;
	for(var i=0;i<player.length;i++){
		for(var j=0;j<car[pos].length;j++){
			if(player[i].x == car[pos][j][0] && car[pos][j][1] == player[i].y){
				if(i==game.turn && vehicle_driven==1){boarding_member.push({n:i,r:2});}
				else{boarding_member.push({n:i,r:0});tmp = true;}
			}
		}
	}

	//åˆ¤æ–­ã™ã¹ãäººãŒã„ã‚‹ã‚“ã ã£ãŸã‚‰é¸ã°ã›ã‚‹ã€‚
	if(tmp){
		add_message("æ­ä¹—è€…ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚");
		var sss = [];
		for(var i=0;i<boarding_member.length;i++){
			if(boarding_member[i].r==0){sss.push("ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼"+(boarding_member[i].n+1)+"(é™)");}
			if(boarding_member[i].r==2){sss.push("ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼"+(boarding_member[i].n+1)+"(é‹è»¢)");}
		}
		sss.push("æ±ºå®š");
		show_option(sss);
		draw_board();
		return true;
	}else{//é¸ã°ãªã„ã‚“ã ã£ãŸã‚‰æ±ºå®šã—ã¦ã—ã¾ã†ã€‚
		drive(boarding_member.length);
		return true;
	}
}

function choose_riding_player(xx,yy){//ä¹—ã‚Šé™ã‚Šã®æŒ‡å®šã¾ãŸã¯
	
	if(yy>=0)return false;

	pos = board.fireengine_place.length + board.fireengine_place.length;
	if(xx < boarding_member.length){
		if(boarding_member[xx].r < 2){boarding_member[xx].r = 1 - boarding_member[xx].r;}
		var sss = [];
		for(var i=0;i<boarding_member.length;i++){
			if(boarding_member[i].r == 0){sss.push("ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼" + (boarding_member[i].n+1) + "(é™)");}
			if(boarding_member[i].r == 1){sss.push("ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼" + (boarding_member[i].n+1) + "(ä¹—)");}
			if(boarding_member[i].r == 2){sss.push("ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼" + (boarding_member[i].n+1) + "(é‹è»¢)");}
		}
		sss.push("æ±ºå®š");
		show_option(sss);
		return true;
	}else{
		pos = vehicle_destination;
		if(vehicle_driven == 1){board.fireengine_pos = pos;}
		if(vehicle_driven == 2){board.ambulance_pos = pos;}
		for(i=0;i<boarding_member.length;i++){
			if(boarding_member[i].r==0){
				boarding_member.splice(i,1);
				i--;
			}
		}
		choose_dismount_pos(-1,1);
	}
}

function choose_dismount_pos(xx,yy){

	if(vehicle_driven == 1){pos = board.fireengine_pos;car = board.fireengine_place;}
	if(vehicle_driven == 2){pos = board.ambulance_pos;car = board.ambulance_place;}

	if(yy<0 && 0<=xx && xx<car[pos].length){
		player[boarding_member[0].n].x=car[pos][xx][0];
		player[boarding_member[0].n].y=car[pos][xx][1];
		boarding_member.shift();
	}else{
		for(var j=0;j<car[pos].length;j++){
			if(car[pos][j][0] == xx && car[pos][j][1] ==yy){
				player[boarding_member[0].n].x=xx;
				player[boarding_member[0].n].y=yy;
				boarding_member.shift();
			}
		}
	}

	if(boarding_member.length>0){
		clear_message();
		add_message("ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼"+(boarding_member[0].n+1)+"ã®é™è»Šä½ç½®ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚");
		var sss = [];
		for(var i=0;i<car[pos].length;i++){
			sss.push("åœ°ç‚¹["+car[pos][i][0]+","+car[pos][i][1]+"]");
		}
		show_option(sss);
		draw_board();
		return true;
	}else{
		resolve_grab();
		choose_action();
		return true;
	}
}

function deckgun(a){

	clear_message();

	if(rerolled6 == true &&rerolled8 ==true){
		if(a==0){
			pay_cost(6);
			game.phase = 0;save_game();game.phase = 6;//ãƒªã‚»ãƒãƒ©ç³é‡éƒå¯¾ç­–ã§å…ˆã«ã‚³ã‚¹ãƒˆã ã‘ã‚‚ã‚‰ã£ã¨ãã€‚		
			roll();
			rerolled6 = false;
			rerolled8 = false;
			a = -1;
		}else{
			choose_action();
			return false;
		}

	}


	if(a==3 || player[game.turn].role != "driver"){
		roll();
		a=0;
	}
	if(a==2){
		roll6();
		rerolled6 = true;
	}
	if(a==1){
		if(rerolled8 == true){
			roll6();
			rerolled6 = true;
		}else{
			roll8();
			rerolled8 = true;
		}

		if(rerolled8  &&rerolled6)a = 0;
	}

	if(a==0){
		adjust_deckgun();
		add_message("åœ°ç‚¹["+dice8+","+dice6+"]ã«æ”¾æ°´ï¼");
		board.fire[dice8][dice6] = 0;
		for(var i=0;i<4;i++){
			var wall;
			var xm = Math.round(dice8+Math.sin(i*Math.PI/2));
			var ym = Math.round(dice6+Math.cos(i*Math.PI/2));
			if(dice8 == xm){
				wall = board.wall_tate;
			}else{
				wall = board.wall_yoko;
			}
			if(wall[Math.min(dice8,xm)][Math.min(dice6,ym)]<=1){
				board.fire[xm][ym]=0;
			}
			
		}
		rewindable = false;
		choose_action();
	}else{
		adjust_deckgun();
		add_message("åœ°ç‚¹["+dice8+","+dice6+"]ã«æ”¾æ°´ã—ã‚ˆã†ã¨ã—ã¦ã‚‹ã€‚æŒ¯ã‚Šç›´ã—ã¾ã™ã‹ï¼Ÿ");
		draw_board();
		draw_circle(dice8,dice6);
		var sss=[];
		sss.push("ã“ã“ã§ã„ã„");
		if(rerolled8==false){sss.push("æ¨ªæ–¹å‘ã‚’æŒ¯ã‚Šç›´ã—");}
		if(rerolled6==false){sss.push("ç¸¦æ–¹å‘ã‚’æŒ¯ã‚Šç›´ã—");}
		if(rerolled6==false && rerolled8==false){sss.push("ã©ã£ã¡ã‚‚æŒ¯ã‚Šç›´ã—");}
		show_option(sss);
	}


}

function adjust_deckgun(){
	var car = board.fireengine_place;
	var pos = board.fireengine_pos;
	if((board.yoko/2 > board.fireengine_place[board.fireengine_pos][0][0]) != (board.yoko/2 > dice8)){
		invert8();
	}

	if((board.tate/2 > board.fireengine_place[board.fireengine_pos][0][1]) != (board.tate/2 > dice6)){
		invert6();
	}
}

function is_in_sight(a){
	var car = board.fireengine_place;
	var pos = board.fireengine_pos;
	if((board.yoko/2 > board.fireengine_place[board.fireengine_pos][0][0]) != (board.yoko/2 > player[a].x)){
		return false;
	}

	if((board.tate/2 > board.fireengine_place[board.fireengine_pos][0][1]) != (board.tate/2 > player[a].y)){
		return false;
	}
	if(player[a].x == 0 || player[a].x == board.yoko-1 || player[a].y == 0 || player[a].y == board.tate-1)return false;
	return true;
}

function ex_action(xx,yy = -1){

	var argt = role[player[game.turn].role].ex_action[ex_act_count].select[ex_select];
	if(argt=="n"){
		role[player[game.turn].role].ex_action[ex_act_count].action[ex_select]();
	}else if(argt=="s"){
		if(yy<0)role[player[game.turn].role].ex_action[ex_act_count].action[ex_select](xx);
	}else if(argt=="f"){
		if(yy>=0)role[player[game.turn].role].ex_action[ex_act_count].action[ex_select](xx,yy);
	}else if(argt=="g"){
		role[player[game.turn].role].ex_action[ex_act_count].action[ex_select](xx,yy);
	}else{
		alert(player[game.turn].role+"ã®ex_act["+ex_act_count+"]ã®select["+ex_select+"]ãŒ"+argt+"ã«ãªã£ã¦ã‚‹");
	}

}

function role_change_check(){
	console.log("ãƒ­ãƒ¼ãƒ«ãƒã‚§ãƒ³ã‚¸ã®ã›ã‚“ãŸãï¼š"+role_selector[0].value);
	for(var i=0;i<player.length;i++){
		if(role_selector[0].value == player[i].role){
			clear_message();
			if(i==game.turn){
				add_message("æ—¢ã«ã‚ãªãŸã¯ãã®ãƒ­ãƒ¼ãƒ«ã§ã™ã€‚");
			}else{
				add_message("åŒã˜ãƒ­ãƒ¼ãƒ«ã‚’ä»–ã®ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãŒæŒã£ã¦ã„ã¾ã™ã€‚");
				add_message("é‡è¤‡ãŒãªã„ã‚ˆã†ãƒ­ãƒ¼ãƒ«ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚");
			}
			choose_action();
			return false;
		}
	}


	player[game.turn].role = role_selector[0].value;
	game.ap = role[role_selector[0].value].ap + player[game.turn].ap;
	game.sap = role[role_selector[0].value].sap;
	
	game.ap -= 2;
	add_message(role[role_selector[0].value].name+"ã«å¤‰æ›´ã—ãŸã€‚");
	

	choose_action();
	return false;


}

//---------------------------
function begining_end_phase(){
	if(game.scene==1)return;
	if(board.fire[player[game.turn].x][player[game.turn].y] == 2){
		add_message("ç‚ã®ä¸­ã«ã„ã‚‹çŠ¶æ…‹ã§ã‚¿ãƒ¼ãƒ³ã¯çµ‚äº†ã§ããªã„ï¼");
		choose_action();
		return false;
	}
	game.scene = 4;
	game.phase = 0;
	clear_message();
	add_message("ã‚¿ãƒ¼ãƒ³ã‚’çµ‚äº†ã—ã¾ã™ã‹ï¼Ÿ");
	show_option(["ã¯ã„","ã€€","ã„ã„ãˆ"]);
}

function enter_end_phase(a){

	if(a!=0){choose_action();return false;}

	if(game.ap>4)game.ap=4;
	player[game.turn].ap=game.ap;
	
	game.hotspot_flag = false;
	clear_message();
	roll();
	expand_fire();
}

function expand_fire(){

	game.scene = 4;
	game.phase = 1;
	add_message("åœ°ç‚¹["+dice8+","+dice6+"]ã§ç‚ã®æ‹¡å¤§ï¼");
	show_option(["æ¬¡ã¸"]);
	if(board.fire[dice8][dice6] == 2){
		explode(dice8,dice6);
		add_message("çˆ†ç™ºãŒèµ·ãã‚‹ï¼");	
	}else if(board.fire[dice8][dice6] == 1){
		board.fire[dice8][dice6] = 2;
		add_message("ç‚ãŒä¸ŠãŒã‚‹ï¼");	
	}else if(board.fire[dice8][dice6] == 0){
		board.fire[dice8][dice6] = 1;
		add_message("ç…™ãŒç«‹ã¡ã“ã‚ã‚‹ï¼");	
	}
	game.firespot_x = dice8;
	game.firespot_y = dice6;

	draw_board();
	draw_circle(dice8,dice6);
	save_game();
}

function flashover(){
	game.scene = 4;
	game.phase = 2;
	var tmp = false;
	for(var xx=0;xx<board.yoko;xx++){
		for(var yy=0;yy<board.tate;yy++){
			if(board.fire[xx][yy]==1){
				if(chain_flashover(xx,yy))tmp=true;
			}
		}
	}

	if(tmp){
		clear_message();
		add_message("ãƒ•ãƒ©ãƒƒã‚·ãƒ¥ã‚ªãƒ¼ãƒãƒ¼ï¼ç…™ãŒå¼•ç«ã—ã¦ç‚ã«å¤‰ã‚ã‚‹ï¼");	
		draw_board();
	}else{hazmat_check();}
}

function chain_flashover(xx,yy){
	var xm;var ym;

	if(board.fire[xx][yy]!=1)return false;
	//console.log("åœ°ç‚¹["+xx+","+yy+"]ã®ãƒ•ãƒ©ãƒƒã‚·ãƒ¥åˆ¤å®š");
	for(var i=0;i<4;i++){
		xm = Math.round(xx+Math.sin(i*Math.PI/2));
		ym = Math.round(yy+Math.cos(i*Math.PI/2));
		if(xx == xm){tmp = board.wall_tate[Math.min(xx,xm)][Math.min(yy,ym)];}
		if(yy == ym){tmp = board.wall_yoko[Math.min(xx,xm)][Math.min(yy,ym)];}
		if(board.fire[xm][ym]==2 && tmp < 2){
			board.fire[xx][yy]=2;
			//console.log("éš£ã«ç«ã‚¢ãƒª["+xm+","+ym+"]");
		}
	}
	if(board.fire[xx][yy]==2){
		for(var i=0;i<4;i++){
			xm = Math.round(xx+Math.sin(i*Math.PI/2));
			ym = Math.round(yy+Math.cos(i*Math.PI/2));
			if(xx == xm){tmp = board.wall_tate[Math.min(xx,xm)][Math.min(yy,ym)];}
			if(yy == ym){tmp = board.wall_yoko[Math.min(xx,xm)][Math.min(yy,ym)];}
			if(board.fire[xm][ym]==1 && tmp < 2){chain_flashover(xm,ym);}
		}
		return true;
	}
	return false;
}

function hazmat_check(){

	game.scene = 4;
	game.phase = 3;
	if(game.difficulty<0){dead_check();return;}

	for(var i=0;i<hazmat.length;i++){
		if(hazmat[i].status == 1 && board.fire[hazmat[i].x][hazmat[i].y] == 2){
			explode(hazmat[i].x,hazmat[i].y);
			hazmat[i].status = 0;
			add_hotspot(hazmat[i].x,hazmat[i].y);
			clear_message();
			add_message("å±é™ºç‰©ã«å¼•ç«ã—ã¦çˆ†ç™ºãŒèµ·ãã‚‹ï¼");
			draw_board();
			game.phase = 1;
		}
	}

	if(game.phase == 3)hotspot_check();
}

function hotspot_check(){
	game.scene = 4;
	game.phase = 4;

	if(board.hotspot[game.firespot_x][game.firespot_y] == 1){
		clear_message();
		game.hotspot_flag = true;
		add_message("é«˜æ¸©ç‚¹ã«ç‚ãŒæ‹¡å¤§ã—ãŸã®ã§å†ã³ç‚ã®æ‹¡å¤§ãŒèµ·ãã‚‹ï¼");
		roll();
		expand_fire();
	}else{
		if(game.hotspot_flag){
			clear_message();
			add_hotspot(game.firespot_x,game.firespot_y);
			draw_board();
			
		}else{
			dead_check();
		}
	}
}

function continue_check(a){

	if(a==0){
		clear_message();
		if(game.dead == 0){add_message("å®Œå…¨æ•‘å‡ºã‚’ç›®æŒ‡ã—ã¦ç¶šè¡Œï¼");}
		else{add_message("æ®‹ã‚Šã®è¦æ•‘åŠ©è€…ã‚’æ•‘ã†ã¹ãç¶šè¡Œï¼");}
		choose_action();
	}
	if(a==2){enter_start_menu();}

}

//---------------------


function collapse_check(){
	if(game.damage<=0){
		game.scene = 5;
		game.phase = 0;
		add_message("å»ºç‰©ãŒå€’å£Šã—ãŸã€‚");
		if(game.alive<7){add_message("è¦æ•‘åŠ©è€…ã‚’åŠ©ã‘å‡ºã›ãªã‹ã£ãŸã€‚æˆ‘ã€…ã®æ•—åŒ—ã ã€‚");}
		else if(game.alive<10){add_message("ã„ãã‚‰ã‹ã®çŠ ç‰²ã¯å‡ºãŸãŒã€å¤šãã®äººã€…ã‚’æ•‘ã£ãŸäº‹ã«è³è³›ãŒå¯„ã›ã‚‰ã‚Œã‚‹ã€‚");}
		else{add_message("ã—ã‹ã—ã€å»ºç‰©ã«ã„ã‚‹ã¯ãšã®äººé–“ã¯ã™ã¹ã¦æ•‘ã„å‡ºã—ãŸï¼æˆ‘ã€…ã®å‹åˆ©ã ï¼");add_message("ï¼ˆã§ã‚‚ãªã‚“ã§ï¼Ÿãã®æ™‚ç‚¹ã§ã‚²ãƒ¼ãƒ çµ‚ã‚ã£ã¦ã‚‹ã¯ãšãªã®ã«...ï¼‰");}
		draw_board();
		return true;
	}
	return false
}

function deal_damage(){//å»ºç‰©ã«ãƒ€ãƒ¡ãƒ¼ã‚¸ãŒå…¥ã‚‹ãŸã³ã«ä½•ã‹å‡¦ç†ã‚’ã™ã‚‹ã¨ãã®ãŸã‚ã«é–¢æ•°åŒ–ã—ã¦ã‚‹ã‘ã©å½¹ã«ç«‹ã¤æ—¥ãŒæ¥ã‚‹ã®ã‹ã¯ä¸æ˜ã€‚
	game.damage--;
}

function dead_check(){
	var xx;
	var yy;
	var tmp = true;
	if(collapse_check()){return false;}
	clear_message();

	for(var i=0;i<poi.length;i++){
		if(board.fire[poi[i].x][poi[i].y]<2)continue;
		if(poi[i].status == 1){
			flip_poi(i);
			if(poi[i].status ==0){
				game.scene = 4;
				game.phase = 4;
				return false;
			}
		}

		if(poi[i].status > 1){
			game.scene = 5;
			game.phase = 2;
			add_message("åœ°ç‚¹["+poi[i].x+","+poi[i].y+"ã«ã„ãŸ"+poi_name[poi[i].status]+"ã¯ãŒç‚ã«å·»ã‹ã‚Œã¦äº¡ããªã£ãŸã€‚");
			poi[i].status = 0;
			game.dead++;
			if(game.dead>=4){
				game.scene = 5;
				game.phase = 0;
				add_message("ã‚ã¾ã‚Šã«ã‚‚å¤šãã®çŠ ç‰²ãŒå‡ºã¦ã—ã¾ã£ãŸã€‚æˆ‘ã€…ã®æ•—åŒ—ã ã€‚");
				return false;
			}else{
				game.scene = 4;
				game.phase = 4;
				return false;
			}
		}
	}

	for(var i=0;i<player.length;i++){
		if(board.fire[player[i].x][player[i].y]<2)continue;
		add_message("åœ°ç‚¹["+player[i].x+","+player[i].y+"]ã«ã„ãŸãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼"+(i+1)+"ã¯ãŒç‚ã«å·»ã‹ã‚Œã¦é¿é›£ã—ãŸã€‚");
		var mr = board.tate + board.yoko;
		var sss = [];
		reentry_pos = [];
		release(i);

		if(game.difficulty<0){
			for(var j=0;j<board.ambulance_place.length;j++){
			for(var k=0;k<board.ambulance_place[j].length;k++){
				xx = board.ambulance_place[j][k][0];
				yy = board.ambulance_place[j][k][1];
				var r = Math.abs(xx-player[i].x) + Math.abs(yy-player[i].y);
				if(r==mr){
					sss.push("åœ°ç‚¹["+xx+","+yy+"]");
					reentry_pos.push(xx,yy);
				}
				if(r<mr){
					mr=r;
					reentry_pos=[[xx,yy]];
					sss = ["åœ°ç‚¹["+xx+","+yy+"]"];
				}
			}
			}
			
		}else{
			var j = board.ambulance_pos;
			for(var k=0;k<board.ambulance_place[j].length;k++){
				reentry_pos.push([board.ambulance_place[j][k][0],board.ambulance_place[j][k][1]]);
				sss.push("åœ°ç‚¹["+board.ambulance_place[j][k][0]+","+board.ambulance_place[j][k][1]+"]");
			}
		}

		if(sss.length>1){
			game.scene = 5;
			game.phase = 1;

			draw_board();
			for(var i=0;i<reentry_pos.length;i++){
				draw_circle(reentry_pos[i][0],reentry_pos[i][1]);
			}
			show_option(sss);
			add_message("ã©ã“ã‹ã‚‰ãƒªã‚¹ã‚¿ãƒ¼ãƒˆã—ã¾ã™ã‹ï¼Ÿ");
			return true;
		}else{
			add_message("åœ°ç‚¹["+reentry_pos[0][0]+","+reentry_pos[0][1]+"]ã‹ã‚‰å†çªå…¥ã™ã‚‹ã€‚");
			player[i].x = reentry_pos[0][0];
			player[i].y = reentry_pos[0][1];
			board.fire[reentry_pos[0][0]][reentry_pos[0][1]]=0;
			game.scene=4;
			game.phase=4;
			draw_board();
			return true;
		}
	}

	refill_poi();
}

function reentry(xx,yy=-1){

	var a = xx;

	if(yy>=0){
		var i;
		for(i=0;i<reentry_pos.length;i++){
			if(xx==reentry_pos[i][0] && yy==reentry_pos[i][1]){
				a = i;
				break;
			}
		}
		if(i==reentry_pos.length){return;}
	}

	for(var i=0;i<player.length;i++){
		if(board.fire[player[i].x][player[i].y]<2)continue;

		xx = reentry_pos[a][0];
		yy = reentry_pos[a][1];

		clear_message();
		add_message("åœ°ç‚¹["+xx+","+yy+"]ã‹ã‚‰å†çªå…¥ã™ã‚‹ã€‚");
		show_option(["æ¬¡ã¸"]);
		draw_board();
		player[i].x=xx;
		player[i].y=yy;
		board.fire[xx][yy]=0;
		draw_board();
		break;
	}
	game.scene=4;game.phase=4;
}

function flip_poi(a){
	if(poi[a].status==1){
		if(Math.random()*(game.victim_rest+game.false_rest)<game.false_rest){
			game.false_rest--;
			poi[a].status = 0;
			add_message("åœ°ç‚¹["+poi[a].x+","+poi[a].y+"]ã®ä¸å¯©ç®‡æ‰€ã¯èª¤å ±ã ã£ãŸï¼");
		}else{
			game.victim_rest--;
			poi[a].status = 2;
			add_message("åœ°ç‚¹["+poi[a].x+","+poi[a].y+"]ã®ä¸å¯©ç®‡æ‰€ã«è¦æ•‘åŠ©è€…ãŒã„ãŸï¼");
		}
		draw_board();
	}
}

function refill_poi(){
	
	var poi_num = 0;
	var tmp = true;

	game.scene = 5;
	game.phase = 3;
	
	extinguish_around();

	for(var i = 0;i<poi.length;i++){
		if(poi[i].status==0 && game.poi_rest>0){

			poi_spawn();
			poi[i].x = dice8;
			poi[i].y = dice6;
			poi[i].status = 1;
			game.poi_rest--;
			board.fire[dice8][dice6] = 0;
			add_message("åœ°ç‚¹["+poi[i].x+","+poi[i].y+"]ã®ä¸å¯©ç®‡æ‰€ãŒåˆ¤æ˜ã—ãŸã€‚");
			for(var j=0;j<player.length;j++){if(player[j].x == dice8 && player[j].y == dice6){flip_poi(i);}}
			draw_board();
			tmp = false;
		}
	}

	save_game();
	if(tmp == true){pass_turn();}
}


function poi_spawn(){
	var wander = true;
	var round = false;

	roll();

	while(wander){
		console.log("åœ°ç‚¹["+dice8+"]["+dice6+"]ã®poi_spawnãƒã‚§ãƒƒã‚¯");
		wander = false;
		if(game.difficulty>=0){
			if(board.fire[dice8][dice6]>0){wander = true;console.log("ç«ãŒã‚ã‚‹");};
			for(var i=0;i<player.length;i++){if(player[i].x == dice8 && player[i].y == dice6){wander = true;console.log("ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼"+(i+1)+"ãŒã„ã‚‹");}}
			for(var i=0;i<poi.length;i++){if(poi[i].x == dice8 && poi[i].y == dice6 && poi[i].status>0){wander = true;console.log(poi_name[poi[i].status]+"ãŒã„ã‚‹");}}
		}else{
			for(var i=0;i<poi.length;i++){if(poi[i].x == dice8 && poi[i].y == dice6 && poi[i].status>0){wander = true;console.log(poi_name[poi[i].status]+"ãŒã„ã‚‹");}}
		}
		if(wander){
			var xx =dice8+ (board.poi_move[dice8][dice6]-1)%3-1;
			var yy =dice6+ 1-Math.floor((board.poi_move[dice8][dice6]-1)/3);
			dice8= xx;dice6 =yy;
			if(round == true && board.poi_end.x == xx &&board.poi_end.y == yy){
				roll();
				round = false;
			}else if(board.poi_end.x == xx &&board.poi_end.y == yy){
				round = true;
			}
			if(game.difficulty<0)roll();
		}
	}
}


function pass_turn(){
	game.turn = (game.turn + 1) % player.length;
	take_my_turn();
}

//---------------------------------------------

function is_payable(act,t1=-1,t2=-1,t3=-1){

	var hav;
	var cos = action_cost(act,t1,t2,t3);

	if(is_sap_usable(act,t1=-1,t2=-1,t3=-1)){hav = game.ap+game.sap;}
	else{hav = game.ap;}

	return hav>=cos;
}

function pay_cost(act,t1=-1,t2=-1,t3=-1){

	var psp;
	var cos = action_cost(act,t1,t2,t3);

	if(is_payable(act,t1,t2,t3)==false){console.log("æ‰•ãŠã†ã«ã‚‚ã¯ã‚‰ãˆã¬ï¼ã¡ã‚ƒã‚“ã¨ã‚³ã‚¹ãƒˆã‚’ç¢ºã‹ã‚ã‚‹å‡¦ç†ã‚’ã¯ã•ã‚! "+act+","+t1+","+t2+","+t3);return;}

	if(is_sap_usable(act,t1=-1,t2=-1,t3=-1)){
		if(game.sap > cos){game.sap = game.sap - cos;}
		else{game.ap=game.ap+game.sap-cos;game.sap=0;}
	}else{game.ap = game.ap-cos;}

}

function action_cost(act,t1=-1,t2=-1,t3=-1){
	if(act==1){//æ­©ãã€‚t1ã«å¯¾è±¡ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼
		for(var i=0;i<player[t1].grab.length;i++){
			if(player[t1].grab[i][0]==2 ||(player[t1].grab[i][0]==1 && player[t1].grab[i][1]<3))return 2;
		}
		return 1;

	}else if(act==2){//æ‰‰é–‹é–‰ã€‚t1ã«å£ã®ç¨®é¡
		if(player[game.turn].role=="rescue" || t1<=2){return 1;}
		else{return 2;}
	}else if(act==3){//æ¶ˆç«ã€‚ã«ãŒã¦ãªã‚­ãƒ£ãƒ©ã¯2,ãã‚Œä»¥å¤–1ã€‚
		if(role[player[game.turn].role].dis_ex){return 2;}
		else{return 1;}
	}else if(act==4){//ç‰©ã‚’æ´ã‚€ã®ã¯æ­£ç¢ºã«ã¯ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã§ã¯ãªã„ã€‚
		return 0;
	}else if(act==5){//è»Šä¸¡ã®é‹è»¢ã¯ä¸€å¾‹2ã€‚
		return 2;
	}else if(act==6){//æ”¾æ°´ã¯é‹è»¢æ“ä½œæŠ€å¸«2ã€‚ãã‚Œä»¥å¤–ã¯4ã€‚
		if(player[game.turn].role=="driver"){return 2;}
		else{return 4;}
	}else if(act==7){//ãƒ­ãƒ¼ãƒ«ãƒã‚§ãƒ³ã‚¸ã¯ä¸€å¾‹2ã€‚
		return 2;
	}else if(act==8){//ç‰¹åˆ¥ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã¯ãã‚Œãã‚Œã®ãƒ­ãƒ¼ãƒ«ã«èãã€‚t1ã«ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã€t2,t3ã«æ¸¡ã™å¼•æ•°ã€‚
		if(t1>=0){
			return role[player[game.turn].role].ex_action[t1].cost(t2,t3);
		}else{
			console.log("ãƒ­ãƒ¼ãƒ«å°‚ç”¨ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã®ã‚³ã‚¹ãƒˆã‚’èããªã‚‰ã©ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‹æŒ‡å®šã—ã¦ãã‚Œ(å¤šåˆ†0ç•ªãªã‚“ã ã‚ã†ã‘ã©ã€‚)");
			return 9999;
		}
	}else{
		console.log("ãªã‚“ã‹costã®é–¢æ•°ã«act="+act+"ãŒå…¥ã‚Œã‚‰ã‚ŒãŸãï¼ï¼Ÿ");
	}
}

function is_sap_usable(act,t1=-1,t2=-1,t3=-1){


	if(act==1){
		if(player[game.turn].role == "captain" && game.phase == 8){return true;}
		if(player[game.turn].role == "rescue"){return true;}
		else{return false;}
	}else if(act==2){//æ‰‰é–‹é–‰ã€‚t1ã«å£ã®ç¨®é¡
		hav = game.ap;
	}else if(act==3){//æ¶ˆç«ã€‚å…¨éƒ¨1ã€‚
		if(player[game.turn].role == "cafs"){return true;}
		else{return false;}
	}else if(act==4){//ç‰©ã‚’æ´ã‚€ã®ã¯æ­£ç¢ºã«ã¯ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã§ã¯ãªã„ã€‚
		return false;
	}else if(act==5){//è»Šä¸¡ã®é‹è»¢ã¯ä¸€å¾‹2ã€‚
		return false;
	}else if(act==6){//æ”¾æ°´ã¯é‹è»¢æ“ä½œæŠ€å¸«2ã€‚ãã‚Œä»¥å¤–ã¯4ã€‚
		return false;
	}else if(act==7){//ãƒ­ãƒ¼ãƒ«ãƒã‚§ãƒ³ã‚¸ã¯ä¸€å¾‹2ã€‚
		return false;
	}else if(act==8){//ç‰¹åˆ¥ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã¯ãã‚Œãã‚Œã®ãƒ­ãƒ¼ãƒ«ã«èãäºˆå®šã€‚ã§ã‚‚ã¨ã‚Šã‚ãˆãšä½¿ãˆã‚‹ã§ã—ã‚‡ï¼Ÿç‰¹æ®ŠAPã¨ç‰¹æ®Šã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã©ã£ã¡ã‚‚æŒã£ã¦ã‚‹ã®ã¯ä»Šã®ã¨ã“æ¶ˆé˜²æŒ‡ä»¤ã—ã‹ã„ãªã„ã€‚ãã—ã¦ä½¿ãˆã‚‹ã€‚
		return true;
	}else{
		console.log("ãªã‚“ã‹is_sap_usableã®é–¢æ•°ã«act="+act+"ãŒå…¥ã‚Œã‚‰ã‚ŒãŸãï¼ï¼Ÿ");
		return false;
	}
}

function add_hotspot(xx,yy){//é«˜æ¸©ç‚¹è¿½åŠ ã€‚æ®‹ã£ã¦ãªãã‚ƒã‚„ã‚‰ãªã„ã€‚
	if(board.hotspot[xx][yy]==0 && game.hotspot_remain>0 ){
		board.hotspot[xx][yy]=1;
		game.hotspot_remain--;
		add_message("åœ°ç‚¹["+dice8+","+dice6+"]ã«é«˜æ¸©ç‚¹ã®è¿½åŠ ï¼");
		draw_board();
	}else if(board.hotspot[xx][yy]==0 && game.hotspot_remain<=0 ){
		add_message("åœ°ç‚¹["+dice8+","+dice6+"]ã«é«˜æ¸©ç‚¹ã®è¿½åŠ â€¦ã™ã‚‹ã¨ã“ã ã£ãŸã‘ã©ã‚‚ã†é«˜æ¸©ç‚¹ãŒãªã„ã€‚");
		draw_board();

	}
}

function extinguish_around(){
	for(var x=0;x<board.yoko;x++){
		board.fire[x][0]=0;
		board.fire[x][board.tate-1]=0;
	}
	for(var y=0;y<board.tate;y++){
		board.fire[0][y]=0;
		board.fire[board.yoko-1][y]=0;
	}
}
function explode(xx,yy){//çˆ†ç™º
	var xm;
	var ym;
	var tmp;
	console.log("åœ°ç‚¹["+xx+","+yy+"]ã§çˆ†ç™ºï¼");
	for(var i=0;i<4;i++){
		xm = Math.round(xx+Math.sin(i*Math.PI/2));
		ym = Math.round(yy+Math.cos(i*Math.PI/2));
		tmp = brow(xx,yy,xm,ym);
		if(tmp){
			if(board.fire[xm][ym]<2){board.fire[xm][ym]=2;}
			else if(board.fire[xm][ym]==2){shockwave(xm,ym,i);}
		}
	}
}

function shockwave(xx,yy,i){//ã‚·ãƒ§ãƒƒã‚¯ã‚¦ã‚§ãƒ¼ãƒ–
	var xm;
	var ym;
	xm = Math.round(xx+Math.sin(i*Math.PI/2));
	ym = Math.round(yy+Math.cos(i*Math.PI/2));

	tmp = brow(xx,yy,xm,ym);
	if(tmp){
		if(board.fire[xm][ym]<2){board.fire[xm][ym]=2;}
		shockwave(xm,ym,i);
	}
}
function opendoor(xx,yy,xm,ym){//æ¶ˆé˜²æŒ‡ä»¤ç”¨ã«ãƒ‰ã‚¢ã®é–‹ã‘é–‰ã‚ã ã‘ã®é–¢æ•°ã‚’ä½œã£ãŸ

	if(xm != xx && ym != yy)return false;
	if(xm == xx && Math.abs(ym-yy) != 1) return false;
	if(ym == yy && Math.abs(xm-xx) != 1) return false;

	var wall;
	if(xm==xx){wall = board.wall_tate;}
	if(ym==yy){wall = board.wall_yoko;}

	xx = Math.min(xx,xm);
	yy = Math.min(yy,ym);

	if(wall[xx][yy]<1 ||wall[xx][yy]>2 )return false;

	if(game.ap < action_cost(1,wall[xx][yy])){
		add_message("ã‚³ã‚¹ãƒˆãŒè¶³ã‚‰ãªã„ã€‚");
		return false;
	}
		
	if(wall[xx][yy]==2){
		add_message("æ‰‰ã‚’é–‹ã‘ãŸã€‚");
		wall[xx][yy] = wall_next_status(wall[xx][yy]);
	}else if(wall[xx][yy]==1){
		add_message("æ‰‰ã‚’é–‰ã‚ãŸã€‚");
		wall[xx][yy] = wall_next_status(wall[xx][yy]);
	}

	return true;
}

function brow(xx,yy,xm,ym){//çˆ†ç™ºã‚„ã‚·ãƒ§ãƒƒã‚¯ã‚¦ã‚§ãƒ¼ãƒ–ã®å£æ®´ã‚Š
	var xm;
	var ym;

	if(is_in_board(xm,ym)==false){return false;}

	if(xx==xm){wall = board.wall_tate;}
	if(yy==ym){wall = board.wall_yoko;}
	
	xm=Math.min(xx,xm);ym=Math.min(yy,ym);

	if(wall[xm][ym] == 4){
		deal_damage();
		wall[xm][ym] = 3;
		return false;
	}else if(wall[xm][ym] == 3){
		deal_damage();
		wall[xm][ym] = 0;
		return false;
	}else if(wall[xm][ym] == 2){
		wall[xm][ym] = 0;
		return false;
	}else{
		wall[xm][ym] = 0;
		return true;
	}


}


//------------------------------------------------------------
//--ã‚¹ã‚¿ãƒ¼ãƒˆãƒ¡ãƒ‹ãƒ¥ãƒ¼é–¢é€£--------------------------------------
//------------------------------------------------------------

function enter_start_menu(){

	game.scene=0;
	game.phase=0;

	init_map("first_easy");

	clear_message();
	add_message("ãƒ¢ãƒ¼ãƒ‰ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚");
	show_option(["ã‚²ãƒ¼ãƒ ã‚¹ã‚¿ãƒ¼ãƒˆ","ç°¡æ˜“ãƒ«ãƒ¼ãƒ«ã§ãƒ—ãƒ¬ã‚¤","ã€€","ãƒ­ãƒ¼ãƒ‰","ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«"]);

	draw_board();
}

function branch_start_menu(a){
	if(a==0){game.difficulty=0;choose_player_nbr();}
	if(a==1){game.difficulty=-1;choose_player_nbr();}
	if(a==3){check_load_data();}//ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã¸
	if(a==4){tutorial_menu();}//ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã¸
}

function check_load_data(){
	g = localStorage.getItem("scatolo's_rescue_game");
	if(g==null){
		add_message("ã‚»ãƒ¼ãƒ–ãƒ‡ãƒ¼ã‚¿ãŒç„¡ã„ï¼");
		return false;
	}

	og = JSON.parse(g);
	vvv = game.version;
	if(Math.floor(og.version)!=Math.floor(vvv)){
		add_message("ã‚»ãƒ¼ãƒ–ãƒ‡ãƒ¼ã‚¿ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãŒé•ã£ã¦ãƒ­ãƒ¼ãƒ‰ã§ããªã„ï¼");
		return false;
	}
	
	board_json = localStorage.getItem("scatolo's_rescue_board");
	game_json = localStorage.getItem("scatolo's_rescue_game");
	player_json = localStorage.getItem("scatolo's_rescue_player");
	poi_json = localStorage.getItem("scatolo's_rescue_poi");
	hazmat_json = localStorage.getItem("scatolo's_rescue_hazmat");

	board = JSON.parse(board_json);
	game = JSON.parse(game_json);
	player = JSON.parse(player_json);
	poi = JSON.parse(poi_json);
	hazmat = JSON.parse(hazmat_json);

	game.version = vvv;
	game.scene = 0;
	game.phase = 6;

	clear_message();
	add_message("ã“ã®ã‚²ãƒ¼ãƒ ã‚’ãƒ­ãƒ¼ãƒ‰ã—ã¾ã™ã‹ï¼Ÿ");

	draw_board();
	show_option(["å†é–‹ã™ã‚‹","ã€€","ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã«æˆ»ã‚‹"]);
}

function confirm_load_data(a){
	if(a==0){load_game();}
	else{enter_start_menu();}
}

function choose_player_nbr(){

	game.scene=0;
	game.phase=1;

	clear_message();
	add_message("ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼äººæ•°ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚");
	show_option(["2äºº","3äºº","4äºº","5äºº","6äºº","ã€€","ã‚‚ã©ã‚‹"]);

}

function choose_difficulty(a){

	if(0<=a && a<=4){nbr_player=a+2;}
	else if(a==6){enter_start_menu();return false;}
	else {return false;}

	if(game.difficulty<0){init_map("first_easy");confirm_easygame();return;}
	game.scene=0;
	game.phase=2;

	clear_message();
	add_message("é›£æ˜“åº¦ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚");
	sss=[];
	for(var i=0;i<difficulty_name.length;i++)
		sss.push(difficulty_name[i]);
	sss.push("ã€€");
	sss.push("ã‚‚ã©ã‚‹");
	show_option(sss);

	
}

function choose_map(a){

	if( a<difficulty_name.length){game.difficulty=a;}
	else if(a==difficulty_name.length+1){choose_player_nbr();return false;}
	else {return false;}

	game.scene=0;
	game.phase=3;

	clear_message();
	add_message("ãƒãƒƒãƒ—ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚");

	var sss=[];
	map_num=0;
	Object.keys(map).forEach(function(key){
		sss.push(map[key].name);
	});
	sss.push("ã€€");
	sss.push("ã‚‚ã©ã‚‹");
	show_option(sss);
}

function confirm_map(a){

	Object.keys(map).forEach(function(key){
		a--;
		if(a==-1){
			init_map(key);
		}
	});

	if(a==0){return false;}
	if(a==1){choose_difficulty(nbr_player-2);return false;}

	draw_board();
	game.scene=0;
	game.phase=4;

	clear_message();
	add_message("ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼:"+nbr_player+"äººã€€é›£æ˜“åº¦:"+difficulty_name[game.difficulty]+"ã€€ãƒãƒƒãƒ—ã¯ä¸Šã®ã¨ãŠã‚Š");
	add_message("ã§ã‚²ãƒ¼ãƒ ã‚’é–‹å§‹ã—ã¾ã™ã‹ï¼Ÿ");

	show_option(["ã“ã‚Œã§å§‹ã‚ã‚‹","ã€€","äººæ•°ã‚’é¸ã³ç›´ã™","é›£æ˜“åº¦ã‚’é¸ã³ç›´ã™","ãƒãƒƒãƒ—ã‚’é¸ã³ç›´ã™","ã€€","ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã«æˆ»ã‚‹"]);
}
function confirm_easygame(){

	draw_board();
	game.scene=0;
	game.phase=4;

	clear_message();
	add_message("ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼:"+nbr_player+"äººã€€ç°¡æ˜“ãƒ«ãƒ¼ãƒ«ã§ã‚²ãƒ¼ãƒ ã‚’é–‹å§‹ã—ã¾ã™ã‹ï¼Ÿ");

	show_option(["ã“ã‚Œã§å§‹ã‚ã‚‹","ã€€","äººæ•°ã‚’é¸ã³ç›´ã™","ã€€","ã€€","ã€€","ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã«æˆ»ã‚‹"]);
}

function tutorial_menu(){
	game.scene=0;
	game.phase=5;

	clear_message();
	add_message("ã©ã®èª¬æ˜ã‚’è¦‹ã¾ã™ã‹ï¼Ÿ");

	show_option(["é€šå¸¸ãƒ«ãƒ¼ãƒ«ã®èª¬æ˜","ç°¡æ˜“ãƒ«ãƒ¼ãƒ«ã®èª¬æ˜","ãƒ­ãƒ¼ãƒ«ã®èª¬æ˜","ã€€","ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã«æˆ»ã‚‹"]);
}

function choose_tutorial(a){
	if(a==0){game.phase=0;tutorial();}
	if(a==1){game.phase=100;tutorial();}
	if(a==2){game.phase=200;tutorial();}
	if(a==4){enter_start_menu();}
}


function final_confirm_to_start(a){

	if(a==0){setup_game();}
	if(a==2){choose_player_nbr();}
	if(a==3 && game.difficulty>=0){choose_difficulty(nbr_player-2);}
	if(a==4 && game.difficulty>=0){choose_map(game.difficulty);}
	if(a==6){enter_start_menu();}

}

//---------------------------------------------------------------
//--ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«-----------------------------------------------
//---------------------------------------------------------------
function phase_change(s,p){
	game.scene = s;
	game.phase = p;
}

function tutorial(){
	game.scene = 1;
	tmp_s = game.scene;
	tmp_p = game.phase;

	if(game.phase == 0){
		game.difficulty = 0;
		init_map("first_easy");
		player=[{role:"generalist",x:-1,y:-1,grab:[],color:p_color[0],chara:"p1",ap:0}];
		player.push({role:"captain",x:-1,y:-1,grab:[],color:p_color[1],chara:"p2",ap:0});
		player.push({role:"rescue",x:-1,y:-1,grab:[],color:p_color[2],chara:"p3",ap:0});
		game.damage=24;
		game.alive = 0;
		game.dead = 0;
		game.poi_rest=15;
		game.turn = 0;
		//d_message("â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹");	â†ã“ã‚Œã§å…¨è§’30æ–‡å­—æ–‡ã®å¹…
		clear_message();
		show_option(["æ¬¡ã¸"]);
		add_message(" - ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ« (é€šå¸¸ãƒ«ãƒ¼ãƒ«) - ");
		add_message("ã€€");
		add_message("ã€ŒRESCUEã€ã¯å„ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãŒæ¶ˆé˜²å£«ã¨ãªã£ã¦ç«ç½ã‚’æ¶ˆç«ã—ã¤ã¤ã€");
		add_message("24ãƒã‚¤ãƒ³ãƒˆã‚ã‚‹å»ºç‰©ã®è€ä¹…å€¤ãŒãªããªã‚‹å‰ã«");
		add_message("è¦æ•‘åŠ©è€…ã‚’ç™ºè¦‹ã—ã€æ•‘å‡ºã—ã¦ã„ãã“ã¨ã‚’ç›®æŒ‡ã™ã‚²ãƒ¼ãƒ ã§ã™ã€‚");

		game.phase++;
	}else if(game.phase==1){

		board.fire[4][3] = 2;
		board.hotspot[4][3] = 1;
		explode(4,3);

		board.fire[1][2] = 2;
		board.hotspot[1][2] = 1;
		explode(1,2);

		board.fire[8][1] = 2;
		board.hotspot[8][1] = 1;
		explode(8,1);

		hazmat = [];
		hazmat.push({x:1,y:4,status:1,grab:0,who:0});
		hazmat.push({x:3,y:5,status:1,grab:0,who:0});
		hazmat.push({x:8,y:6,status:1,grab:0,who:0});
		hazmat.push({x:5,y:1,status:1,grab:0,who:0});

		poi = [];
		poi.push({x:2,y:4,status:1,grab:0,who:0});game.poi_rest--;
		poi.push({x:7,y:5,status:1,grab:0,who:0});game.poi_rest--;
		poi.push({x:6,y:1,status:1,grab:0,who:0});game.poi_rest--;

		show_option(["æ¬¡ã¸"]);

		draw_board();
		clear_message();
		add_message("ã‚²ãƒ¼ãƒ ã®é–‹å§‹æ™‚ã«çˆ†ç™º(è©³ç´°ã¯å¾Œè¿°ã—ã¾ã™ã€‚)ã¨é«˜æ¸©ç‚¹("+emoji["hotspot"].chara+")ãŒæŒ¯ã‚Šã¾ã‹ã‚Œã€");
		add_message("ä¸å¯©ç®‡æ‰€(<span style='background-color:"+poi_color+"'>"+emoji["poi"].chara+"</span>)ã¨å±é™ºç‰©(<span style='background-color:"+hazmat_color+"'>"+emoji["hazmat"].chara+"</span>)ãŒé…ç½®ã•ã‚Œã¾ã™ã€‚");
		add_message("çˆ†ç™ºã¯ç›¤é¢ä¸­å¤®ä»˜è¿‘ã¨è¿½åŠ ã§ï¼’ã‚«æ‰€ï¼ˆè‹±é›„ãƒ¬ãƒ™ãƒ«ã¯ï¼“ã‚«æ‰€ï¼‰ã§ç™ºç”Ÿã—ã¾ã™ã€‚");
		add_message("ã€€");
		game.phase++;

	}else if(game.phase==2){

		clear_message();

		show_role(3);
		add_message("ãã®ç›¤é¢ã®çŠ¶æ³ã‚’è¦‹ã¦å„ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã§ãƒ­ãƒ¼ãƒ«ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚");
		add_message("ã€€");
		add_message("è¤‡æ•°ã®ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã§åŒã˜ãƒ­ãƒ¼ãƒ«ã«ãªã‚‹ã“ã¨ã¯å‡ºæ¥ã¾ã›ã‚“ã®ã§ã€");
		add_message("é‡è¤‡ã—ãªã„ã‚ˆã†é¸æŠã—ã¦ãã ã•ã„ã€‚");
		game.phase++;

	}else if(game.phase==3){

		board.hotspot[5][5] = 1;
		board.hotspot[4][1] = 1;
		draw_board();
		clear_message();

		show_option(["æ¬¡ã¸"]);
		add_message("ãã®å¾Œã€è¿½åŠ ã®é«˜æ¸©ç‚¹ãŒæŒ¯ã‚Šã¾ã‹ã‚Œã¾ã™ã€‚");
		add_message("é›£æ˜“åº¦ã¨äººæ•°ã«å¿œã˜ã¦é«˜æ¸©ç‚¹ã®æ•°ãŒå¤‰ã‚ã‚Šã¾ã™ã€‚");
		add_message("ä¸€èˆ¬éšŠå“¡:+0ã€€ãƒ™ãƒ†ãƒ©ãƒ³ä»¥ä¸Š:+3 ã€ 3äºº:+2ã€€4äººä»¥ä¸Š:+3");
		add_message("ã“ã‚Œã¨åˆ¥ã«ã€ã‚²ãƒ¼ãƒ ä¸­ã«è¿½åŠ ã•ã‚Œã‚‹é«˜æ¸©ç‚¹ãŒï¼–ã¤ç”¨æ„ã•ã‚Œã¾ã™");
		add_message("ï¼ˆè‹±é›„ãƒ¬ãƒ™ãƒ«ã¯12å€‹ç”¨æ„ã•ã‚Œã¾ã™ã€‚)");
		game.phase++;

	}else if(game.phase==4){

		clear_message();

		show_option(["æ¬¡ã¸"]);
		add_message("ãã‚Œã‚’è¦‹ã¦æ¶ˆé˜²è»Šã€æ•‘æ€¥è»Šã€ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®åˆæœŸä½ç½®ã‚’æ±ºã‚ã¾ã™ã€‚");
		add_message("æ¶ˆé˜²è»Šã¯å»ºç‰©å¤–å‘¨ã®ç·‘è‰²ï¼ˆ<span style='background-color:"+fireengine_color+"'>ã€€</span>ï¼‰ã®ä½ç½®ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã€");
		add_message("æ•‘æ€¥è»Šã¯å»ºç‰©å¤–å‘¨ã®é»„è‰²ï¼ˆ<span style='background-color:"+ambulance_color+"'>ã€€</span>ï¼‰ã®ä½ç½®ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã€");
		add_message("ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¯å»ºç‰©å¤–å‘¨ã®ã„ãšã‚Œã‹ã®ä½ç½®ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦");
		add_message("åˆæœŸä½ç½®ã‚’æ±ºå®šã—ã¾ã™ã€‚");
		game.phase++;

	}else if(game.phase==5){

		clear_message();

		board.fireengine_pos = 3;
		board.ambulance_pos = 0;
		player[0].x = 6;player[0].y=0;
		player[1].x = 0;player[1].y=2;
		player[2].x = 0;player[2].y=3;
		draw_board();

		show_option(["æ¬¡ã¸"]);
		add_message("ã“ã‚Œã§ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ãŒå®Œäº†ã—ã¾ã—ãŸã€‚ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼1ã‹ã‚‰é †ã«ã‚²ãƒ¼ãƒ ãŒå§‹ã¾ã‚Šã¾ã™ã€‚");
		game.phase++;

	}else if(game.phase==6){

		take_my_turn();
		phase_change(tmp_s,tmp_p);
		clear_message();
		add_message("ã‚¿ãƒ¼ãƒ³ãŒæ¥ãŸã‚‰ãƒ­ãƒ¼ãƒ«ã”ã¨ã«æ±ºã¾ã£ãŸã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒã‚¤ãƒ³ãƒˆ(APã€"+emoji["ap"].chara+"ã§è¡¨ç¤º)ã‚’");
		add_message("ä½¿ç”¨ã™ã‚‹ã“ã¨ãŒå‡ºæ¥ã¾ã™ã€‚APãŒæ®‹ã£ã¦ã„ã‚‹é™ã‚Šã€å¥½ããªã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’å¥½ããªé †ã§");
		add_message("ä½•åº¦ã‚‚å®Ÿè¡Œã™ã‚‹ã“ã¨ãŒå‡ºæ¥ã¾ã™ã€‚");
		add_message("æœªä½¿ç”¨ã®APã¯4APã¾ã§æ¬¡ã®è‡ªåˆ†ã®ã‚¿ãƒ¼ãƒ³ã«æŒã¡è¶Šã™ã“ã¨ãŒå‡ºæ¥ã¾ã™ã€‚");
		game.phase++;

	}else if(game.phase==7){

		card_td[0].style="background-color:#f0e0d0";
		clear_message();
		add_message("ç§»å‹•:1AP ï¼ é‹ã¶:2AP");
		add_message("éš£æ¥ãƒã‚¹ã‚’æŒ‡å®šã—ã¦ãã¡ã‚‰ã®æ–¹å‘ã«ç§»å‹•ã—ã¾ã™ã€‚");
		add_message("ä½•ã‹ã‚’ã¤ã‹ã‚“ã çŠ¶æ…‹ã§ã‚ã‚Œã°ã€ç§»å‹•ã¨åŒæ™‚ã«é‹ã³ã¾ã™ã€‚");
		add_message("ä½•ã‚‚ã¤ã‹ã‚“ã§ã„ãªã‘ã‚Œã°ç‚("+emoji["fire"].chara+")ã®ä¸­ã«ã‚‚ç§»å‹•ã§ãã¾ã™ã€‚ï¼ˆ2APï¼‰");
		add_message("ãŸã ã—ã€ç‚ã®ä¸Šã§ã‚¿ãƒ¼ãƒ³ã‚’çµ‚äº†ã™ã‚‹ã“ã¨ã¯å‡ºæ¥ã¾ã›ã‚“ã€‚");

		game.phase++;

	}else if(game.phase==8){

		player_move(0,6,1);
		poi[2].status=2;
		phase_change(tmp_s,tmp_p);
		draw_board();
		clear_message();
		add_message("ä¸å¯©ç®‡æ‰€ã¨åŒã˜ãƒã‚¹ã«ã„ã‚‹å ´åˆã€è¦æ•‘åŠ©è€…ã®å­˜å¦ãŒåˆ¤æ˜ã—ã¾ã™ã€‚");
		add_message("ï¼ˆä¸å¯©ç®‡æ‰€ã®ä¸­ã«è¦æ•‘åŠ©è€…ãŒ10ã€èª¤å ±ãŒ5ã‚ã‚Šã¾ã™ã€‚ï¼‰");
		add_message("ã€€");
		add_message("è¦æ•‘åŠ©è€…ã®å­˜åœ¨ãŒåˆ¤æ˜ã—ãŸã‚‰"+emoji["victim"].chara+"ã§è¡¨ç¤ºã•ã‚Œã¾ã™ã€‚");
		game.phase++;


	}else if(game.phase==9){

		card_td[1].style="background-color:#f0e0d0";
		clear_message();
		add_message("æ‰‰ã®é–‹é–‰:1AP ï¼ å£ã‚’å£Šã™:2AP("+role["rescue"].name+"ã¯1AP)");
		add_message("éš£æ¥ãƒã‚¹ã‚’æŒ‡å®šã™ã‚‹ã¨ã€é–“ã«ã‚ã‚‹æ‰‰ã®é–‹é–‰ã‚„å£ã®ç ´å£Šã‚’è¡Œã„ã¾ã™ã€‚");
		add_message("ç„¡å‚·ã®å£ï¼ˆå®Ÿç·šï¼‰ã‚’å£Šã™ã¨æå‚·ã—ãŸå£ï¼ˆç ´ç·šï¼‰ã«ãªã‚Šã€");
		add_message("æå‚·ã—ãŸå£ã‚’å£Šã™ã¨é–‹é€šã—ã€é€šã‚Œã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚");
		add_message("ç„¡å‚·â†’æå‚·â†’é–‹é€šã®å¤‰åŒ–ã”ã¨ã«å»ºç‰©ã®è€ä¹…å€¤ï¼ˆ"+emoji["damage"].chara+"ï¼‰ãŒæ¸›ã‚Šã¾ã™ã€‚");
		game.phase++;

	}else if(game.phase==10){

		//chop(5,1);
		choose_action();
		phase_change(tmp_s,tmp_p);

		clear_message();
		//d_message("â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹");	â†ã“ã‚Œã§å…¨è§’30æ–‡å­—æ–‡ã®å¹…
		add_message("ã‚ªãƒ¬ãƒ³ã‚¸è‰²ã®æ‰‰ã‚’é–‹ã‘ã‚‹ã“ã¨ã«ã‚ˆã‚Šé€šã‚Œã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚");
		add_message("é–‰ã¾ã£ã¦ã„ã‚Œã°å¾Œè¿°ã™ã‚‹çˆ†ç™ºã‚„ã‚·ãƒ§ãƒƒã‚¯ã‚¦ã‚§ãƒ¼ãƒ–ã‚’");
		add_message("æ­¢ã‚ã‚‹äº‹ãŒã§ãã¾ã™ã€‚çŠ¶æ³ã«å¿œã˜ã¦é–‹é–‰ã—ã¾ã—ã‚‡ã†ã€‚");
		add_message("ã€€");
		add_message("ä»Šå›ã¯å£ã‚’å£Šã™å¿…è¦ãŒç„¡ã„ã®ã§å‰²æ„›ã€‚");
		game.phase++;

	}else if(game.phase==11){

		clear_message();
		card_td[2].style="background-color:#f0e0d0";
		add_message("æ¶ˆç«:1AP");
		add_message("è‡ªèº«ãŒã„ã‚‹ãƒã‚¹ã‹éš£æ¥ãƒã‚¹ã‚’æŒ‡å®šã™ã‚‹ã¨ã€");
		add_message("ãã“ã«ç…™("+emoji["smoke"].chara+")ãŒã‚ã‚‹å ´åˆã¯é™¤å»ã—ã€");
		add_message("ç‚("+emoji["fire"].chara+")ãŒã‚ã‚‹å ´åˆã¯ç…™("+emoji["smoke"].chara+")ã«å¤‰ãˆã¾ã™ã€‚");
		game.phase++;

	}else if(game.phase==12){

		extinguish(7,1);
		phase_change(tmp_s,tmp_p);

		clear_message();
		//d_message("â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹");	â†ã“ã‚Œã§å…¨è§’30æ–‡å­—æ–‡ã®å¹…
		add_message("ç‚ã‚’é™¤å»ã™ã‚‹ã«ã¯ã“ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’ï¼’å›è¡Œã†å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚");
		add_message("éš£ã®ãƒã‚¹ã¨å£ã‚„é–‰ã¾ã£ãŸæ‰‰ã§é˜»ã¾ã‚Œã¦ã„ã‚‹å ´åˆã¯æ¶ˆç«ã§ãã¾ã›ã‚“ã€‚");
		add_message("ã€€");
		add_message("ä¸€éƒ¨ã®ãƒ­ãƒ¼ãƒ«ã¯æ¶ˆç«ã«2APã‹ã‹ã‚Šã¾ã™ã€‚");
		game.phase=12.5;


	}else if(game.phase==12.5){

		extinguish(7,1);

		game.scene = 1;game.phase=13;
		clear_message();
		//d_message("â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹");	â†ã“ã‚Œã§å…¨è§’30æ–‡å­—æ–‡ã®å¹…
		add_message("æ¶ˆç«ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’2å›è¡Œã£ã¦å®Œå…¨ã«æ¶ˆç«ã—ã¾ã—ãŸã€‚");

	}else if(game.phase==13){


		game.scene = 1;game.phase=13.5;
		card_td[3].style="background-color:#f0e0d0";
		clear_message();
		//d_message("â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹");	â†ã“ã‚Œã§å…¨è§’30æ–‡å­—æ–‡ã®å¹…
		add_message("ã¤ã‹ã‚€ï¼æ‰‹æ”¾ã™:0AP");
		add_message("è‡ªåˆ†ã®ãƒã‚¹ã«è¦æ•‘åŠ©è€…ã‚„å±é™ºç‰©ãªã©ãŒã‚ã‚Œã°");
		add_message("ãã‚Œã‚’ã¤ã‹ã‚€ã“ã¨ãŒå‡ºæ¥ã¾ã™ã€‚");
		add_message("ã¤ã‹ã‚€äº‹ã§ç§»å‹•ã®éš›ã«ãã‚Œã‚’é‹ã¶ã“ã¨ãŒã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚");
		add_message("å„ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ï¼‘ã¤ã¾ã§ä½•ã‹ã‚’ã¤ã‹ã‚€äº‹ãŒã§ãã¾ã™ã€‚");

	}else if(game.phase==13.5){


		grab(0,0);
		phase_change(tmp_s,tmp_p);
		
		clear_message();
		//d_message("â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹");	â†ã“ã‚Œã§å…¨è§’30æ–‡å­—æ–‡ã®å¹…
		add_message("ä½•ã‹ã‚’ã¤ã‹ã‚“ã§ã„ã‚‹çŠ¶æ…‹ã ã¨");
		add_message("ã€Œç§»å‹•ã€ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãŒã€Œé‹ã¶ã€ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã«å¤‰ã‚ã‚Šã¾ã™ã€‚");


	}else if(game.phase==14){

		player_move(0,6,0);
		phase_change(tmp_s,tmp_p);

		clear_message();
		//d_message("â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹");	â†ã“ã‚Œã§å…¨è§’30æ–‡å­—æ–‡ã®å¹…
		add_message("<b>è¦æ•‘åŠ©è€…</b>ã‚’<b>æ•‘æ€¥è»Šã¾ã§é‹ã¶</b>ã“ã¨ã§æ•‘å‡ºã§ãã¾ã™ã€‚");
		add_message("<b>å±é™ºç‰©</b>ã¯<b>å»ºç‰©ã®å¤–å‘¨ã¾ã§é‹ã¶</b>ã“ã¨ã§å‡¦åˆ†ã§ãã¾ã™ã€‚");
		add_message("ã€€");
		add_message("è¦æ•‘åŠ©è€…ã‚’æ•‘å‡ºã—ãŸã‚‰ç”Ÿé‚„è€…("+emoji["alive"].chara+")ãŒ1å¢—ãˆã¾ã™ã€‚");
		add_message("ï¼—äººä»¥ä¸Šæ•‘å‡ºã™ã‚‹ã‚Œã°å‹åˆ©ã¨ãªã‚Šã¾ã™ã€‚");
		game.phase++;

	}else if(game.phase==15){


		card_td[9].style="background-color:#f0e0d0";
		clear_message();
		//d_message("â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹");	â†ã“ã‚Œã§å…¨è§’30æ–‡å­—æ–‡ã®å¹…
		add_message("ã‚¿ãƒ¼ãƒ³ä¸­ã®è¡Œå‹•ãŒã™ã¹ã¦çµ‚ã‚ã£ãŸã‚‰");
		add_message("ã€Œã‚¿ãƒ¼ãƒ³çµ‚äº†ã€ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦çµ‚äº†ã—ã¾ã™ã€‚");
		add_message("ã€€");
		add_message("ã“ã®æ™‚ç‚¹ã§æœªä½¿ç”¨ã®AP"+emoji["ap"].chara+"ãŒæŒã¡è¶Šã•ã‚Œã¾ã™ãŒã€");
		add_message("ãƒ­ãƒ¼ãƒ«ã«ã‚ˆã£ã¦ä»˜ä¸ã•ã‚Œã‚‹ç‰¹æ®ŠAP"+emoji["sap"].chara+"ã¯ãªããªã‚Šã¾ã™ã€‚");

		game.phase++;

	}else if(game.phase==16){

		show_option(["æ¬¡ã¸"]);

		clear_message();
		//d_message("â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹");	â†ã“ã‚Œã§å…¨è§’30æ–‡å­—æ–‡ã®å¹…
		add_message("ã‚¿ãƒ¼ãƒ³çµ‚äº†å¾Œã¯ã€Œç‚ã®æ‹¡å¤§ã€ã¨ã€Œä¸å¯©ç®‡æ‰€ã®è£œå……ã€ã‚’è¡Œã„");
		add_message("æ¬¡ã®ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã«ã‚¿ãƒ¼ãƒ³ãŒæ¸¡ã‚Šã¾ã™ã€‚");

		game.phase++;

	}else if(game.phase==17){

		clear_message();
		//d_message("â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹");	â†ã“ã‚Œã§å…¨è§’30æ–‡å­—æ–‡ã®å¹…
		add_message("ã€Œç‚ã®æ‹¡å¤§ã€ã§ã¯ãƒ©ãƒ³ãƒ€ãƒ ãªåœ°ç‚¹ã«ç…™"+emoji["smoke"].chara+"ãŒç™ºç”Ÿã—ã¾ã™ã€‚");
		add_message("æ—¢ã«ç…™"+emoji["smoke"].chara+"ãŒã‚ã‚‹å ´åˆã«ã¯ç‚"+emoji["fire"].chara+"ãŒç™ºç”Ÿã—ã¾ã™ã€‚");
		add_message("æ—¢ã«ç‚"+emoji["fire"].chara+"ãŒã‚ã£ãŸå ´åˆã¯ã€Œçˆ†ç™ºã€ãŒèµ·ãã¾ã™ã€‚");
		add_message("é«˜æ¸©ç‚¹"+emoji["hotspot"].chara+"ã®ã‚ã‚‹åœ°ç‚¹ã«å½“ãŸã£ãŸå ´åˆã€");
		add_message("ä¸€é€£ã®å‡¦ç†ã®å¾Œã«å†åº¦ã€Œç‚ã®æ‹¡å¤§ã€ã‚’è¡Œã„ã€é«˜æ¸©ç‚¹ã‚’è¿½åŠ ã—ã¾ã™ã€‚");

		game.phase++;
	}else if(game.phase==18){
		board.fire[7][2]=1;
		show_option(["æ¬¡ã¸"]);
		draw_board();
		draw_circle(7,2);
		clear_message();
		//d_message("â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹");	â†ã“ã‚Œã§å…¨è§’30æ–‡å­—æ–‡ã®å¹…
		add_message("ä»Šå›ã¯åœ°ç‚¹[7,2]ãŒé¸ã°ã‚Œç…™ãŒç™ºç”Ÿã—ãŸã ã‘ã§æ¸ˆã¿ã¾ã—ãŸã€‚");
		add_message("â€¦ã¨ã¯è¡Œãã¾ã›ã‚“ã€‚");
		add_message("ã€Œç‚ã®æ‹¡å¤§ã€ã§ã¯ç…™ã¸ã®å¼•ç«ã¨å±é™ºç‰©ã®çˆ†ç™ºã‚‚èµ·ãã‚‹ã®ã§ã™ã€‚");

		game.phase++;

	}else if(game.phase==19){
		board.fire[7][2]=2;
		draw_board();
		clear_message();
		//d_message("â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹");	â†ã“ã‚Œã§å…¨è§’30æ–‡å­—æ–‡ã®å¹…
		add_message("ã€Œç‚ã®æ‹¡å¤§ã€ã®æœ€ä¸­ã«ç‚"+emoji["fire"].chara+"ã¨éš£æ¥ã—ãŸç…™"+emoji["smoke"].chara+"ã¯");
		add_message("å¼•ç«ã—ã¦ç‚"+emoji["fire"].chara+"ã«å¤‰ã‚ã‚Šã¾ã™ã€‚ã“ã‚ãƒã‚‡ï½");
		add_message("ã€€");
		add_message("å£ã‚„é–‰ã˜ãŸæ‰‰ã§é˜»ã¾ã‚Œã¦ã„ã‚‹å ´åˆã¯å¼•ç«ã—ã¾ã›ã‚“ã€‚");

		game.phase++;

	}else if(game.phase==20){

		clear_message();
		//d_message("â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹");	â†ã“ã‚Œã§å…¨è§’30æ–‡å­—æ–‡ã®å¹…
		add_message("ã€Œç‚ã®æ‹¡å¤§ã€ã®æœ€ä¸­ã«ç‚"+emoji["fire"].chara+"ã®ãƒã‚¹ã«å±é™ºç‰©<span style='background-color:"+hazmat_color+"'>"+emoji["hazmat"].chara+"</span>ãŒã‚ã‚‹å ´åˆã€");
		add_message("ã€Œçˆ†ç™ºã€ãŒç™ºç”Ÿã—ã€ãã“ã«é«˜æ¸©ç‚¹ãŒç½®ã‹ã‚Œã¾ã™ã€‚");
		add_message("ã€€");
		add_message("ä»Šå›ã¯å±é™ºç‰©ã«é–¢ã—ã¦ã¯å¤§ä¸ˆå¤«ã§ã™ã­ã€‚");

		game.phase++;

	}else if(game.phase==21){

		poi[2].x=6;
		poi[2].y=2;
		poi[2].status=1;
		draw_board();
		draw_circle(6,2);

		clear_message();
		//d_message("â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹");	â†ã“ã‚Œã§å…¨è§’30æ–‡å­—æ–‡ã®å¹…
		add_message("ã€Œç‚ã®æ‹¡å¤§ã€ã®å‡¦ç†ãŒå®Œäº†ã—ãŸã‚‰ã€Œä¸å¯©ç®‡æ‰€ã®è£œå……ã€ã‚’è¡Œã„ã¾ã™ã€‚");
		add_message("ã€€");
		add_message("15å€‹ã®ä¸å¯©ç®‡æ‰€ã‚’ä½¿ã„åˆ‡ã£ã¦ã„ãªã„é™ã‚Šã€3ã¤ã«ãªã‚‹ã¾ã§ç½®ãã¾ã™ã€‚");
		add_message("ç…™ã‚„ç‚ã‚„ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãŒã„ãªã„åœ°ç‚¹ã«ãƒ©ãƒ³ãƒ€ãƒ ã«è£œå……ã•ã‚Œã¾ã™ã€‚");
		add_message("ï¼ˆãªã‚‹ã¹ãä¸­å¤®ã‚ˆã‚Šã«ç½®ã‹ã‚Œã‚‹ã‚ˆã†ã«å‡¦ç†ã—ã¦ã„ã¾ã™ã€‚ï¼‰");

		game.phase++;

	}else if(game.phase==22){

		pass_turn();
		phase_change(tmp_s,tmp_p);
		
		clear_message();
		//d_message("â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹");	â†ã“ã‚Œã§å…¨è§’30æ–‡å­—æ–‡ã®å¹…
		add_message("æ¬¡ã®ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã«ã‚¿ãƒ¼ãƒ³ã‚’æ¸¡ã—ã¾ã™ã€‚");
		add_message("ã€€");
		add_message("æ®‹ã‚Šã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã¨ã€Œç‚ã®æ‹¡å¤§ã€ä¸­ã«èµ·ãã‚‹ã€Œçˆ†ç™ºã€ã«ã¤ã„ã¦");
		add_message("å®Ÿéš›ã®å‹•ãã‚’äº¤ãˆã¦èª¬æ˜ã—ã¾ã™ã€‚");

		game.phase++;
	}else if(game.phase==23){

		card_td[6].style="background-color:#f0e0d0";

		
		clear_message();
		//d_message("â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹");	â†ã“ã‚Œã§å…¨è§’30æ–‡å­—æ–‡ã®å¹…
		add_message("ãƒ­ãƒ¼ãƒ«ã®å¤‰æ›´:2AP");
		add_message("ã‚¿ãƒ¼ãƒ³ã®æœ€åˆã«æ¶ˆé˜²è»Šã®ä¸Šã«ã„ã‚‹ã¨ãã€ãƒ­ãƒ¼ãƒ«ã®å¤‰æ›´ã‚’è¡Œãˆã¾ã™ã€‚");
		add_message("APã¨ç‰¹æ®ŠAPã¯å¤‰æ›´å¾Œã®ãƒ­ãƒ¼ãƒ«ã®åˆæœŸå€¤ã¨ãªã‚Š");
		add_message("ãã“ã‹ã‚‰ã“ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³åˆ†ã®2APãŒå¼•ã‹ã‚Œã¾ã™ã€‚");
		add_message("ç¹°ã‚Šè¶Šã—ãŸAPã‚‚å¼•ãç¶™ãŒã‚Œã¾ã™ã€‚");

		game.phase++;
	}else if(game.phase==24){

		show_role(1);
		
		clear_message();
		add_message("ä»–ã®ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¨é‡è¤‡ã—ãªã„ãƒ­ãƒ¼ãƒ«ã‚’é¸ã³");
		add_message("ãã®è·æ¥­ã«ãªã‚Šã¾ã™ã€‚");
		add_message("ã€€");
		add_message("ä»Šå›ã¯"+role["driver"].name+"ã«å¤‰æ›´ã—ã¾ã™ã€‚");

		game.phase++;
	}else if(game.phase==25){

		player[1].role="driver";
		game.ap=2;
		choose_action();
		game.scene = 1;game.phase=25;
		context.fillStyle="rgba(255,128,0,30%)";
		context.fillRect(masu_haji(1),masu_haji(1),masu_haji(4),masu_haji(3));
		card_td[5].style="background-color:#f0e0d0";
		
		clear_message();
		add_message("æ¶ˆé˜²è»Šã®æ”¾æ°´:4AP("+role["driver"].name+"ã¯2AP)");
		add_message("å»ºç‰©å†…ã®ä¸Šä¸‹å·¦å³ã§4åˆ†å‰²ã—ãŸ4ã¤ã®ã®ã‚¨ãƒªã‚¢ã®ã†ã¡ã€");
		add_message("æ¶ˆé˜²è»ŠãŒæ¥ã™ã‚‹ã‚¨ãƒªã‚¢ã‹ã‚‰ãƒ©ãƒ³ãƒ€ãƒ ã«åœ°ç‚¹ã‚’æŠ½é¸ã—ã€");
		add_message("ãã®åœ°ç‚¹ã¨ãã“ã«éš£æ¥ã™ã‚‹åœ°ç‚¹ã«ã‚ã‚‹ç‚ã‚„ç…™ã‚’é™¤å»ã—ã¾ã™ã€‚");
		add_message("å…·ä½“ä¾‹ã‚’ç¤ºã™ã¨ã€ã‚ªãƒ¬ãƒ³ã‚¸ã®ç¯„å›²ã‹ã‚‰æŠ½é¸ã•ã‚Œã¾ã™ã€‚");

		game.phase++;
	}else if(game.phase==26){

		clear_message();
		add_message("ãŸã ã—ã“ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’è¡Œã†ã«ã¯äºŒã¤æ¡ä»¶ãŒã‚ã‚Šã¾ã™ã€‚");
		add_message("ãƒ»ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãŒæ¶ˆé˜²è»Šã®ã‚ã‚‹ãƒã‚¹ã«ã„ã‚‹ã“ã¨");
		add_message("ãƒ»æ¶ˆé˜²è»Šã®æ”¾æ°´ã‚¨ãƒªã‚¢ã«ä»–ã®ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãŒã„ãªã„ã“ã¨");
		add_message("ã€€");
		add_message("ã“ã®ï¼’ã¤ã‚’æº€ãŸã™ã¨ãæ¶ˆé˜²è»Šã®æ”¾æ°´ãŒå¯èƒ½ã§ã™ã€‚");

		game.phase++;
	}else if(game.phase==27){

		choose_action();
		phase_change(tmp_s,tmp_p);
		draw_circle(4,2);
		
		clear_message();
		add_message("ä»Šå›ã¯åœ°ç‚¹[4,2]ãŒé¸ã°ã‚Œã¾ã—ãŸã€‚");
		add_message("ãã®åœ°ç‚¹ã¨ä¸Šä¸‹å·¦å³ã®åœ°ç‚¹ã®ã†ã¡");
		add_message("å£ã‚„é–‰ã˜ãŸæ‰‰ã§é˜»ã¾ã‚Œã¦ã„ãªã„åœ°ç‚¹ã®ç‚ã‚„ç…™ãŒé™¤å»ã•ã‚Œã¾ã™ã€‚");
		add_message("ä»Šå›ã®åœ°ç‚¹ã¯ä¸‹ã¨å£ã§é˜»ã¾ã‚Œã¦ã„ã‚‹ã®ã§ä½•ã‚‚æ¶ˆãˆã¾ã›ã‚“ã€‚");
		add_message("â€¦ã—ã‹ã—ã€"+role["driver"].name+"ã¯å†æŠ½é¸ã‚’è¡Œã†ã“ã¨ãŒå‡ºæ¥ã¾ã™ã€‚");

		game.phase++;
	}else if(game.phase==28){

		board.fire[1][1]=0;
		board.fire[2][2]=0;
		draw_board();
		phase_change(tmp_s,tmp_p);
		game.ap-=2;
		
		draw_circle(2,1);
		clear_message();
		add_message("å†æŠ½é¸ã®çµæœã€åœ°ç‚¹[2,1]ãŒé¸ã°ã‚Œã¾ã—ãŸã€‚");
		add_message("å·¦ã¨ä¸‹ã®ç‚ãŒé™¤å»ã•ã‚Œã¾ã—ãŸã€‚");
		add_message("ã€€");
		add_message("è‰¯ã„åœ°ç‚¹ãŒæŠ½é¸ã•ã‚Œã‚Œã°");
		add_message("æ¶ˆç«ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’è¶…ãˆã‚‹æˆæœã‚’å‡ºã™ã“ã¨ã‚‚å¯èƒ½ãªã®ã§ã™ã€‚");

		game.phase++;
	}else if(game.phase==29){

		choose_action();
		phase_change(tmp_s,tmp_p);
		card_td[4].style="background-color:#f0e0d0";
		
		clear_message();
		//d_message("â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹");	â†ã“ã‚Œã§å…¨è§’30æ–‡å­—æ–‡ã®å¹…
		add_message("è»Šä¸¡ã®é‹è»¢:2AP");
		add_message("è»Šä¸¡ã‚’å»ºç‰©å¤–å‘¨ã«ãã£ã¦èµ°ã‚‰ã›ã¾ã™ã€‚");
		add_message("æ™‚è¨ˆå›ã‚Š/åæ™‚è¨ˆå›ã‚Šã®ã©ã¡ã‚‰ã§ã‚‚å¯èƒ½ã§ã™ã€‚");
		add_message("ãã®è»Šä¸¡ã®æ¬¡ã®é…ç½®åœ°ç‚¹ã¨ãªã‚‹åœ°ç‚¹ã‚’é¸æŠã™ã‚‹ã“ã¨ã§");
		add_message("è»Šä¸¡ã‚’èµ°ã‚‰ã›ã‚‹ã“ã¨ãŒå‡ºæ¥ã¾ã™ã€‚");

		game.phase++;
	}else if(game.phase==30){

		choose_action();
		draw_circle(7.5,0);
		draw_circle(1.5,7);
		draw_circle(0,3.5);
		draw_circle(9,3.5);
		phase_change(tmp_s,tmp_p);
		
		clear_message();
		//d_message("â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹");	â†ã“ã‚Œã§å…¨è§’30æ–‡å­—æ–‡ã®å¹…
		add_message("ç¾åœ¨ã®æ¶ˆé˜²è»Š/æ•‘æ€¥è»Šã®åœè»Šä½ç½®ã§å…·ä½“ä¾‹ã‚’ç¤ºã™ã¨ã€");
		add_message("â—‹ã®ã‚ã‚‹ä½ç½®ãŒæ¬¡ã®é…ç½®åœ°ç‚¹ã¨ãªã‚Šã¾ã™ã€‚");
		add_message("ãã“ã‚’é¸æŠã™ã‚‹ã¨è»Šä¸¡ã‚’èµ°ã‚‰ã›ã‚‹äº‹ãŒå‡ºæ¥ã¾ã™ã€‚");

		game.phase++;

	}else if(game.phase==31){

		choose_action();
		phase_change(tmp_s,tmp_p);
		
		clear_message();
		//d_message("â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹");	â†ã“ã‚Œã§å…¨è§’30æ–‡å­—æ–‡ã®å¹…
		add_message("æ¶ˆé˜²è»Šã®èµ°è¡Œã¯ç¾åœ¨ã®ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãŒä¹—ã£ã¦ã„ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ãŒã€");
		add_message("æ•‘æ€¥è»Šã¯èª°ã‚‚ä¹—ã£ã¦ã„ãªãã¦ã‚‚æ“ä½œã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚");
		add_message("ï¼ˆæ•‘æ€¥è»ŠãŒåˆ°ç€ã—ãŸåœ°ç‚¹ã«è¦æ•‘åŠ©è€…ãŒã„ã‚Œã°å³åº§ã«æ•‘å‡ºã•ã‚Œã¾ã™ã€‚ï¼‰");
		add_message("è»Šä¸¡ã®èµ°è¡Œã¯åŒæ™‚ã«ä»–ã®ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’ä¹—ã›ã‚‹ã“ã¨ãŒå‡ºæ¥ã¾ã™ã€‚");

		game.phase++;
	}else if(game.phase==32){

		choose_action();
		phase_change(tmp_s,tmp_p);
		
		clear_message();
		//d_message("â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹");	â†ã“ã‚Œã§å…¨è§’30æ–‡å­—æ–‡ã®å¹…
		add_message("ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’ä¹—ã›ã¦èµ°è¡Œã—ãŸå ´åˆã€");
		add_message("é™è»Šã™ã‚‹ä½ç½®ã¯è»Šä¸¡ãŒã‚ã‚‹ãƒã‚¹ã®ä¸­ã§ä»»æ„ã«é¸ã³ã¾ã™ã€‚");
		add_message("ã€€");
		add_message("ä»Šå›ã¯APãŒãŸã‚Šãªã„ã®ã§å‰²æ„›");

		game.phase++;


	}else if(game.phase==33){


		card_td[9].style="background-color:#f0e0d0";
		clear_message();
		add_message("ã‚¿ãƒ¼ãƒ³ä¸­ã®è¡Œå‹•ãŒã™ã¹ã¦çµ‚ã‚ã£ãŸã®ã§");
		add_message("ã€Œã‚¿ãƒ¼ãƒ³çµ‚äº†ã€ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦çµ‚äº†ã—ã¾ã™ã€‚");

		game.phase++;

	}else if(game.phase==34){
		show_option(["æ¬¡ã¸"]);
		draw_board();
		draw_circle(1,2);
		clear_message();
		//d_message("â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹");	â†ã“ã‚Œã§å…¨è§’30æ–‡å­—æ–‡ã®å¹…
		add_message("ä»Šå›ã¯åœ°ç‚¹[1,2]ãŒé¸ã°ã‚Œã¾ã—ãŸã€‚");
		add_message("æ—¢ã«ç‚ãŒã‚ã‚‹ã®ã§ã€Œçˆ†ç™ºã€ãŒèµ·ãã¾ã™ã€‚");
		add_message("ã€€");
		add_message("ã“ã‚Œã‹ã‚‰ã€Œçˆ†ç™ºã€ã®èª¬æ˜ã‚’ã—ã¾ã™ã€‚");

		game.phase++;

	}else if(game.phase==35){

		draw_board();
		clear_message();
		//d_message("â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹");	â†ã“ã‚Œã§å…¨è§’30æ–‡å­—æ–‡ã®å¹…
		add_message("ã€Œçˆ†ç™ºã€ãŒèµ·ããŸã‚‰ä¸Šä¸‹å·¦å³ã®ãƒã‚¹ã«ä»¥ä¸‹ã®å½±éŸ¿ã‚’ä¸ãˆã¾ã™ã€‚");
		add_message("ãƒ»å£ãŒã‚ã‚‹å ´åˆã«ã¯ã€Œå£ã‚’å£Šã™ã€åŒæ§˜ã«æå‚·ã‚’ä¸ãˆã¾ã™ã€‚");
		add_message("ãƒ»æ‰‰ãŒã‚ã‚‹å ´åˆã«ã¯å–ã‚Šé™¤ãã¾ã™ã€‚");
		add_message("ãƒ»æ‰‰ãŒé–‹ã„ã¦ã„ãŸã‚Šé˜»ã‚€ç‰©ãŒãªã‘ã‚Œã°ç‚ãŒç™ºç”Ÿã—ã€");
		add_message("ã€€æ—¢ã«ç‚ãŒã‚ã‚‹å ´åˆã«ã¯ã€Œã‚·ãƒ§ãƒƒã‚¯ã‚¦ã‚§ãƒ¼ãƒ–ã€ãŒèµ·ãã¾ã™ã€‚");

		game.phase++;
	}else if(game.phase==36){

		explode(1,2);
		draw_board();
		show_option(["æ¬¡ã¸"]);
		clear_message();
		//d_message("â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹");	â†ã“ã‚Œã§å…¨è§’30æ–‡å­—æ–‡ã®å¹…
		add_message("ã€Œã‚·ãƒ§ãƒƒã‚¯ã‚¦ã‚§ãƒ¼ãƒ–ã€ãŒèµ·ããŸã‚‰é€²è¡Œæ–¹å‘ã«ä»¥ä¸‹ã®å½±éŸ¿ã‚’ä¸ãˆã¾ã™ã€‚");
		add_message("ãƒ»é€²è¡ŒãŒæ­¢ã¾ã‚‹ã‹ç”»é¢ç«¯ã«åˆ°é”ã™ã‚‹ã¾ã§é“ä¸­ã«ç‚ãŒç™ºç”Ÿã—ã¾ã™ã€‚");
		add_message("ãƒ»å£ãŒã‚ã‚‹å ´åˆã«ã¯ã€Œå£ã‚’å£Šã™ã€åŒæ§˜ã«æå‚·ã‚’ä¸ãˆã€é€²è¡ŒãŒæ­¢ã¾ã‚Šã¾ã™ã€‚");
		add_message("ãƒ»æ‰‰ã®å ´åˆã«ã¯å–ã‚Šé™¤ãã€é–‰ã¾ã£ã¦ãŸã‚‰ãã“ã§é€²è¡ŒãŒæ­¢ã¾ã‚Šã¾ã™ã€‚");
		add_message("ãƒ»æ‰‰ãŒé–‹ã„ã¦ãŸã‚Šé˜»ã‚€ç‰©ãŒãªã‘ã‚Œã°ç”»é¢ç«¯ã¾ã§é€²è¡Œã—ã¾ã™");

		game.phase++;

	}else if(game.phase==37){

		draw_board();
		draw_circle(1,4);
		clear_message();
		//d_message("â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹");	â†ã“ã‚Œã§å…¨è§’30æ–‡å­—æ–‡ã®å¹…
		add_message("ã¨ã“ã‚ã§ã€çˆ†ç™ºã®çµæœã€å±é™ºç‰©ã®ã‚ã‚‹ãƒã‚¹ã«ç‚ãŒç™ºç”Ÿã—ã¾ã—ãŸã­ã€‚");
		add_message("å±é™ºç‰©ã®ãƒã‚¹ã«ç‚ãŒç™ºç”Ÿã—ãŸã®ã§å±é™ºç‰©ã®çˆ†ç™ºå‡¦ç†ã‚’è¡Œã„ã¾ã™ã€‚");

		game.phase++;

	}else if(game.phase==38){

		hazmat[0].status=0;
		explode(1,4);
		add_hotspot(1,4);
		show_option(["æ¬¡ã¸"]);
		draw_board();
		clear_message();
		//d_message("â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹");	â†ã“ã‚Œã§å…¨è§’30æ–‡å­—æ–‡ã®å¹…
		add_message("å±é™ºç‰©ãŒã‚ã‚‹åœ°ç‚¹ã«ç‚ãŒç™ºç”Ÿã—ãŸå ´åˆã€å³åº§ã«çˆ†ç™ºã—ã¾ã™ã€‚");
		add_message("ã¾ãŸã€å…ˆè¿°ã®çˆ†ç™ºå‡¦ç†ã«åŠ ãˆã¦é«˜æ¸©ç‚¹ãŒè¿½åŠ ã•ã‚Œã¾ã™ã€‚");
		add_message("ä»Šå›ã¯ä¸Šã‹ã‚‰ã®ã‚·ãƒ§ãƒƒã‚¯ã‚¦ã‚§ãƒ¼ãƒ–ã§çˆ†ç™ºã—ãŸã®ã§");
		add_message("ç‚ã‚’ã•ã‹ã®ã¼ã£ã¦ãŠã‹ãˆã‚Šã‚·ãƒ§ãƒƒã‚¯ã‚¦ã‚§ãƒ¼ãƒ–ãŒèµ·ãã¾ã™ã€‚ï½¶ï¾œï½²ï½²");

		game.phase++;

	}else if(game.phase==39){

		draw_board();
		draw_circle(1,2);
		clear_message();
		//d_message("â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹");	â†ã“ã‚Œã§å…¨è§’30æ–‡å­—æ–‡ã®å¹…
		add_message("ã•ã‚‰ã«ã€æœ€åˆã®ã€Œç‚ã®æ‹¡å¤§ã€ãŒèµ·ããŸåœ°ç‚¹ã«é«˜æ¸©ç‚¹ãŒã‚ã‚Šã¾ã™ã­ã€‚");
		add_message("é«˜æ¸©ç‚¹ãŒã‚ã‚‹ãƒã‚¹ãªã®ã§ã€ã‚‚ã†ä¸€åº¦ã€Œç‚ã®æ‹¡å¤§ã€å‡¦ç†ã‚’è¡Œã„ã¾ã™ã€‚");
		add_message("ã€€");
		add_message("å†ã³é«˜æ¸©ç‚¹ãŒã‚ã‚‹ãƒã‚¹ãŒé¸ã°ã‚ŒãŸå ´åˆã«ã‚‚åŒæ§˜ã«å‡¦ç†ã—ã¾ã™ã€‚");
		add_message("ã“ã‚Œã¯é«˜æ¸©ç‚¹ãŒãªã„ãƒã‚¹ãŒé¸ã°ã‚Œã‚‹ã¾ã§ç¶šãã¾ã™ã€‚")

		game.phase++;

	}else if(game.phase==40){


		explode(8,2);
		draw_board();
		draw_circle(8,2);
		show_option(["æ¬¡ã¸"]);
		clear_message();
		//d_message("â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹");	â†ã“ã‚Œã§å…¨è§’30æ–‡å­—æ–‡ã®å¹…
		add_message("2åº¦ç›®ã®ã€Œç‚ã®æ‹¡å¤§ã€ã¯[8,2]ãŒé¸ã°ã‚Œã¾ã—ãŸã€‚");
		add_message("é«˜æ¸©ç‚¹ãŒãªã„ã®ã¯å¹¸ã„ã§ã™ãŒã€çˆ†ç™ºã¯ã¤ã‚‰ã„ã§ã™ã­ã€‚");
		game.phase++;

	}else if(game.phase==41){


		add_hotspot(8,2);
		draw_board();
		show_option(["æ¬¡ã¸"]);
		clear_message();
		add_message("é«˜æ¸©ç‚¹ã«ã‚ˆã£ã¦å†åº¦ã€Œç‚ã®æ‹¡å¤§ã€ãŒç™ºç”Ÿã—ãŸåœ°ç‚¹ã«ã¯");
		add_message("æ–°ãŸãªé«˜æ¸©ç‚¹ãŒä»˜ä¸ã•ã‚Œã¾ã™ã€‚ï¼ˆæ—¢ã«ã‚ã‚‹å ´åˆã¯ä»˜ä¸ã•ã‚Œã¾ã›ã‚“ã€‚ï¼‰");
		add_message("ã‚²ãƒ¼ãƒ é–‹å§‹æ™‚ã«è¿½åŠ ã§ç”¨æ„ã—ãŸé«˜æ¸©ç‚¹ãŒå°½ããŸã‚‰ä»˜ä¸ã—ã¾ã›ã‚“ã€‚");
		game.phase++;

	}else if(game.phase==42){


		draw_board();
		show_option(["æ¬¡ã¸"]);
		clear_message();
		//d_message("â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹");	â†ã“ã‚Œã§å…¨è§’30æ–‡å­—æ–‡ã®å¹…
		add_message("ã€Œç‚ã®æ‹¡å¤§ã€ãŒçµ‚äº†ã—ãŸã¨ã“ã‚ã§ã€Œä¸å¯©ç®‡æ‰€ã®è£œå……ã€ã§ã™ã€‚");
		add_message("ã€€");
		add_message("ä¸å¯©ç®‡æ‰€ãŒç„¼ã‹ã‚Œã¦ã„ã‚‹å ´åˆã¯è¦æ•‘åŠ©è€…ã®å­˜å¦ã‚’ç¢ºèªã—ã€");
		add_message("è¦æ•‘åŠ©è€…ãŒç„¼ã‹ã‚Œã¦ãŸã‚‰æ­»äº¡ã—ã¾ã™ã€‚");
		game.phase++;

	}else if(game.phase==43){

		poi[0].status = 2;
		poi[2].status = 0;
		draw_board();
		show_option(["æ¬¡ã¸"]);

		clear_message();
		//d_message("â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹");	â†ã“ã‚Œã§å…¨è§’30æ–‡å­—æ–‡ã®å¹…
		add_message("å³ã®ä¸å¯©ç®‡æ‰€ã¯èª¤å ±ã§ã—ãŸãŒã€å·¦ã®ä¸å¯©ç®‡æ‰€ã«ã¯äººãŒã„ã¾ã—ãŸã€‚");
		add_message("ã€€");
		add_message("è¦æ•‘åŠ©è€…ãŒã„ãŸå ´åˆã«ã¯æ­»äº¡("+emoji["dead"].chara+")ãŒ1å¢—ãˆã¾ã™ã€‚");
		add_message("4åæ­»äº¡ã•ã›ãŸæ™‚ç‚¹ã§æ•—åŒ—ãŒæ±ºã¾ã‚Šã¾ã™ã€‚");
		add_message("ç„¼ã‹ã‚ŒãŸä¸å¯©ç®‡æ‰€ã¯å–ã‚Šé™¤ã‹ã‚Œã€æ–°ãŸã«ä¸å¯©ç®‡æ‰€ãŒè£œå……ã•ã‚Œã¾ã™ã€‚");
		game.phase++;

	}else if(game.phase==44){

		poi[0].status = 0;
		game.dead++;
		refill_poi();
		phase_change(tmp_s,tmp_p);

		draw_board();
		show_option(["æ¬¡ã¸"]);
		clear_message();
		//d_message("â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹");	â†ã“ã‚Œã§å…¨è§’30æ–‡å­—æ–‡ã®å¹…
		add_message("ã“ã®ã‚ˆã†ã«å„ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã§ã‚¿ãƒ¼ãƒ³ã‚’é€²ã‚ã¦ã„ãã€")
		add_message("å»ºç‰©ã®è€ä¹…å€¤ãŒãªããªã‚‹ã¾ã§ã«è¦æ•‘åŠ©è€…ã‚’æ•‘ã„å‡ºã™ã“ã¨ã‚’ç›®æŒ‡ã—ã¦");
		add_message("å¥®é—˜ã—ã¦ã„ãã¾ã—ã‚‡ã†ï¼");
		add_message("ã€€");
		add_message("7åæ•‘å‡ºã—ãŸã‚ã¨ã‚‚ã€10äººå®Œå…¨æ•‘å‡ºã‚’ç›®æŒ‡ã—ã¦ç¶šè¡Œã§ãã¾ã™ã€‚");
		game.phase++;

	}else if(game.phase == 100){
		game.difficulty = -1;
		init_map("first_easy");
		player=[{role:"generalist",x:-1,y:-1,grab:[],color:p_color[0],chara:"p1",ap:0}];
		player.push({role:"generalist",x:-1,y:-1,grab:[],color:p_color[1],chara:"p2",ap:0});
		player.push({role:"generalist",x:-1,y:-1,grab:[],color:p_color[2],chara:"p3",ap:0});
		game.damage=24;
		game.poi_rest=15;
		game.turn = 0;
		//d_message("â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹");	â†ã“ã‚Œã§å…¨è§’30æ–‡å­—æ–‡ã®å¹…
		clear_message();
		show_option(["æ¬¡ã¸"]);
		add_message(" - ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ« (ç°¡æ˜“ãƒ«ãƒ¼ãƒ«) - ");
		add_message("ã€€");
		add_message("ã€ŒRESCUEã€ã¯å„ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãŒæ¶ˆé˜²å£«ã¨ãªã£ã¦ç«ç½ã‚’æ¶ˆç«ã—ã¤ã¤ã€");
		add_message("24ãƒã‚¤ãƒ³ãƒˆã‚ã‚‹å»ºç‰©ã®è€ä¹…å€¤ãŒãªããªã‚‹å‰ã«");
		add_message("è¦æ•‘åŠ©è€…ã‚’ç™ºè¦‹ã—ã€æ•‘å‡ºã—ã¦ã„ãã“ã¨ã‚’ç›®æŒ‡ã™ã‚²ãƒ¼ãƒ ã§ã™ã€‚");

		game.phase++;
	}else if(game.phase==101){


		board.fire[2][2]=2;
		board.fire[3][2]=2;
		board.fire[2][3]=2;
		board.fire[3][3]=2;
		board.fire[4][3]=2;
		board.fire[5][3]=2;
		board.fire[4][4]=2;
		board.fire[6][5]=2;
		board.fire[7][5]=2;
		board.fire[6][6]=2;
		
		poi.push({x:4,y:2,grab:0,who:0,status:1});game.poi_rest--;
		poi.push({x:1,y:5,grab:0,who:0,status:1});game.poi_rest--;
		poi.push({x:8,y:5,grab:0,who:0,status:1});game.poi_rest--;


		show_option(["æ¬¡ã¸"]);

		draw_board();
		clear_message();
		add_message("ã‚²ãƒ¼ãƒ ã®é–‹å§‹æ™‚ã«ç‚ã¨ä¸å¯©ç®‡æ‰€(<span style='background-color:"+poi_color+"'>"+emoji["poi"].chara+"</span>)ãŒå®šä½ç½®ã«é…ç½®ã•ã‚Œã¾ã™ã€‚");
;
		add_message("ã€€");
		game.phase=104;

	}else if(game.phase==104){

		clear_message();

		show_option(["æ¬¡ã¸"]);
		add_message("ãã®å¾Œã€ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®åˆæœŸä½ç½®ã‚’æ±ºã‚ã¾ã™ã€‚");
		add_message("ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¯å»ºç‰©å¤–å‘¨ã®ã„ãšã‚Œã‹ã®ä½ç½®ã‹ã‚‰");
		add_message("åˆæœŸä½ç½®ã‚’é¸ã³ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãã ã•ã„ã€‚");
		game.phase++;

	}else if(game.phase==105){

		clear_message();

		player[0].x = 3;player[0].y=7;
		player[1].x = 0;player[1].y=3;
		player[2].x = 0;player[2].y=3;
		draw_board();

		show_option(["æ¬¡ã¸"]);
		add_message("ã“ã‚Œã§ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ãŒå®Œäº†ã—ã¾ã—ãŸã€‚ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼1ã‹ã‚‰é †ã«ã‚²ãƒ¼ãƒ ãŒå§‹ã¾ã‚Šã¾ã™ã€‚");
		game.phase++;

	}else if(game.phase==106){

		take_my_turn();
		phase_change(tmp_s,tmp_p);
		clear_message();
		add_message("ã‚¿ãƒ¼ãƒ³ã®ã¯ã˜ã‚ã«4ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒã‚¤ãƒ³ãƒˆ(APã€"+emoji["ap"].chara+"ã§è¡¨ç¤º)ãŒ");
		add_message("ä»˜ä¸ã•ã‚Œã¾ã™ã€‚APãŒæ®‹ã£ã¦ã„ã‚‹é™ã‚Šã€å¥½ããªã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’å¥½ããªé †ã§");
		add_message("ä½•åº¦ã‚‚å®Ÿè¡Œã™ã‚‹ã“ã¨ãŒå‡ºæ¥ã¾ã™ã€‚");
		add_message("æœªä½¿ç”¨ã®APã¯4APã¾ã§æ¬¡ã®è‡ªåˆ†ã®ã‚¿ãƒ¼ãƒ³ã«æŒã¡è¶Šã™ã“ã¨ãŒå‡ºæ¥ã¾ã™ã€‚");
		game.phase++;

	}else if(game.phase==107){

		card_td[0].style="background-color:#f0e0d0";
		clear_message();
		add_message("ç§»å‹•:1AP ï¼ é‹ã¶:2AP");
		add_message("éš£æ¥ãƒã‚¹ã‚’æŒ‡å®šã—ã¦ãã¡ã‚‰ã®æ–¹å‘ã«ç§»å‹•ã—ã¾ã™ã€‚");
		add_message("ä½•ã‹ã‚’ã¤ã‹ã‚“ã çŠ¶æ…‹ã§ã‚ã‚Œã°ã€ç§»å‹•ã¨åŒæ™‚ã«é‹ã³ã¾ã™ã€‚");
		add_message("ä½•ã‚‚ã¤ã‹ã‚“ã§ã„ãªã‘ã‚Œã°ç‚("+emoji["fire"].chara+")ã®ä¸­ã«ã‚‚ç§»å‹•ã§ãã¾ã™ã€‚ï¼ˆ2APï¼‰");
		add_message("ãŸã ã—ã€ç‚ã®ä¸Šã§ã‚¿ãƒ¼ãƒ³ã‚’çµ‚äº†ã™ã‚‹ã“ã¨ã¯å‡ºæ¥ã¾ã›ã‚“ã€‚");

		game.phase++;

	}else if(game.phase==108){

		player[0].x=1;player[0].y=5;
		game.ap=0;
		poi[1].status = 2;
		choose_action();
		phase_change(tmp_s,tmp_p);
		draw_board();
		clear_message();
		add_message("ä¸å¯©ç®‡æ‰€ã¨åŒã˜ãƒã‚¹ã«ã„ã‚‹å ´åˆã€è¦æ•‘åŠ©è€…ã®å­˜å¦ãŒåˆ¤æ˜ã—ã¾ã™ã€‚");
		add_message("ï¼ˆä¸å¯©ç®‡æ‰€ã®ä¸­ã«è¦æ•‘åŠ©è€…ãŒ10ã€èª¤å ±ãŒ5ã‚ã‚Šã¾ã™ã€‚ï¼‰");
		add_message("ã€€");
		add_message("è¦æ•‘åŠ©è€…ã®å­˜åœ¨ãŒåˆ¤æ˜ã—ãŸã‚‰"+emoji["victim"].chara+"ã§è¡¨ç¤ºã•ã‚Œã¾ã™ã€‚");
		game.phase++;


	}else if(game.phase==109){

		game.ap=4;
		choose_action();
		phase_change(tmp_s,tmp_p);
		draw_circle(1,4);

		card_td[1].style="background-color:#f0e0d0";
		clear_message();
		add_message("æ‰‰ã®é–‹é–‰:1AP ï¼ å£ã‚’å£Šã™:2AP("+role["rescue"].name+"ã¯1AP)");
		add_message("éš£æ¥ãƒã‚¹ã‚’æŒ‡å®šã™ã‚‹ã¨ã€é–“ã«ã‚ã‚‹æ‰‰ã®é–‹é–‰ã‚„å£ã®ç ´å£Šã‚’è¡Œã„ã¾ã™ã€‚");
		add_message("ç„¡å‚·â†’æå‚·â†’é–‹é€šã®å¤‰åŒ–ã”ã¨ã«å»ºç‰©ã®è€ä¹…å€¤ï¼ˆ"+emoji["damage"].chara+"ï¼‰ãŒæ¸›ã‚Šã¾ã™ã€‚");
		game.phase++;

	}else if(game.phase==110){

		chop(1,4);
		phase_change(tmp_s,tmp_p);

		clear_message();
		//d_message("â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹");	â†ã“ã‚Œã§å…¨è§’30æ–‡å­—æ–‡ã®å¹…
		add_message("ç„¡å‚·ã®å£ï¼ˆå®Ÿç·šï¼‰ã‚’å£Šã™ã¨æå‚·ã—ãŸå£ï¼ˆç ´ç·šï¼‰ã«ãªã‚Šã€");
		add_message("æå‚·ã—ãŸå£ã‚’å£Šã™ã¨é–‹é€šã—ã€é€šã‚Œã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚");
		add_message("ã€€");
		game.phase++;

	}else if(game.phase==111){

		chop(1,4);
		clear_message();
		phase_change(tmp_s,tmp_p);
		add_message("ãŸã ã—ã€ç„¡å‚·â†’æå‚·â†’é–‹é€šã®å¤‰åŒ–ã”ã¨ã«");
		add_message("å»ºç‰©ã®è€ä¹…å€¤ï¼ˆ"+emoji["damage"].chara+"ï¼‰ãŒ1æ¸›ã‚Šã¾ã™ã€‚");
		game.phase++;

	}else if(game.phase==112){
		game.ap=4;
		player[0].x=4;player[0].y=5;
		choose_action();
		phase_change(tmp_s,tmp_p);

		clear_message();
		add_message("ã¾ãŸã€ã‚ªãƒ¬ãƒ³ã‚¸è‰²ã®æ‰‰ã¯é–‹ã‘é–‰ã‚ã™ã‚‹ã“ã¨ãŒå‡ºæ¥ã¾ã™ã€‚");
		game.phase++;

	}else if(game.phase==113){
		chop(4,4);
		phase_change(tmp_s,tmp_p);

		clear_message();
		//d_message("â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹");	â†ã“ã‚Œã§å…¨è§’30æ–‡å­—æ–‡ã®å¹…
		add_message("é–‹ã„ã¦ã„ã‚Œã°é€šã‚Œã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚");
		add_message("é–‰ã¾ã£ã¦ã„ã‚Œã°å¾Œè¿°ã™ã‚‹çˆ†ç™ºã‚„ã‚·ãƒ§ãƒƒã‚¯ã‚¦ã‚§ãƒ¼ãƒ–ã‚’");
		add_message("æ­¢ã‚ã‚‹äº‹ãŒã§ãã¾ã™ã€‚");
		add_message("çŠ¶æ³ã«å¿œã˜ã¦é–‹é–‰ã—ã¾ã—ã‚‡ã†ã€‚");
		game.phase++;


	}else if(game.phase==114){

		game.ap=4;
		choose_action();
		phase_change(tmp_s,tmp_p);
		clear_message();
		card_td[2].style="background-color:#f0e0d0";
		add_message("æ¶ˆç«:1AP");
		add_message("è‡ªèº«ãŒã„ã‚‹ãƒã‚¹ã‹éš£æ¥ãƒã‚¹ã‚’æŒ‡å®šã™ã‚‹ã¨ã€");
		add_message("ãã“ã«ç…™("+emoji["smoke"].chara+")ãŒã‚ã‚‹å ´åˆã¯é™¤å»ã—ã€");
		add_message("ç‚("+emoji["fire"].chara+")ãŒã‚ã‚‹å ´åˆã¯ç…™("+emoji["smoke"].chara+")ã«å¤‰ãˆã¾ã™ã€‚");
		game.phase++;



	}else if(game.phase==115){


		extinguish(4,4);
		phase_change(tmp_s,tmp_p);

		clear_message();
		//d_message("â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹");	â†ã“ã‚Œã§å…¨è§’30æ–‡å­—æ–‡ã®å¹…
		add_message("ç‚ã‚’é™¤å»ã™ã‚‹ã«ã¯ã“ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’ï¼’å›è¡Œã†å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚");
		add_message("éš£ã®ãƒã‚¹ã¨å£ã‚„é–‰ã¾ã£ãŸæ‰‰ã§é˜»ã¾ã‚Œã¦ã„ã‚‹å ´åˆã¯æ¶ˆç«ã§ãã¾ã›ã‚“ã€‚");

		game.phase++;


	}else if(game.phase==116){

		extinguish(4,4);

		phase_change(tmp_s,tmp_p);
		clear_message();
		//d_message("â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹");	â†ã“ã‚Œã§å…¨è§’30æ–‡å­—æ–‡ã®å¹…
		add_message("æ¶ˆç«ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’2å›è¡Œã£ã¦å®Œå…¨ã«æ¶ˆç«ã—ã¾ã—ãŸã€‚");
		game.phase++;

	}else if(game.phase==117){

		game.ap=4;
		player[0].x=1;player[0].y=5;
		choose_action();
		phase_change(tmp_s,tmp_p);
		card_td[3].style="background-color:#f0e0d0";
		clear_message();
		//d_message("â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹");	â†ã“ã‚Œã§å…¨è§’30æ–‡å­—æ–‡ã®å¹…
		add_message("ã¤ã‹ã‚€ï¼æ‰‹æ”¾ã™:0AP");
		add_message("è‡ªåˆ†ã®ãƒã‚¹ã«è¦æ•‘åŠ©è€…ãŒã„ã‚Œã°");
		add_message("ãã‚Œã‚’ã¤ã‹ã‚€ã“ã¨ãŒå‡ºæ¥ã¾ã™ã€‚");
		add_message("ã¤ã‹ã‚“ã ã‚‰ç§»å‹•ã®éš›ã«é‹ã¶ã“ã¨ãŒã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚");
		add_message("å„ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ï¼‘äººã¾ã§ã¤ã‹ã‚€äº‹ãŒã§ãã¾ã™ã€‚");
		game.phase++;

	}else if(game.phase==118){


		grab(0,0);
		phase_change(tmp_s,tmp_p);
		
		clear_message();
		//d_message("â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹");	â†ã“ã‚Œã§å…¨è§’30æ–‡å­—æ–‡ã®å¹…
		add_message("ä½•ã‹ã‚’ã¤ã‹ã‚“ã§ã„ã‚‹çŠ¶æ…‹ã ã¨");
		add_message("ã€Œç§»å‹•ã€ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãŒã€Œé‹ã¶ã€ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã«å¤‰ã‚ã‚Šã¾ã™ã€‚");
		game.phase++;


	}else if(game.phase==119){
		player[0].x=3;player[0].y=6;
		player_move(0,3,7);
		game.ap=0;
		phase_change(tmp_s,tmp_p);

		clear_message();
		//d_message("â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹");	â†ã“ã‚Œã§å…¨è§’30æ–‡å­—æ–‡ã®å¹…
		add_message("<b>è¦æ•‘åŠ©è€…</b>ã‚’<b>å»ºç‰©ã®å¤–å‘¨ã¾ã§é‹ã¶</b>ã“ã¨ã§æ•‘å‡ºã§ãã¾ã™ã€‚");
		add_message("ã€€");
		add_message("è¦æ•‘åŠ©è€…ã‚’æ•‘å‡ºã—ãŸã‚‰ç”Ÿé‚„è€…("+emoji["alive"].chara+")ãŒ1å¢—ãˆã¾ã™ã€‚");
		add_message("ï¼—äººä»¥ä¸Šæ•‘å‡ºã™ã‚‹ã‚Œã°å‹åˆ©ã¨ãªã‚Šã¾ã™ã€‚");
		game.phase++;

	}else if(game.phase==120){


		card_td[9].style="background-color:#f0e0d0";
		clear_message();
		//d_message("â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹");	â†ã“ã‚Œã§å…¨è§’30æ–‡å­—æ–‡ã®å¹…
		add_message("ã‚¿ãƒ¼ãƒ³ä¸­ã®è¡Œå‹•ãŒã™ã¹ã¦çµ‚ã‚ã£ãŸã‚‰");
		add_message("ã€Œã‚¿ãƒ¼ãƒ³çµ‚äº†ã€ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦çµ‚äº†ã—ã¾ã™ã€‚");
		add_message("ã€€");
		add_message("ã“ã®æ™‚ç‚¹ã§æœªä½¿ç”¨ã®AP"+emoji["ap"].chara+"ãŒæŒã¡è¶Šã•ã‚Œã¾ã™ã€‚");

		game.phase++;

	}else if(game.phase==121){

		show_option(["æ¬¡ã¸"]);

		clear_message();
		//d_message("â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹");	â†ã“ã‚Œã§å…¨è§’30æ–‡å­—æ–‡ã®å¹…
		add_message("ã‚¿ãƒ¼ãƒ³çµ‚äº†å¾Œã¯ã€Œç‚ã®æ‹¡å¤§ã€ã¨ã€Œä¸å¯©ç®‡æ‰€ã®è£œå……ã€ã‚’è¡Œã„");
		add_message("æ¬¡ã®ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã«ã‚¿ãƒ¼ãƒ³ãŒæ¸¡ã‚Šã¾ã™ã€‚");

		game.phase++;

	}else if(game.phase==122){
		board.fire[7][2]=1;
		show_option(["æ¬¡ã¸"]);
		draw_board();
		draw_circle(7,2);

		clear_message();
		//d_message("â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹");	â†ã“ã‚Œã§å…¨è§’30æ–‡å­—æ–‡ã®å¹…
		add_message("ã€Œç‚ã®æ‹¡å¤§ã€ã§ã¯ãƒ©ãƒ³ãƒ€ãƒ ãªåœ°ç‚¹ã«ç…™"+emoji["smoke"].chara+"ãŒç™ºç”Ÿã—ã¾ã™ã€‚");

		game.phase++;
	}else if(game.phase==123){
		board.fire[7][2]=2;
		show_option(["æ¬¡ã¸"]);
		draw_board();
		draw_circle(7,2);

		clear_message();
		//d_message("â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹");	â†ã“ã‚Œã§å…¨è§’30æ–‡å­—æ–‡ã®å¹…
		add_message("æ—¢ã«ç…™"+emoji["smoke"].chara+"ãŒã‚ã‚‹å ´åˆã«ã¯ç‚"+emoji["fire"].chara+"ãŒç™ºç”Ÿã—ã¾ã™ã€‚");
		add_message("æ—¢ã«ç‚"+emoji["fire"].chara+"ãŒã‚ã£ãŸå ´åˆã¯ã€Œçˆ†ç™ºã€ãŒèµ·ãã¾ã™ã€‚");

		game.phase++;
	}else if(game.phase==124){
		for(var xx=0;xx<board.yoko;xx++)
		for(var yy=0;yy<board.tate;yy++)
		board.fire[xx][yy]=0;

		board.fire[3][3]=2;
		board.fire[4][3]=2;
		draw_board();

		draw_circle(3,3);
		clear_message();

		add_message("æ—¢ã«ç‚"+emoji["fire"].chara+"ãŒã‚ã£ãŸå ´åˆã¯ã€Œçˆ†ç™ºã€ãŒèµ·ãã¾ã™ã€‚");
		
		add_message("çˆ†ç™ºã¯èµ·ã“ã£ãŸåœ°ç‚¹ã®ä¸Šä¸‹å·¦å³ã®ãƒã‚¹ã«å½±éŸ¿ã‚’ä¸ãˆã¾ã™ã€‚");
		add_message("ã€€");
		add_message("ã“ã®ç›¤é¢ã®åœ°ç‚¹[3,3]ã§çˆ†ç™ºãŒèµ·ã“ã£ãŸå ´åˆã‚’ä¾‹ã«èª¬æ˜ã—ã¾ã™ã€‚");
		game.phase++;

	}else if(game.phase==125){
		clear_message();
		//d_message("â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹");	â†ã“ã‚Œã§å…¨è§’30æ–‡å­—æ–‡ã®å¹…
		add_message("ã€Œçˆ†ç™ºã€ãŒèµ·ããŸã‚‰ä¸Šä¸‹å·¦å³ã®ãƒã‚¹ã«ä»¥ä¸‹ã®å½±éŸ¿ã‚’ä¸ãˆã¾ã™ã€‚");
		add_message("ãƒ»å£ãŒã‚ã‚‹å ´åˆã«ã¯ã€Œå£ã‚’å£Šã™ã€åŒæ§˜ã«æå‚·ã‚’ä¸ãˆã¾ã™ã€‚");
		add_message("ãƒ»æ‰‰ãŒã‚ã‚‹å ´åˆã«ã¯å–ã‚Šé™¤ãã¾ã™ã€‚");
		add_message("ãƒ»æ‰‰ãŒé–‹ã„ã¦ã„ãŸã‚Šå£ãŒãªã‘ã‚Œã°ç‚ãŒç™ºç”Ÿã—ã¾ã™ã€‚");
		add_message("ãƒ»ãã®éš›ã€æ—¢ã«ç‚ãŒã‚ã‚‹å ´åˆã¯ã€Œã‚·ãƒ§ãƒƒã‚¯ã‚¦ã‚§ãƒ¼ãƒ–ã€ãŒèµ·ãã¾ã™ã€‚");

		game.phase++;

	}else if(game.phase==126){

		explode(3,3);
		draw_board();
		draw_circle(3,3);
		show_option(["æ¬¡ã¸"]);
		clear_message();
		//d_message("â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹");	â†ã“ã‚Œã§å…¨è§’30æ–‡å­—æ–‡ã®å¹…
		add_message("ã€Œã‚·ãƒ§ãƒƒã‚¯ã‚¦ã‚§ãƒ¼ãƒ–ã€ã¯é€²è¡Œæ–¹å‘ã®ãƒã‚¹ã«ç‚ã‚’ç™ºç”Ÿã•ã›ã¾ã™ã€‚");
		add_message("ãƒ»å£ãŒã‚ã£ãŸã‚‰ã€Œå£ã‚’å£Šã™ã€åŒæ§˜ã«æå‚·ã‚’ä¸ãˆã€é€²è¡ŒãŒæ­¢ã¾ã‚Šã¾ã™ã€‚");
		add_message("ãƒ»é–‰ã¾ã£ã¦ã„ã‚‹æ‰‰ãŒã‚ã‚Œã°æ‰‰ãŒå–ã‚Šé™¤ã‹ã‚Œã€é€²è¡ŒãŒæ­¢ã¾ã‚Šã¾ã™ã€‚");
		add_message("ãƒ»é–‹ã„ã¦ã„ã‚‹æ‰‰ãŒã‚ã‚Œã°æ‰‰ãŒå–ã‚Šé™¤ã‹ã‚Œã¾ã™ãŒã€é€²è¡Œã¯ç¶šãã¾ã™ã€‚");
		add_message("é€²è¡ŒãŒæ­¢ã¾ã‚‹ã‹ç”»é¢ç«¯ã«åˆ°é”ã™ã‚‹ã¾ã§ç‚ãŒç™ºç”Ÿã—ã¾ã™ã€‚");

		game.phase++;

	}else if(game.phase==127){

		clear_message();
		//d_message("â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹");	â†ã“ã‚Œã§å…¨è§’30æ–‡å­—æ–‡ã®å¹…
		add_message("ä»Šå›ã®ä¾‹ã§ã¯ã€åœ°ç‚¹[3,3]ã§èµ·ããŸçˆ†ç™ºã¯ä»¥ä¸‹ã®æ¬¡ã®ã¨ãŠã‚Šã§ã™ã€‚");
		add_message("ãƒ»å·¦ã®æ‰‰ã¯é–‰ã¾ã£ã¦ã„ãŸã®ã§å–ã‚Šé™¤ã‹ã‚Œã€ç‚ã¯ç™ºç”Ÿã—ã¾ã›ã‚“ã€‚");
		add_message("ãƒ»ä¸Šã®å£ã¯æå‚·ã‚’ã†ã‘ã¾ã—ãŸãŒã€ç‚ã¯ç™ºç”Ÿã—ã¾ã›ã‚“ã€‚");
		add_message("ãƒ»ä¸‹ã¯ä½•ã‚‚ãªã„ãƒã‚¹ãªã®ã§ã€ç‚ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚");
		add_message("ãƒ»å³ã¯ã‚·ãƒ§ãƒƒã‚¯ã‚¦ã‚§ãƒ¼ãƒ–ãŒèµ·ãã€åœ°ç‚¹[6,3]ã®å³å£ãŒæå‚·ã—ã¾ã—ãŸã€‚");

		game.phase++;

	}else if(game.phase==128){


		for(var xx=0;xx<board.yoko;xx++)
		for(var yy=0;yy<board.tate;yy++)
		board.fire[xx][yy]=0;

		board.fire[1][1]=1;
		board.fire[1][2]=1;
		board.fire[2][2]=1;
		board.fire[3][2]=1;
		board.fire[3][1]=1;
		board.fire[4][1]=1;
		board.fire[5][1]=1;
		board.fire[5][2]=1;
		board.fire[6][1]=1;
		board.fire[6][2]=1;
		board.wall_yoko[3][1]=1;

		poi[0].y = 1;
		player[0].y=1;
		draw_board();
		clear_message();
		//d_message("â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹");	â†ã“ã‚Œã§å…¨è§’30æ–‡å­—æ–‡ã®å¹…
		add_message("ã¾ãŸã€ç‚ã¨éš£æ¥ã—ã€å£ã‚„é–‰ã˜ã‚‰ã‚ŒãŸæ‰‰ã§éš”ã¦ã‚‰ã‚Œã¦ã„ãªã„ç…™ã¯");
		add_message("å¼•ç«ã—ã¦ç‚ã«å¤‰ã‚ã‚Šã¾ã™ã€‚");

		game.phase++;

	}else if(game.phase==129){

		board.fire[1][1]=2;
		draw_board();
		draw_circle(1,1);
		clear_message();
		//d_message("â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹");	â†ã“ã‚Œã§å…¨è§’30æ–‡å­—æ–‡ã®å¹…
		add_message("ã“ã‚Œã¯é€£é–çš„ã«ç™ºç”Ÿã—ã€ç‚ã«å¤‰ã‚ã£ãŸãƒã‚¹ã®éš£ã«ç…™ãŒã‚ã£ãŸå ´åˆ");
		add_message("ãã®ç…™ã‚‚ç‚ã«å¤‰ã‚ã‚Šã¾ã™ã€‚");
		add_message("ã€€");
		add_message("ä»Šå›ã®ä¾‹ã§åœ°ç‚¹[1,1]ã®ç…™ãŒç‚ã«ãªã£ãŸå ´åˆã‚’ç¢ºèªã—ã¾ã—ã‚‡ã†ã€‚");

		game.phase++;

	}else if(game.phase==130){

		board.fire[1][2]=2;
		board.fire[2][2]=2;
		board.fire[3][2]=2;
		board.fire[3][1]=2;
		board.fire[4][1]=2;
		board.fire[5][1]=2;
		board.fire[5][2]=2;
		draw_board();
		show_option(["æ¬¡ã¸"]);
		clear_message();
		//d_message("â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹");	â†ã“ã‚Œã§å…¨è§’30æ–‡å­—æ–‡ã®å¹…
		add_message("ã“ã®ã‚ˆã†ã«ç…™ãŒç‚ã«å¤‰ã‚ã‚Šã¾ã™ã€‚");
		add_message("é–‰ã˜ãŸæ‰‰ã¨å£ã§éš”ã¦ã‚‰ã‚Œã¦ã„ã‚‹ç…™ã¯ç‚ã«å¤‰ã‚ã‚Šã¾ã›ã‚“ã€‚");
		game.phase++;

	}else if(game.phase==131){

		draw_board();
		show_option(["æ¬¡ã¸"]);
		clear_message();
		//d_message("â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹");	â†ã“ã‚Œã§å…¨è§’30æ–‡å­—æ–‡ã®å¹…
		add_message("ã€Œç‚ã®æ‹¡å¤§ã€ã®å¾Œã€ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚„ä¸å¯©ç®‡æ‰€ãŒç‚ã®ä¸­ã«ã„ã‚‹å ´åˆã€");
		add_message("ä¸å¯©ç®‡æ‰€ã¯è¦æ•‘åŠ©è€…ã‹èª¤å ±ã‹è­˜åˆ¥ã•ã‚Œã€");
		add_message("è¦æ•‘åŠ©è€…ãŒç‚ã®ä¸­ã«ã„ãŸå ´åˆã¯æ­»äº¡ã—ã€");
		add_message("ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¯æ•‘æ€¥è»Šã®é…ç½®åœ°ç‚¹ã®ã†ã¡æœ€ã‚‚è¿‘ã„åœ°ç‚¹ã«ç§»ã‚Šã¾ã™ã€‚");
		game.phase++;

	}else if(game.phase==132){

		poi[0].status = 2;
		draw_board();
		show_option(["æ¬¡ã¸"]);
		clear_message();
		//d_message("â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹");	â†ã“ã‚Œã§å…¨è§’30æ–‡å­—æ–‡ã®å¹…
		add_message("ã“ã®å ´åˆã€ã¾ãšåœ°ç‚¹[4,3]ã«ã„ãŸä¸å¯©ç®‡æ‰€ãŒè­˜åˆ¥ã•ã‚Œã¾ã™");
		add_message("è¦æ•‘åŠ©è€…ãŒã„ãŸã®ã§æ­»äº¡("+emoji["dead"].chara+")ãŒ1å¢—ãˆã€");
		add_message("ã‚²ãƒ¼ãƒ ã‹ã‚‰å–ã‚Šé™¤ã‹ã‚Œã¾ã™ã€‚");
		add_message("ã€€");
		add_message("4åæ­»äº¡ã•ã›ãŸæ™‚ç‚¹ã§æ•—åŒ—ãŒæ±ºã¾ã‚Šã¾ã™ã€‚");
		game.phase++;



	}else if(game.phase==133){
		poi[0].status = 0;
		game.dead++;
		player[0].x=5;player[0].y=0;
		draw_board();
		clear_message();
		//d_message("â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹");	â†ã“ã‚Œã§å…¨è§’30æ–‡å­—æ–‡ã®å¹…
		add_message("æ¬¡ã«ã€ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼1ãŒç‚ã«ã„ã‚‹ã®ã§ã€");
		add_message("æœ€ã‚‚è¿‘ã„æ•‘æ€¥è»Šã®é…ç½®åœ°ç‚¹ã«ç§»å‹•ã—ã¾ã™ã€‚");
		game.phase++;

	}else if(game.phase==134){
		draw_board();
		clear_message();
		//d_message("â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹");	â†ã“ã‚Œã§å…¨è§’30æ–‡å­—æ–‡ã®å¹…
		add_message("æœ€å¾Œã«ã€ã€Œä¸å¯©ç®‡æ‰€ã®è£œå……ã€ã‚’è¡Œã„ã¾ã™ã€‚");
		add_message("ä¸å¯©ç®‡æ‰€ã¨è¦æ•‘åŠ©è€…ã®åˆè¨ˆãŒ3ã¤ã«ãªã‚‹ã¾ã§ã€");
		add_message("ä¸å¯©ç®‡æ‰€ã‚„è¦æ•‘åŠ©è€…ãŒã„ãªã„ãƒ©ãƒ³ãƒ€ãƒ ãªåœ°ç‚¹ãŒé¸ã°ã‚Œ");
		add_message("ãã“ã«æ–°ãŸãªä¸å¯©ç®‡æ‰€ãŒç™ºç”Ÿã—ã¾ã™ã€‚");
		game.phase++;

	}else if(game.phase==135){
		refill_poi();
		phase_change(tmp_s,tmp_p);
		draw_board();
		clear_message();
		//d_message("â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹");	â†ã“ã‚Œã§å…¨è§’30æ–‡å­—æ–‡ã®å¹…
		add_message("ç‚ã‚„ç…™ãŒã‚ã‚‹å ´æ‰€ã§ã‚ã‚Œã°ãã‚Œã‚‰ãŒæ¶ˆãˆã€");
		add_message("ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãŒã„ã‚‹å ´æ‰€ãªã‚‰ã°ç›´ã¡ã«è¦æ•‘åŠ©è€…ã®å­˜å¦ãŒåˆ¤æ˜ã—ã¾ã™ã€‚");
		game.phase++;

	}else if(game.phase==136){
		show_option(["æ¬¡ã¸"]);
		clear_message();
		//d_message("â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹");	â†ã“ã‚Œã§å…¨è§’30æ–‡å­—æ–‡ã®å¹…
		add_message("ã“ã®ã‚ˆã†ã«å„ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã§ã‚¿ãƒ¼ãƒ³ã‚’é€²ã‚ã¦ã„ãã€")
		add_message("å»ºç‰©ã®è€ä¹…å€¤ãŒãªããªã‚‹ã¾ã§ã«è¦æ•‘åŠ©è€…ã‚’æ•‘ã„å‡ºã™ã“ã¨ã‚’ç›®æŒ‡ã—ã¦");
		add_message("å¥®é—˜ã—ã¦ã„ãã¾ã—ã‚‡ã†ï¼");
		add_message("ã€€");
		add_message("7åæ•‘å‡ºã—ãŸã‚ã¨ã‚‚ã€10äººå®Œå…¨æ•‘å‡ºã‚’ç›®æŒ‡ã—ã¦ç¶šè¡Œã§ãã¾ã™ã€‚");
		game.phase++;

	}else if(game.phase==200){
		game.difficulty = 0;
		init_map("first_easy");
		player=[{role:"generalist",x:-1,y:-1,grab:[],color:p_color[0],chara:"p1",ap:0}];
		player.push({role:"generalist",x:-1,y:-1,grab:[],color:p_color[1],chara:"p2",ap:0});
		player.push({role:"generalist",x:-1,y:-1,grab:[],color:p_color[2],chara:"p3",ap:0});
		game.damage=24;
		game.poi_rest=15;
		game.turn = 0;

		//d_message("â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹");	â†ã“ã‚Œã§å…¨è§’30æ–‡å­—æ–‡ã®å¹…
		clear_message();
		show_option(["æ¬¡ã¸"]);
		add_message(" - ãƒ­ãƒ¼ãƒ«ã®èª¬æ˜ - ");
		add_message("ã€€");
		add_message("é€šå¸¸ãƒ«ãƒ¼ãƒ«ã®ãƒ—ãƒ¬ã‚¤ã§ã¯å„ãƒ­ãƒ¼ãƒ«ã«å¿œã˜ã¦");
		add_message("APã‚’ä»˜ä¸ã•ã‚ŒãŸã‚Šç‰¹æ®Šã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’è¡Œãˆã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚");
		add_message("ã€€");

		game.phase++;

	}else if(game.phase==201){

		game.ap=role[player[0].role].ap;
		game.sap=role[player[0].role].sap;
		show_option(["æ¬¡ã¸"]);
		//d_message("â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹");	â†ã“ã‚Œã§å…¨è§’30æ–‡å­—æ–‡ã®å¹…
		clear_message();
		add_message(""+role[player[0].role].name+"ã€€AP"+emoji["ap"].chara+":"+role[player[0].role].ap+"ã€€ç‰¹æ®ŠAP"+emoji["sap"].chara+":"+role[player[0].role].sap);
		add_message("ã€€");
		add_message("ç‰¹æ®Šèƒ½åŠ›ã¯ã‚ã‚Šã¾ã›ã‚“ãŒã€é€šå¸¸ã‚ˆã‚ŠAPãŒå¤šã„ã‚­ãƒ£ãƒ©ã§ã™");
		add_message("ã€€");

		game.phase++;

	}else if(game.phase==202){
		player[0].role="cafs";
		game.ap = role[player[0].role].ap;
		game.sap=role[player[0].role].sap;
		show_option(["æ¬¡ã¸"]);
		//d_message("â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹");	â†ã“ã‚Œã§å…¨è§’30æ–‡å­—æ–‡ã®å¹…
		clear_message();
		add_message(""+role[player[0].role].name+"ã€€AP"+emoji["ap"].chara+":"+role[player[0].role].ap+"ã€€ç‰¹æ®ŠAP"+emoji["sap"].chara+":"+role[player[0].role].sap);
		add_message("ã€€");
		add_message("ã€Œæ¶ˆç«ã€ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’ç‰¹æ®ŠAPã‚’ä½¿ã£ã¦è¡Œã†ã“ã¨ãŒå‡ºæ¥ã¾ã™ã€‚");
		add_message("é€šå¸¸ã®APã‚’ä½¿ã£ã¦ã€Œæ¶ˆç«ã€ã‚¢ã‚¯ã‚·ãƒ§ãƒ³è¡Œã†ã“ã¨ã‚‚å‡ºæ¥ã¾ã™ã€‚");
		add_message("ï¼ˆç‰¹æ®ŠAPã¯æ¬¡ã®ã‚¿ãƒ¼ãƒ³ã«ç¹°ã‚Šè¶Šã™ã“ã¨ãŒå‡ºæ¥ã¾ã›ã‚“ã€‚ï¼‰");

		game.phase++;

	}else if(game.phase==203){
		player[0].role="imaging";
		game.ap=role[player[0].role].ap;
		game.sap=role[player[0].role].sap;
		show_option(["æ¬¡ã¸"]);
		//d_message("â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹");	â†ã“ã‚Œã§å…¨è§’30æ–‡å­—æ–‡ã®å¹…
		clear_message();
		add_message(""+role[player[0].role].name+"ã€€AP"+emoji["ap"].chara+":"+role[player[0].role].ap+"ã€€ç‰¹æ®ŠAP"+emoji["sap"].chara+":"+role[player[0].role].sap);
		add_message("ã€€");
		add_message("ç‰¹æ®Šã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã€Œ"+role["imaging"].ex_action[0].name+"ã€(1AP)ãŒè¡Œãˆã¾ã™ã€‚");
		add_message("é›¢ã‚ŒãŸä¸å¯©ç®‡æ‰€1ã‚«æ‰€ã‚’æŒ‡å®šã—ã¦");
		add_message("ãã®ä¸å¯©ç®‡æ‰€ãŒè¦æ•‘åŠ©è€…ã‹èª¤å ±ã‹è­˜åˆ¥ã™ã‚‹ã“ã¨ãŒå‡ºæ¥ã¾ã™ã€‚");

		game.phase++;

	}else if(game.phase==204){
		player[0].role="paramedic";
		game.ap=role[player[0].role].ap;
		game.sap=role[player[0].role].sap;
		show_option(["æ¬¡ã¸"]);
		//d_message("â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹");	â†ã“ã‚Œã§å…¨è§’30æ–‡å­—æ–‡ã®å¹…
		clear_message();
		add_message(""+role[player[0].role].name+"ã€€AP"+emoji["ap"].chara+":"+role[player[0].role].ap+"ã€€ç‰¹æ®ŠAP"+emoji["sap"].chara+":"+role[player[0].role].sap);
		add_message("ã€€");
		add_message("ç‰¹æ®Šã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã€Œ"+role["paramedic"].ex_action[0].name+"ã€(1AP)ãŒè¡Œãˆã¾ã™ã€‚");
		add_message("åŒã˜ãƒã‚¹ã«ã„ã‚‹"+poi_name[2]+emoji["victim"].chara+"ã‚’è˜‡ç”Ÿã—ã¦");
		add_message(poi_name[3]+emoji["healed"].chara+"ã«ã™ã‚‹ã“ã¨ãŒå‡ºæ¥ã¾ã™ã€‚");


		game.phase++;

	}else if(game.phase==205){
		show_option(["æ¬¡ã¸"]);
		//d_message("â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹");	â†ã“ã‚Œã§å…¨è§’30æ–‡å­—æ–‡ã®å¹…
		clear_message();
		add_message(""+poi_name[3]+"ã¯1APã§é‹ã¶ã“ã¨ãŒã§ãã¾ã™ã€‚");
		add_message("ã€€");
		add_message("ã¾ãŸã€åˆ¥ã®è˜‡ç”Ÿã—ã¦ã„ãªã„"+poi_name[2]+"ã‚’é‹ã¶ã¨ãã«");
		add_message("åŒã˜ãƒã‚¹ã®"+poi_name[3]+"ã‚’ä¸€ç·’ã«é‹ã¶ã“ã¨ãŒå‡ºæ¥ã¾ã™ã€‚");
		add_message(poi_name[3]+"ã‚’é€£ã‚Œã¦ç‚ã«ä¾µå…¥ã™ã‚‹ã“ã¨ã¯å‡ºæ¥ã¾ã›ã‚“ã€‚");


		game.phase++;
	}else if(game.phase==206){

		player[0].role="hazmat";
		game.ap=role[player[0].role].ap;
		game.sap=role[player[0].role].sap;
		show_option(["æ¬¡ã¸"]);
		//d_message("â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹");	â†ã“ã‚Œã§å…¨è§’30æ–‡å­—æ–‡ã®å¹…
		clear_message();
		add_message(""+role[player[0].role].name+"ã€€AP"+emoji["ap"].chara+":"+role[player[0].role].ap+"ã€€ç‰¹æ®ŠAP"+emoji["sap"].chara+":"+role[player[0].role].sap);
		add_message("ã€€");
		add_message("ç‰¹æ®Šã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã€Œ"+role["hazmat"].ex_action[0].name+"ã€(1AP)ãŒè¡Œãˆã¾ã™ã€‚");
		add_message("åŒã˜ãƒã‚¹ã«ã„ã‚‹å±é™ºç‰©ã‚’ãã®å ´ã§å‡¦åˆ†ã—ã¾ã™ã€‚");

		game.phase++;
	}else if(game.phase==207){

		player[0].role="rescue";
		game.ap=role[player[0].role].ap;
		game.sap=role[player[0].role].sap;
		show_option(["æ¬¡ã¸"]);
		//d_message("â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹");	â†ã“ã‚Œã§å…¨è§’30æ–‡å­—æ–‡ã®å¹…
		clear_message();
		add_message(""+role[player[0].role].name+"ã€€AP"+emoji["ap"].chara+":"+role[player[0].role].ap+"ã€€ç‰¹æ®ŠAP"+emoji["sap"].chara+":"+role[player[0].role].sap);
		add_message("ã€Œç§»å‹•/é‹ã¶ã€ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã«ç‰¹æ®ŠAPãŒä½¿ç”¨ã§ãã¾ã™ã€‚");
		add_message("é€šå¸¸ã®APã‚’ä½¿ã£ã¦åŒã‚¢ã‚¯ã‚·ãƒ§ãƒ³è¡Œã†ã“ã¨ã‚‚å‡ºæ¥ã¾ã™ã€‚");
		add_message("ï¼ˆç‰¹æ®ŠAPã¯æ¬¡ã®ã‚¿ãƒ¼ãƒ³ã«ç¹°ã‚Šè¶Šã™ã“ã¨ãŒå‡ºæ¥ã¾ã›ã‚“ã€‚ï¼‰");
		add_message("ã¾ãŸã€ã€Œå£ã‚’å£Šã™ã€ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’1APã§è¡Œãˆã¾ã™ã€‚");

		game.phase++;
	}else if(game.phase==208){

		player[0].role="driver";
		game.ap=role[player[0].role].ap;
		game.sap=role[player[0].role].sap;
		show_option(["æ¬¡ã¸"]);
		//d_message("â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹");	â†ã“ã‚Œã§å…¨è§’30æ–‡å­—æ–‡ã®å¹…
		clear_message();
		add_message(""+role[player[0].role].name+"ã€€AP"+emoji["ap"].chara+":"+role[player[0].role].ap+"ã€€ç‰¹æ®ŠAP"+emoji["sap"].chara+":"+role[player[0].role].sap);
		add_message("ã€Œæ¶ˆé˜²è»Šã®æ”¾æ°´ã€ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’2APã§è¡Œã†ã“ã¨ãŒå‡ºæ¥ã¾ã™ã€‚");
		add_message("ã¾ãŸã€ãƒ©ãƒ³ãƒ€ãƒ ã«é¸ã°ã‚ŒãŸæ”¾æ°´ã®èµ·ç‚¹ã«ã¤ã„ã¦");
		add_message("ç¸¦ã‹æ¨ªã‹ãã®ä¸¡æ–¹ã‚’å†æŠ½é¸ã™ã‚‹ã“ã¨ãŒå‡ºæ¥ã¾ã™ã€‚");
		add_message("ç‰‡æ–¹ã‚’å†æŠ½é¸ã—ãŸå¾Œã«ã€ã‚‚ã†ç‰‡æ–¹ã‚’å†æŠ½é¸ã™ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™ã€‚");

		game.phase++;
	}else if(game.phase==209){

		player[0].role="captain";
		game.ap=role[player[0].role].ap;
		game.sap=role[player[0].role].sap;
		show_option(["æ¬¡ã¸"]);
		//d_message("â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹");	â†ã“ã‚Œã§å…¨è§’30æ–‡å­—æ–‡ã®å¹…
		clear_message();
		add_message(""+role[player[0].role].name+"ã€€AP"+emoji["ap"].chara+":"+role[player[0].role].ap+"ã€€ç‰¹æ®ŠAP"+emoji["sap"].chara+":"+role[player[0].role].sap);
		add_message("ç‰¹æ®Šã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã€Œ"+role["captain"].ex_action[0].name+"ã€ãŒè¡Œãˆã¾ã™ã€‚");
		add_message("è‡ªåˆ†ã®APã‚’ä½¿ã„ã€ä»–è€…ã‚’ç§»å‹•ã•ã›ã‚‹ã‹æ‰‰ã‚’é–‹é–‰ã•ã›ã¾ã™ã€‚");
		add_message("ç‰¹æ®ŠAPã¨é€šå¸¸APã©ã¡ã‚‰ã§ã‚‚ä½¿ãˆã¾ã™ã€‚");
		add_message(role["cafs"].name+"ã«å¯¾ã—ã¦1ã‚¿ãƒ¼ãƒ³ã«1APã¾ã§ã—ã‹ä½¿ãˆã¾ã›ã‚“ã€‚");

		game.phase++;
	}else{
		enter_start_menu();
	}
}

//-------------------------------------------------------------------------------------
//--æç”»é–¢é€£---------------------------------------------------------------------------
//-------------------------------------------------------------------------------------

function masu_haji(a){//å‡ç›®ã¨åº§æ¨™ã®å¤‰æ›ã€‚çµæ§‹ä½¿ã†ã®ã§é–¢æ•°åŒ–ã€‚
	return (a) * cell_size;
}

function masu_naka(a){//å‡ç›®ã®çœŸã‚“ä¸­ã®åº§æ¨™ã‚’æ±‚ã‚ã‚‹ã€‚çµæ§‹ä½¿ã†ã®ã§é–¢æ•°åŒ–ã€‚
	return (a+0.5) * cell_size;
}

function draw_board(){//ãƒœãƒ¼ãƒ‰ã‚’è¡¨ç¤ºã™ã‚‹ã€‚
	//--èƒŒæ™¯ã¬ã‚Šã¤ã¶ã—
	context.fillStyle="hsl(50,100%,90%)";
	context.fillRect(0,0,game_display.width,game_display.height);

	//æ¶ˆé˜²è»Šã¨æ•‘æ€¥è»Šã®åœè»Šä½ç½®ã®å¡—ã‚Š
	for(i=0;i<4;i++){
		var xn = Math.min(board.fireengine_place[i][0][0],board.fireengine_place[i][1][0]);
		var xm = Math.max(board.fireengine_place[i][0][0],board.fireengine_place[i][1][0]);
		var yn = Math.min(board.fireengine_place[i][0][1],board.fireengine_place[i][1][1]);
		var ym = Math.max(board.fireengine_place[i][0][1],board.fireengine_place[i][1][1]);
		if(board.fireengine_pos==i){
			context.fillStyle = fireengine_color;
			context.fillRect(masu_haji(xn+0.1),masu_haji(yn+0.1),masu_haji((xm-xn)+0.8),masu_haji((ym-yn)+0.8));
			draw_emoji("fireengine",masu_naka((xm+xn)/2),masu_naka((ym+yn)/2));
		}else{
			context.fillStyle = "rgba("+fireengine_color.substring(4,fireengine_color.length-1)+",40%)";
			context.fillRect(masu_haji(xn+0.1),masu_haji(yn+0.1),masu_haji((xm-xn)+0.8),masu_haji((ym-yn)+0.8));
		}

		xn = Math.min(board.ambulance_place[i][0][0],board.ambulance_place[i][1][0]);
		xm = Math.max(board.ambulance_place[i][0][0],board.ambulance_place[i][1][0]);
		yn = Math.min(board.ambulance_place[i][0][1],board.ambulance_place[i][1][1]);
		ym = Math.max(board.ambulance_place[i][0][1],board.ambulance_place[i][1][1]);
		if(board.ambulance_pos==i){
			context.fillStyle = ambulance_color;
			context.fillRect(masu_haji(xn+0.1),masu_haji(yn+0.1),masu_haji((xm-xn)+0.8),masu_haji((ym-yn)+0.8));
			draw_emoji("ambulance",masu_naka((xm+xn)/2),masu_naka((ym+yn)/2));
		}else{
			context.fillStyle = "rgba("+ambulance_color.substring(4,ambulance_color.length-1)+",40%)";
			context.fillRect(masu_haji(xn+0.1),masu_haji(yn+0.1),masu_haji((xm-xn)+0.8),masu_haji((ym-yn)+0.8));
		}
		//console.log("åœ°ç‚¹["+xn+","+yn+"]["+xm+","+ym+"]ã«æ•‘æ€¥è»Šæç”»");
		
	};

	//å‡ç›®ã®ãƒ•ãƒ
	context.strokeStyle = "hsl(50,10%,70%)";
	context.lineWidth = 1;
	for(var i=0;i<board.tate;i++){
		for(var j=0;j<board.yoko;j++){
			context.strokeRect(masu_haji(j),masu_haji(i),cell_size,cell_size);
		}
	}

	//é«˜éŸ³ç‚¹ã¨ç‚ãƒãƒ¼ã‚«ãƒ¼
	for(var x=0;x<board.yoko;x++){
		for(var y=0;y<board.tate;y++){

			if(board.hotspot[x][y] == 1){
				draw_emoji("hotspot",masu_naka(x+0.45-emoji["hotspot"].multi/2),masu_naka(y-0.45+emoji["hotspot"].multi/2));
			}
			if(board.fire[x][y] == 1){
				draw_emoji("smoke",masu_naka(x),masu_naka(y));
			}else if(board.fire[x][y] == 2){
				draw_emoji("fire",masu_naka(x),masu_naka(y));
			}
		}
	}


	//ãƒã‚¹ã®ä¸‹ã«ã™ã‚‹ãƒãƒ¼ã‚«ãƒ¼ã‚’ã„ã£ãŸã‚“ãã‚Œã„ã«ã™ã‚‹ã€‚
	for(var x=0;x<board.yoko;x++){
		for(var y=0;y<board.tate;y++){
			board.marker[x][y]=0;
		}
	}
	
	//ãƒã‚¹ã§ã®é‡è¤‡ã‚’è¨˜éŒ²ã—ã¦ã„ã
	for(var i=0;i<player.length;i++){
		if(player[i].x>=0)board.marker[player[i].x][player[i].y]++;
	}

	//ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼é§’ã‚’æç”»
	for(var i=0;i<player.length;i++){
		if(player[i].x>=0)draw_player(player[i]);
	}

	//ãƒã‚¹ã®ä¸‹ã«ã™ã‚‹ãƒãƒ¼ã‚«ãƒ¼ã‚’ã„ã£ãŸã‚“ãã‚Œã„ã«ã™ã‚‹ã€‚
	for(var x=0;x<board.yoko;x++){
		for(var y=0;y<board.tate;y++){
			board.marker[x][y]=0;
		}
	}

	//POIã¨å±é™ºç‰©ã®ãƒã‚¹ã”ã¨ã«ç½®ã‹ã‚Œã‚‹æ•°ã‚’è¨˜éŒ²ã™ã‚‹
	for(var i=0;i<poi.length;i++){
		if(poi[i].status>0){board.marker[poi[i].x][poi[i].y]++;}
	}
	for(var i=0;i<hazmat.length;i++){
		if(hazmat[i].status>0){board.marker[hazmat[i].x][hazmat[i].y]++;}
	}

	//POIã¨å±é™ºç‰©ã®ãƒãƒ¼ã‚«ãƒ¼ã‚’ç›¤é¢ã«æç”»ã—ã¦ã„ã
	for(var i=0;i<poi.length;i++){
		if(poi[i].status==1){draw_marker("poi",poi[i].x,poi[i].y);}
		if(poi[i].status==2){draw_marker("victim",poi[i].x,poi[i].y);}
		if(poi[i].status==3){draw_marker("healed",poi[i].x,poi[i].y);}
	}
	for(var i=0;i<hazmat.length;i++){
		if(hazmat[i].status>0){draw_marker("hazmat",hazmat[i].x,hazmat[i].y);}
	}

	//å£ã®æç”»
	context.lineWidth = 5;
	for(var x=0;x<board.yoko;x++){
		for(var y=0;y<board.tate;y++){
		for(var k=0;k<2;k++){//0:ç¸¦ç·š,1;æ¨ªç·šã®åˆ‡æ›¿ãˆ

			if(k==0){l= board.wall_tate[x][y];}
			else{l= board.wall_yoko[x][y];}
			
			if(l==1){//ãƒ‰ã‚¢é–‹ã„ã¦ã‚‹
				context.strokeStyle = "rgb(255,128,0)";
				context.beginPath();
				context.moveTo(masu_haji(x+k),masu_haji(y+1-k));
				context.lineTo(masu_haji(x+0.4*k+0.4),masu_haji(y-0.4*k+0.8));
				context.moveTo(masu_haji(x+0.6*k+0.6),masu_haji(y-0.6*k+1.2));
				context.lineTo(masu_haji(x+1),masu_haji(y+1));
				context.stroke();
			}else if(l==2){//ã—ã¾ã£ã¦ã‚‹ãƒ‰ã‚¢
				context.strokeStyle = "rgb(255,128,0)";
				context.beginPath();
				context.moveTo(masu_haji(x+k),masu_haji(y+1-k));
				context.lineTo(masu_haji(x+0.45+0.55*k),masu_haji(y+1-0.55*k));
				context.moveTo(masu_haji(x+0.55+0.45*k),masu_haji(y+1-0.45*k));
				context.lineTo(masu_haji(x+1),masu_haji(y+1));
				context.stroke();
			}else if(l==3){//å£Šã‚Œã‹ã‘ã®å£
				context.setLineDash([Math.floor(cell_size/10),Math.floor(cell_size/10)]);
				context.strokeStyle = "rgb(0,0,0)";
				context.beginPath();
				context.moveTo(masu_haji(x+k),masu_haji(y+1));
				context.lineTo(masu_haji(x+1),masu_haji(y+1-k));
				context.stroke();
				context.setLineDash([]);
			}else if(l==4){//ç„¡å‚·ã®å£
				context.strokeStyle = "rgb(0,0,0)";
				context.beginPath();
				context.moveTo(masu_haji(x+k),masu_haji(y+1));
				context.lineTo(masu_haji(x+1),masu_haji(y+1-k));
				context.stroke();
			}
		}
		}
	}
}

function draw_emoji(l,x,y){
	context.textBaseline = "middle";
	context.font = emoji[l].size+"px monospace";

	tmp = context.measureText(emoji[l].chara).width / 2;
	context.fillStyle="rgb(0,0,0)";
	context.fillText(emoji[l].chara,x - tmp,y);
}

function draw_marker(l,x,y,max_w = board.yoko * cell_size){

	var xx;
	var yy;

	if(board.marker[x][y]==1){

		xx = masu_naka(x);
		yy = masu_naka(y+0.45-emoji[l].multi/2);
	}else{
		var s = Math.floor(board.marker[x][y]);
		var p = board.marker[x][y] - s;
		xx = masu_haji(x+0.05+emoji[l].multi/2+p*(1-emoji[l].multi/0.9));
		yy = masu_naka(y+0.45-emoji[l].multi/2);
		board.marker[x][y]+=0.9/(s-1);
	}
	
	if(l=="poi" || l=="victim" || l=="healed" || l=="hazmat" ){
		if(l=="hazmat"){context.fillStyle = hazmat_color;}
		else{context.fillStyle = poi_color;}
		context.beginPath();
		context.arc(xx+emoji[l].multi/2,yy,cell_size/2*emoji[l].multi,0,2 * Math.PI);
		context.closePath();
		context.fill();
	}
	
	draw_emoji(l,xx,yy);
}
function resize_board(){ //ãƒœãƒ¼ãƒ‰ã®ãƒªã‚µã‚¤ã‚º

	card_display.innerHTML="";
	message_display.innerHTML = ""
	for(var i = 0;i<5;i++){
		var roo = message_display.insertRow();
		c = roo.insertCell();
		c.innerHTML ="ã€€";
	}
	if(window.innerHeight>window.innerWidth){
		document.querySelector(".board_shita").appendChild(document.querySelector(".card_display"));
		board_ul.colSpan=2;
		board_ul.rowSpan=1;
		board_migi.colSpan=1;
		card_pos = 0;
		dummu_option();
		cell_size = Math.floor(Math.min((document.documentElement.clientHeight/2 - message_display.clientHeight - 100) / board.tate,(document.documentElement.clientWidth - 100)/board.yoko));
		game_display.width = board.yoko * cell_size;
		game_display.height = board.tate * cell_size;
		while(document.documentElement.scrollWidth <= document.documentElement.clientWidth && game_display.height + message_display.clientHeight <= document.documentElement.clientHeight /2){
			cell_size++;
			game_display.width = board.yoko * cell_size;
			game_display.height = board.tate * cell_size;
		}

	}else{

		document.querySelector(".board_migi").appendChild(document.querySelector(".card_display"));
		board_ul.colSpan=1;
		board_ul.rowSpan=2;
		board_migi.colSpan=2;
		card_pos = 1;
		dummu_option();

		cell_size = Math.floor(Math.min((document.documentElement.clientHeight - message_display.clientHeight - 100) / board.tate,(document.documentElement.clientWidth * 2/3 - 100)/board.yoko));
		game_display.width = board.yoko * cell_size;
		game_display.height = board.tate * cell_size;
		while(document.documentElement.scrollHeight<=document.documentElement.clientHeight && game_display.width <= document.documentElement.clientWidth * 2/3){
			cell_size++;
			game_display.width = board.yoko * cell_size;
			game_display.height = board.tate * cell_size;
		}

	}
	//console.log("card_pos:"+card_pos);

	cell_size--;
	game_display.width = board.yoko * cell_size;
	game_display.height = board.tate * cell_size;

	var siz = 5;
	card_display.style="font-size:"+siz+"pt;white-space:nowrap;";

	while(document.documentElement.scrollHeight<=document.documentElement.clientHeight && document.documentElement.scrollWidth <= document.documentElement.clientWidth){
		siz++;
		card_display.style="font-size:"+siz+"pt;white-space:nowrap;";
	}

	siz--;
	card_display.style="font-size:"+siz+"pt;white-space:nowrap;";
	card_font_size = siz;
	Object.keys(emoji).forEach(function(key){
		emoji[key].size = 5;
		context.font = "5px monospace";
		while(context.measureText(emoji[key].chara).actualBoundingBoxAscent + context.measureText(emoji[key].chara).actualBoundingBoxDescent < cell_size *emoji[key].multi && context.measureText(emoji[key].chara).width< cell_size *emoji[key].multi){
			emoji[key].size++;
			context.font = emoji[key].size+"px monospace";
		}
		emoji[key].size--;
	});

	if(card_labels[0].indexOf("select")>0){
		show_role(role_selector.length);
	}else{
		show_option(card_labels);
	}

	show_message();
	draw_board();	

}


function draw_player(a){//ã‚­ãƒ£ãƒ©æç”»ã®é–¢æ•°

	if(board.marker[a.x][a.y]==1){
		a.current_x = masu_naka(a.x);
		a.current_y = masu_naka(a.y);
	}else{
		var s = Math.floor(board.marker[a.x][a.y]);
		var p = board.marker[a.x][a.y] - s;
		a.current_x = masu_haji(a.x+0.05+emoji[a.chara].multi/2+p*(1-emoji[a.chara].multi/0.9));
		a.current_y = masu_naka(a.y);
		board.marker[a.x][a.y]+=0.9/(s-1);
	}

	context.fillStyle = a.color;
	context.beginPath();
	context.arc(a.current_x,a.current_y,cell_size/2*emoji[a.chara].multi,0,2 * Math.PI);
	context.closePath();
	context.fill();

	context.fillStyle = "RGB(32,32,32)";
	context.textBaseline = "middle";
	context.font = emoji[a.chara].size+"px monospace";
	tmp = context.measureText(emoji[a.chara].chara).width / 2;
	context.fillText(emoji[a.chara].chara,a.current_x - tmp,a.current_y);
	
}

function draw_circle(xx,yy){//ä½ç½®ã‚’ç¤ºã™ãƒ¯ãƒƒã‚«ã•ã‚“ã®æç”»


	context.strokeStyle = "rgba(0,0,0,50%)";
	
	context.lineWidth = Math.floor(cell_size/10);
	context.beginPath();
	context.arc(masu_naka(xx),masu_naka(yy),cell_size*0.4,0,2 * Math.PI);
	context.closePath();
	context.stroke();

}

function option_header(a = true){
	var roo = card_display.insertRow();
	c = roo.insertCell();
	c.innerHTML = ""+emoji["damage"].chara + ":"+game.damage+"ã€€"+emoji["alive"].chara+":"+game.alive+" "+emoji["dead"].chara+":"+game.dead;
	if(game.scene==3 && a == true){c.innerHTML += "ã€€<input type='button' value='"+emoji["rewind"].chara+"' onClick='click_rewind();' style='font-size:"+(card_font_size-3)+"pt'>";}
	if(card_pos==0){c.colSpan=2;}
	roo = card_display.insertRow();
	c = roo.insertCell();
	if(card_pos==0){c.colSpan=2;}
	c.innerHTML = emoji["poi"].chara+":"+game.poi_rest+" "+emoji["hotspot"].chara+":"+game.hotspot_remain+"ã€€"+emoji["ap"].chara+":"+game.ap+" "+emoji["sap"].chara+":"+game.sap;
	roo = card_display.insertRow();
	c = roo.insertCell();
	if(card_pos==0){c.colSpan=2;}
	if(1==game.scene ||3<=game.scene){
		if(game.difficulty<0){
			c.innerHTML = "<span style='background-color:"+player[game.turn].color+"'>ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼"+(game.turn+1)+"</span>";
		}else{
			c.innerHTML = "<span style='background-color:"+player[game.turn].color+"'>"+(game.turn+1)+":"+role[player[game.turn].role].name+"</span>";
		}
		
	}else{
		c.innerHTML = "ã€€";
	}
	if(card_pos==0){c.colSpan=2;}

	roo = card_display.insertRow();
	c = roo.insertCell();
	c.innerHTML = "â”â”€â”â”€â”â”€â”â”€â”";
	if(card_pos==0){
		c = roo.insertCell();
		c.innerHTML = "â”â”€â”â”€â”â”€â”â”€â”";
	}else{
	c.innerHTML = "â”â”€â”â”€â”â”€â”â”€â”â”€â”â”€â”";
	}

}

function dummu_option(){
	card_display.innerHTML = ""
	option_header(false);

	for(var i = 0;i<9;i++){
		if(card_pos==1 || i%2==0)roo = card_display.insertRow();

		c = roo.insertCell();
		c.innerHTML ="ãƒ’ãƒ­å”æ¾¤ãƒŠã‚¤ãƒ•ã§ãƒ¡";

	}

	if(card_pos==1 || i%2==0)roo = card_display.insertRow();
	c = roo.insertCell();

	c.innerHTML = "æ±ºå®š";


}
function show_role(a){
	card_display.innerHTML = ""
	role_selector = [];
	var roo;

	card_labels=[];
	card_td = [];
	option_header();


	for(var i = 0;i<a || i<9;i++){
		if(card_pos==1 || i%2==0)roo = card_display.insertRow();
		c = roo.insertCell();
		card_td.push(c);
		if(i<a){
			c.innerHTML =(i+1)+":";
			let new_select = document.createElement('select');
			new_select.style="font-size:"+(card_font_size*2/3)+"pt";
			role_selector.push(new_select);
			Object.keys(role).forEach(function(key){
				let new_option = document.createElement('option');
				new_option.value = key;
				new_option.text = role[key].name;
				new_select.appendChild(new_option);
			});
			new_select.options[i].selected = true;
			c.appendChild(new_select);
		}else{c.innerHTML ="ã€€";}
		card_labels.push(c.innerHTML);
	}

	if(card_pos==1 || i%2==0)roo = card_display.insertRow();
	c = roo.insertCell();
	card_td.push(c);
	c.style="background-color:#fff0d0";
	c.innerHTML = "æ±ºå®š";
	c.onclick = addon_cast(i);
	card_labels.push(c.innerHTML);

}

function show_option(a){
	card_display.innerHTML = ""

	card_labels = a;//å†æç”»ç”¨ã«å–ã£ã¨ã
	card_td = [];

	var roo;	
	option_header();

	for(var i = 0;i<a.length || i<9;i++){
		if(card_pos==1 || i%2==0)roo = card_display.insertRow();
		c = roo.insertCell();
		card_td.push(c);
		if(i<a.length){
			c.innerHTML = a[i];
			if(a[i]!="ã€€" && a[i].indexOf("select")<0){
				if(c.innerHTML!="ã€€")c.style="background-color:#fff0d0;";
				c.onclick = addon_cast(i);
			}
		}else{c.innerHTML ="ã€€";}
	}
	if(game.scene==3 && game.phase==0){
		if(card_pos==1 || i%2==0) roo = card_display.insertRow();
		c = roo.insertCell();
		card_td.push(c);
		c.style="background-color:#fff0d0;";
		c.innerHTML = "ã‚¿ãƒ¼ãƒ³çµ‚äº†";
		c.onclick = begining_end_phase;
	}else{
		if(card_pos==1 || a%2==0)roo = card_display.insertRow();
		c = roo.insertCell();
		card_td.push(c);
		c.innerHTML = "ã€€";
	}
}

function addon_cast(a){return function(){click_option(a);}}


function clear_message(){
	message_array=[];
	show_message();
}

function add_message(a){
	message_array.push(a);
	show_message();
}

function show_message(){
		message_display.innerHTML = ""
	for(var i = 0;i<message_array.length || i<5;i++){
		var roo = message_display.insertRow();
		c = roo.insertCell();
		if(i<message_array.length){
			c.innerHTML = message_array[i];
		}else{c.innerHTML ="ã€€";}
	}
}




//--------------åˆ¤å®šç”¨é–¢æ•°ç¾¤----------------
function is_white_space(xx,yy){

	if(is_in_stage(xx,yy)==false)return false;

	if(stage[xx][yy]==0 && is_anyone_there(xx,yy) < 0){return true;}
	else{return false;}
}

function is_in_board(xx,yy){
	if(xx<0){return false;}
	if(yy<0){return false;}
	if(board.tate<=yy){return false;}
	if(board.yoko<=xx){return false;}
	return true;
}



//---------------------


</script>

</head>
<body onload="init();" >
<center>

<table width="100%" id="board_table"><tr><td class="board_ul" id="board_ul"><center>
<canvas id="game_display"  style="outline:solid;"></canvas>
</center>

<table id="message_display" >
<tr><td>ã€€</td></tr>
<tr><td>ã€€</td></tr>
<tr><td>ã€€</td></tr>
<tr><td>ã€€</td></tr>
<tr><td>ã€€</td></tr>
</table>
</td><td class="board_migi" id="board_migi" align="left">
<table id="card_display" class="card_display" style="width:100%;table-layout:fixed;"></table>
</td></tr>
<tr><td class="board_shita" id="board_shita" align="center"></td>
<td id="board_lr"><span style="font-size:10pt;">Github</span></td></tr>
</table>



</center>




</body>
</html>
